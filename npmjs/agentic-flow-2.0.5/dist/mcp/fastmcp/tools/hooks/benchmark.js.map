{"version":3,"file":"benchmark.js","sourceRoot":"","sources":["../../../../../src/mcp/fastmcp/tools/hooks/benchmark.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/**\n * Benchmark for Hook Tools\n * Tests latency and throughput\n */\n\nimport { hookPreEditTool } from './pre-edit.js';\nimport { hookPostEditTool } from './post-edit.js';\nimport { hookPreCommandTool } from './pre-command.js';\nimport { hookRouteTool } from './route.js';\nimport { hookMetricsTool } from './metrics.js';\nimport { hookPretrainTool } from './pretrain.js';\n\nconst mockContext = {\n  onProgress: () => {}\n};\n\ninterface BenchmarkResult {\n  tool: string;\n  iterations: number;\n  avgLatencyMs: number;\n  p50Ms: number;\n  p95Ms: number;\n  p99Ms: number;\n  minMs: number;\n  maxMs: number;\n  throughputOpsPerSec: number;\n}\n\nasync function benchmark(\n  name: string,\n  fn: () => Promise<any>,\n  iterations: number = 100\n): Promise<BenchmarkResult> {\n  const latencies: number[] = [];\n\n  // Warmup\n  for (let i = 0; i < 5; i++) {\n    await fn();\n  }\n\n  // Benchmark\n  const startTime = Date.now();\n  for (let i = 0; i < iterations; i++) {\n    const start = performance.now();\n    await fn();\n    latencies.push(performance.now() - start);\n  }\n  const totalTime = Date.now() - startTime;\n\n  // Calculate percentiles\n  latencies.sort((a, b) => a - b);\n  const p50 = latencies[Math.floor(iterations * 0.5)];\n  const p95 = latencies[Math.floor(iterations * 0.95)];\n  const p99 = latencies[Math.floor(iterations * 0.99)];\n\n  return {\n    tool: name,\n    iterations,\n    avgLatencyMs: latencies.reduce((a, b) => a + b, 0) / iterations,\n    p50Ms: p50,\n    p95Ms: p95,\n    p99Ms: p99,\n    minMs: latencies[0],\n    maxMs: latencies[latencies.length - 1],\n    throughputOpsPerSec: (iterations / totalTime) * 1000\n  };\n}\n\nasync function runBenchmarks() {\n  console.log('ðŸš€ Hook Tools Benchmark\\n');\n  console.log('='.repeat(80));\n\n  const results: BenchmarkResult[] = [];\n\n  // Pre-edit benchmark\n  console.log('\\nðŸ“ Benchmarking hook_pre_edit...');\n  results.push(await benchmark('hook_pre_edit', async () => {\n    await hookPreEditTool.execute(\n      { filePath: 'src/index.ts', task: 'Fix bug' },\n      mockContext\n    );\n  }));\n\n  // Post-edit benchmark\n  console.log('ðŸ“ Benchmarking hook_post_edit...');\n  results.push(await benchmark('hook_post_edit', async () => {\n    await hookPostEditTool.execute(\n      { filePath: 'src/test.ts', success: true, agent: 'coder' },\n      mockContext\n    );\n  }));\n\n  // Pre-command benchmark\n  console.log('ðŸ“ Benchmarking hook_pre_command...');\n  results.push(await benchmark('hook_pre_command', async () => {\n    await hookPreCommandTool.execute(\n      { command: 'npm test' },\n      mockContext\n    );\n  }));\n\n  // Route benchmark\n  console.log('ðŸ“ Benchmarking hook_route...');\n  results.push(await benchmark('hook_route', async () => {\n    await hookRouteTool.execute(\n      { task: 'Implement authentication feature' },\n      mockContext\n    );\n  }));\n\n  // Metrics benchmark\n  console.log('ðŸ“ Benchmarking hook_metrics...');\n  results.push(await benchmark('hook_metrics', async () => {\n    await hookMetricsTool.execute(\n      { timeframe: '24h', detailed: false },\n      mockContext\n    );\n  }));\n\n  // Print results\n  console.log('\\n' + '='.repeat(80));\n  console.log('\\nðŸ“Š Results:\\n');\n\n  console.log('| Tool | Avg (ms) | P50 (ms) | P95 (ms) | P99 (ms) | Ops/sec |');\n  console.log('|------|----------|----------|----------|----------|---------|');\n\n  for (const r of results) {\n    console.log(\n      `| ${r.tool.padEnd(16)} | ${r.avgLatencyMs.toFixed(2).padStart(8)} | ` +\n      `${r.p50Ms.toFixed(2).padStart(8)} | ${r.p95Ms.toFixed(2).padStart(8)} | ` +\n      `${r.p99Ms.toFixed(2).padStart(8)} | ${r.throughputOpsPerSec.toFixed(0).padStart(7)} |`\n    );\n  }\n\n  // Latency targets check\n  console.log('\\n' + '='.repeat(80));\n  console.log('\\nâœ… Latency Target Check:\\n');\n\n  const targets: Record<string, number> = {\n    'hook_pre_edit': 20,\n    'hook_post_edit': 50,\n    'hook_pre_command': 10,\n    'hook_route': 30,\n    'hook_metrics': 50\n  };\n\n  let allPassed = true;\n  for (const r of results) {\n    const target = targets[r.tool] || 50;\n    const passed = r.p95Ms < target;\n    allPassed = allPassed && passed;\n    console.log(\n      `  ${passed ? 'âœ…' : 'âŒ'} ${r.tool}: P95=${r.p95Ms.toFixed(2)}ms ` +\n      `(target: <${target}ms) - ${passed ? 'PASS' : 'FAIL'}`\n    );\n  }\n\n  console.log('\\n' + '='.repeat(80));\n  console.log(`\\n${allPassed ? 'ðŸŽ‰ All latency targets met!' : 'âš ï¸  Some targets not met'}`);\n\n  // Return results for programmatic use\n  return results;\n}\n\n// Run if called directly\nrunBenchmarks().catch(console.error);\n\nexport { runBenchmarks, benchmark };\n"]}