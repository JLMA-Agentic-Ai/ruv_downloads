{"version":3,"file":"attention-coordinator.js","sourceRoot":"","sources":["../../src/coordination/attention-coordinator.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Attention-Based Multi-Agent Coordination\n *\n * Uses attention mechanisms for intelligent agent consensus, task routing,\n * and topology-aware coordination in multi-agent swarms.\n *\n * @module attention-coordinator\n * @version 2.0.0-alpha\n */\n\nimport type {\n  AttentionResult,\n  AttentionType,\n  GraphContext,\n} from '../types/agentdb.js';\n\n/**\n * Agent output with embedding\n */\nexport interface AgentOutput {\n  agentId: string;\n  agentType: string;\n  embedding: Float32Array;\n  value: any;\n  confidence?: number;\n  metadata?: Record<string, any>;\n}\n\n/**\n * Specialized agent with domain expertise\n */\nexport interface SpecializedAgent {\n  id: string;\n  type: string;\n  specialization: Float32Array; // Embedding of specialization\n  capabilities: string[];\n  load?: number;\n}\n\n/**\n * Task with embedding\n */\nexport interface Task {\n  id: string;\n  embedding: Float32Array;\n  description: string;\n  requirements?: string[];\n}\n\n/**\n * Swarm topology types\n */\nexport type SwarmTopology = 'mesh' | 'hierarchical' | 'ring' | 'star';\n\n/**\n * Coordination result\n */\nexport interface CoordinationResult {\n  consensus: any;\n  attentionWeights: number[];\n  mechanism: AttentionType;\n  executionTimeMs: number;\n  topAgents: string[];\n}\n\n/**\n * Expert routing result\n */\nexport interface ExpertRoutingResult {\n  selectedExperts: SpecializedAgent[];\n  routingScores: number[];\n  mechanism: 'moe' | 'attention';\n  executionTimeMs: number;\n}\n\n/**\n * Attention-based multi-agent coordinator\n *\n * @example Basic Consensus\n * ```typescript\n * const coordinator = new AttentionCoordinator(attentionService);\n *\n * const agentOutputs = [\n *   { agentId: 'agent-1', embedding: emb1, value: result1 },\n *   { agentId: 'agent-2', embedding: emb2, value: result2 },\n *   // ... more agents\n * ];\n *\n * const result = await coordinator.coordinateAgents(agentOutputs);\n * console.log(`Consensus: ${result.consensus}`);\n * console.log(`Top agents: ${result.topAgents}`);\n * ```\n *\n * @example Expert Routing (MoE)\n * ```typescript\n * const task = {\n *   id: 'task-1',\n *   embedding: taskEmbedding,\n *   description: 'Optimize database queries'\n * };\n *\n * const experts = await coordinator.routeToExperts(task, allAgents, 3);\n * console.log(`Selected experts: ${experts.selectedExperts.map(e => e.type)}`);\n * ```\n *\n * @example Topology-Aware Coordination\n * ```typescript\n * const result = await coordinator.topologyAwareCoordination(\n *   agentOutputs,\n *   'mesh', // or 'hierarchical', 'ring', 'star'\n *   graphStructure\n * );\n * ```\n */\nexport class AttentionCoordinator {\n  private attentionService: any;\n\n  constructor(attentionService: any) {\n    this.attentionService = attentionService;\n  }\n\n  /**\n   * Coordinate agents using attention-based consensus\n   *\n   * Uses multi-head attention to weight agent contributions based on\n   * relevance and confidence. Better than simple voting or averaging.\n   *\n   * @param agentOutputs - Outputs from multiple agents\n   * @param mechanism - Attention mechanism to use (default: 'flash')\n   * @returns Coordination result with weighted consensus\n   */\n  async coordinateAgents(\n    agentOutputs: AgentOutput[],\n    mechanism: AttentionType = 'flash'\n  ): Promise<CoordinationResult> {\n    if (agentOutputs.length === 0) {\n      throw new Error('No agent outputs to coordinate');\n    }\n\n    const startTime = Date.now();\n\n    // Stack embeddings into tensors\n    const Q = this.stackEmbeddings(agentOutputs.map((o) => o.embedding));\n    const K = Q; // Self-attention over agent outputs\n    const V = Q;\n\n    // Run attention mechanism\n    let attentionResult: AttentionResult;\n    switch (mechanism) {\n      case 'flash':\n        attentionResult = await this.attentionService.flashAttention(Q, K, V);\n        break;\n      case 'multi-head':\n        attentionResult = await this.attentionService.multiHeadAttention(Q, K, V);\n        break;\n      default:\n        attentionResult = await this.attentionService.flashAttention(Q, K, V);\n    }\n\n    // Extract attention weights for each agent\n    const weights = this.extractAttentionWeights(\n      attentionResult.attentionWeights || attentionResult.output,\n      agentOutputs.length\n    );\n\n    // Compute weighted consensus\n    const consensus = this.weightedConsensus(agentOutputs, weights);\n\n    // Identify top contributing agents\n    const topAgents = agentOutputs\n      .map((output, i) => ({ agentId: output.agentId, weight: weights[i] }))\n      .sort((a, b) => b.weight - a.weight)\n      .slice(0, 3)\n      .map((a) => a.agentId);\n\n    const executionTimeMs = Date.now() - startTime;\n\n    return {\n      consensus,\n      attentionWeights: weights,\n      mechanism,\n      executionTimeMs,\n      topAgents,\n    };\n  }\n\n  /**\n   * Route tasks to specialized experts using MoE attention\n   *\n   * Uses Mixture-of-Experts attention to select top-k agents\n   * best suited for a given task.\n   *\n   * @param task - Task to route\n   * @param agents - Available specialized agents\n   * @param topK - Number of experts to select (default: 3)\n   * @returns Selected experts with routing scores\n   */\n  async routeToExperts(\n    task: Task,\n    agents: SpecializedAgent[],\n    topK: number = 3\n  ): Promise<ExpertRoutingResult> {\n    if (agents.length === 0) {\n      throw new Error('No agents available for routing');\n    }\n\n    const startTime = Date.now();\n\n    // Task embedding as query\n    const Q = task.embedding;\n\n    // Agent specializations as keys and values\n    const K = this.stackEmbeddings(agents.map((a) => a.specialization));\n    const V = K;\n\n    // MoE attention for expert selection\n    const attentionResult = await this.attentionService.moeAttention(\n      Q,\n      K,\n      V,\n      agents.length\n    );\n\n    // Extract routing scores\n    const scores = this.extractRoutingScores(\n      attentionResult.attentionWeights || attentionResult.output,\n      agents.length\n    );\n\n    // Select top-k experts\n    const expertsWithScores = agents.map((agent, i) => ({\n      agent,\n      score: scores[i],\n    }));\n\n    expertsWithScores.sort((a, b) => b.score - a.score);\n\n    const selectedExperts = expertsWithScores.slice(0, topK).map((e) => e.agent);\n    const routingScores = expertsWithScores.slice(0, topK).map((e) => e.score);\n\n    const executionTimeMs = Date.now() - startTime;\n\n    return {\n      selectedExperts,\n      routingScores,\n      mechanism: 'moe',\n      executionTimeMs,\n    };\n  }\n\n  /**\n   * Topology-aware agent coordination using GraphRoPE\n   *\n   * Uses graph-aware positional embeddings to coordinate agents\n   * based on their position in the swarm topology (mesh, hierarchical, etc.)\n   *\n   * @param agentOutputs - Agent outputs\n   * @param topology - Swarm topology type\n   * @param graphStructure - Graph structure of agent network\n   * @returns Coordination result with topology-aware weights\n   */\n  async topologyAwareCoordination(\n    agentOutputs: AgentOutput[],\n    topology: SwarmTopology,\n    graphStructure?: GraphContext\n  ): Promise<CoordinationResult> {\n    const startTime = Date.now();\n\n    // Build graph structure from topology if not provided\n    const graph = graphStructure || this.buildTopologyGraph(agentOutputs, topology);\n\n    // Stack embeddings\n    const Q = this.stackEmbeddings(agentOutputs.map((o) => o.embedding));\n    const K = Q;\n    const V = Q;\n\n    // GraphRoPE attention preserves topological relationships\n    const attentionResult = await this.attentionService.graphRoPEAttention(\n      Q,\n      K,\n      V,\n      graph\n    );\n\n    // Extract topology-aware weights\n    const weights = this.extractAttentionWeights(\n      attentionResult.attentionWeights || attentionResult.output,\n      agentOutputs.length\n    );\n\n    // Apply topology bias (agents closer in topology get higher weights)\n    const biasedWeights = this.applyTopologyBias(weights, topology, graph);\n\n    // Weighted consensus\n    const consensus = this.weightedConsensus(agentOutputs, biasedWeights);\n\n    // Top agents\n    const topAgents = agentOutputs\n      .map((output, i) => ({ agentId: output.agentId, weight: biasedWeights[i] }))\n      .sort((a, b) => b.weight - a.weight)\n      .slice(0, 3)\n      .map((a) => a.agentId);\n\n    const executionTimeMs = Date.now() - startTime;\n\n    return {\n      consensus,\n      attentionWeights: biasedWeights,\n      mechanism: 'graph-rope',\n      executionTimeMs,\n      topAgents,\n    };\n  }\n\n  /**\n   * Hierarchical coordination for queen-worker swarms\n   *\n   * Uses hyperbolic attention to model hierarchical relationships\n   * where queen/coordinator agents have higher curvature.\n   *\n   * @param queenOutputs - Outputs from queen/coordinator agents\n   * @param workerOutputs - Outputs from worker agents\n   * @param curvature - Hyperbolic curvature (-1.0 = strong hierarchy)\n   * @returns Hierarchical coordination result\n   */\n  async hierarchicalCoordination(\n    queenOutputs: AgentOutput[],\n    workerOutputs: AgentOutput[],\n    curvature: number = -1.0\n  ): Promise<CoordinationResult> {\n    const startTime = Date.now();\n\n    // Queens and workers in separate groups\n    const allOutputs = [...queenOutputs, ...workerOutputs];\n\n    // Stack embeddings\n    const Q = this.stackEmbeddings(queenOutputs.map((o) => o.embedding)); // Queens query\n    const K = this.stackEmbeddings(allOutputs.map((o) => o.embedding)); // All agents as keys\n    const V = K;\n\n    // Hyperbolic attention models hierarchical relationships\n    const attentionResult = await this.attentionService.hyperbolicAttention(\n      Q,\n      K,\n      V,\n      curvature\n    );\n\n    // Extract weights\n    const weights = this.extractAttentionWeights(\n      attentionResult.attentionWeights || attentionResult.output,\n      allOutputs.length\n    );\n\n    // Queens have higher influence in hierarchical structure\n    const hierarchicalWeights = weights.map((w, i) => {\n      const isQueen = i < queenOutputs.length;\n      return isQueen ? w * 1.5 : w; // Boost queen weights\n    });\n\n    // Normalize\n    const sumWeights = hierarchicalWeights.reduce((a, b) => a + b, 0);\n    const normalizedWeights = hierarchicalWeights.map((w) => w / sumWeights);\n\n    // Weighted consensus\n    const consensus = this.weightedConsensus(allOutputs, normalizedWeights);\n\n    // Top agents\n    const topAgents = allOutputs\n      .map((output, i) => ({ agentId: output.agentId, weight: normalizedWeights[i] }))\n      .sort((a, b) => b.weight - a.weight)\n      .slice(0, 3)\n      .map((a) => a.agentId);\n\n    const executionTimeMs = Date.now() - startTime;\n\n    return {\n      consensus,\n      attentionWeights: normalizedWeights,\n      mechanism: 'hyperbolic',\n      executionTimeMs,\n      topAgents,\n    };\n  }\n\n  // ============================================\n  // UTILITY FUNCTIONS\n  // ============================================\n\n  /**\n   * Stack multiple embeddings into single tensor\n   */\n  private stackEmbeddings(embeddings: Float32Array[]): Float32Array {\n    const total = embeddings.reduce((sum, e) => sum + e.length, 0);\n    const stacked = new Float32Array(total);\n\n    let offset = 0;\n    for (const emb of embeddings) {\n      stacked.set(emb, offset);\n      offset += emb.length;\n    }\n\n    return stacked;\n  }\n\n  /**\n   * Extract attention weights from attention output\n   */\n  private extractAttentionWeights(output: Float32Array, numAgents: number): number[] {\n    // Simplified: average across dimensions\n    const dim = output.length / numAgents;\n    const weights: number[] = [];\n\n    for (let i = 0; i < numAgents; i++) {\n      const slice = output.slice(i * dim, (i + 1) * dim);\n      const avgWeight = slice.reduce((a, b) => a + b, 0) / slice.length;\n      weights.push(avgWeight);\n    }\n\n    // Normalize to sum to 1\n    const sum = weights.reduce((a, b) => a + b, 0);\n    return weights.map((w) => w / sum);\n  }\n\n  /**\n   * Extract routing scores for expert selection\n   */\n  private extractRoutingScores(output: Float32Array, numAgents: number): number[] {\n    // For MoE, use softmax-like scoring\n    const scores = this.extractAttentionWeights(output, numAgents);\n\n    // Apply softmax for clearer expert selection\n    const expScores = scores.map((s) => Math.exp(s * 10)); // Temperature = 10\n    const sumExp = expScores.reduce((a, b) => a + b, 0);\n\n    return expScores.map((s) => s / sumExp);\n  }\n\n  /**\n   * Compute weighted consensus from agent outputs\n   */\n  private weightedConsensus(outputs: AgentOutput[], weights: number[]): any {\n    // If outputs are numeric, compute weighted average\n    if (typeof outputs[0].value === 'number') {\n      return outputs.reduce((sum, output, i) => sum + output.value * weights[i], 0);\n    }\n\n    // If outputs are arrays, compute element-wise weighted average\n    if (Array.isArray(outputs[0].value)) {\n      const length = outputs[0].value.length;\n      const weighted = new Array(length).fill(0);\n\n      for (let i = 0; i < outputs.length; i++) {\n        for (let j = 0; j < length; j++) {\n          weighted[j] += outputs[i].value[j] * weights[i];\n        }\n      }\n\n      return weighted;\n    }\n\n    // For objects or complex types, return most weighted output\n    const maxWeightIndex = weights.indexOf(Math.max(...weights));\n    return outputs[maxWeightIndex].value;\n  }\n\n  /**\n   * Build graph structure from swarm topology\n   */\n  private buildTopologyGraph(outputs: AgentOutput[], topology: SwarmTopology): GraphContext {\n    const nodes = outputs.map((o) => o.embedding);\n    const edges: [number, number][] = [];\n\n    switch (topology) {\n      case 'mesh':\n        // Fully connected mesh\n        for (let i = 0; i < outputs.length; i++) {\n          for (let j = i + 1; j < outputs.length; j++) {\n            edges.push([i, j]);\n          }\n        }\n        break;\n\n      case 'hierarchical':\n        // Queen (0) connects to all workers\n        for (let i = 1; i < outputs.length; i++) {\n          edges.push([0, i]);\n        }\n        break;\n\n      case 'ring':\n        // Ring topology\n        for (let i = 0; i < outputs.length; i++) {\n          edges.push([i, (i + 1) % outputs.length]);\n        }\n        break;\n\n      case 'star':\n        // Star topology (central coordinator)\n        const center = 0;\n        for (let i = 1; i < outputs.length; i++) {\n          edges.push([center, i]);\n        }\n        break;\n    }\n\n    return { nodes, edges };\n  }\n\n  /**\n   * Apply topology bias to attention weights\n   */\n  private applyTopologyBias(\n    weights: number[],\n    topology: SwarmTopology,\n    graph: GraphContext\n  ): number[] {\n    // Agents with more connections get slight boost\n    const connectionCounts = new Array(weights.length).fill(0);\n\n    for (const [src, dst] of graph.edges) {\n      connectionCounts[src]++;\n      connectionCounts[dst]++;\n    }\n\n    const maxConnections = Math.max(...connectionCounts);\n\n    return weights.map((w, i) => {\n      const connectivityBoost = connectionCounts[i] / maxConnections;\n      return w * (1 + connectivityBoost * 0.1); // 10% boost for well-connected agents\n    });\n  }\n}\n\n/**\n * Create attention coordinator from attention service\n */\nexport function createAttentionCoordinator(attentionService: any): AttentionCoordinator {\n  return new AttentionCoordinator(attentionService);\n}\n"]}