{"version":3,"file":"query-control.js","sourceRoot":"","sources":["../../src/sdk/query-control.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Query Control - Runtime control of active queries\n *\n * Provides methods to control running queries:\n * - Change model mid-execution\n * - Switch permission modes\n * - Interrupt/abort queries\n * - Get query status and introspection\n */\n\nimport { logger } from \"../utils/logger.js\";\n\n/**\n * Query state for tracking active queries\n */\nexport interface QueryState {\n  id: string;\n  startTime: number;\n  model: string;\n  permissionMode: string;\n  status: 'running' | 'paused' | 'completed' | 'aborted' | 'error';\n  turnCount: number;\n  tokenCount: number;\n  costUsd: number;\n  abortController: AbortController;\n}\n\n/**\n * Model options for runtime switching\n */\nexport type ModelOption =\n  | 'claude-opus-4-5-20251101'\n  | 'claude-sonnet-4-5-20250929'\n  | 'claude-haiku-3-5-20241022'\n  | 'inherit';\n\n/**\n * Permission mode options\n */\nexport type PermissionModeOption = 'default' | 'acceptEdits' | 'bypassPermissions' | 'plan';\n\n// Active queries registry\nconst activeQueries = new Map<string, QueryState>();\n\n// Query counter for ID generation\nlet queryCounter = 0;\n\n/**\n * Create a new query controller\n */\nexport function createQueryController(options: {\n  model: string;\n  permissionMode?: string;\n}): QueryController {\n  const id = `query-${Date.now()}-${++queryCounter}`;\n  const abortController = new AbortController();\n\n  const state: QueryState = {\n    id,\n    startTime: Date.now(),\n    model: options.model,\n    permissionMode: options.permissionMode || 'default',\n    status: 'running',\n    turnCount: 0,\n    tokenCount: 0,\n    costUsd: 0,\n    abortController\n  };\n\n  activeQueries.set(id, state);\n\n  logger.info('Query controller created', { id, model: options.model });\n\n  return new QueryController(state);\n}\n\n/**\n * Query Controller - controls a single active query\n */\nexport class QueryController {\n  private state: QueryState;\n  private modelChangeCallbacks: Array<(model: string) => void> = [];\n  private permissionChangeCallbacks: Array<(mode: string) => void> = [];\n\n  constructor(state: QueryState) {\n    this.state = state;\n  }\n\n  /**\n   * Get query ID\n   */\n  get id(): string {\n    return this.state.id;\n  }\n\n  /**\n   * Get abort signal for SDK integration\n   */\n  get signal(): AbortSignal {\n    return this.state.abortController.signal;\n  }\n\n  /**\n   * Get current status\n   */\n  getStatus(): QueryState {\n    return { ...this.state };\n  }\n\n  /**\n   * Change model at runtime\n   * Note: SDK must support this via setModel() method\n   */\n  async setModel(model: ModelOption): Promise<boolean> {\n    if (this.state.status !== 'running') {\n      logger.warn('Cannot change model on non-running query', { id: this.state.id, status: this.state.status });\n      return false;\n    }\n\n    const oldModel = this.state.model;\n    this.state.model = model;\n\n    // Notify callbacks\n    for (const callback of this.modelChangeCallbacks) {\n      try {\n        callback(model);\n      } catch (error) {\n        logger.warn('Model change callback error', { error: (error as Error).message });\n      }\n    }\n\n    logger.info('Model changed', { id: this.state.id, oldModel, newModel: model });\n    return true;\n  }\n\n  /**\n   * Change permission mode at runtime\n   */\n  async setPermissionMode(mode: PermissionModeOption): Promise<boolean> {\n    if (this.state.status !== 'running') {\n      logger.warn('Cannot change permissions on non-running query', { id: this.state.id });\n      return false;\n    }\n\n    const oldMode = this.state.permissionMode;\n    this.state.permissionMode = mode;\n\n    // Notify callbacks\n    for (const callback of this.permissionChangeCallbacks) {\n      try {\n        callback(mode);\n      } catch (error) {\n        logger.warn('Permission change callback error', { error: (error as Error).message });\n      }\n    }\n\n    logger.info('Permission mode changed', { id: this.state.id, oldMode, newMode: mode });\n    return true;\n  }\n\n  /**\n   * Set max thinking tokens\n   */\n  async setMaxThinkingTokens(tokens: number): Promise<boolean> {\n    if (this.state.status !== 'running') return false;\n\n    logger.info('Max thinking tokens set', { id: this.state.id, tokens });\n    return true;\n  }\n\n  /**\n   * Interrupt the query (for streaming mode)\n   */\n  interrupt(): void {\n    if (this.state.status === 'running') {\n      this.state.status = 'paused';\n      logger.info('Query interrupted', { id: this.state.id });\n    }\n  }\n\n  /**\n   * Resume interrupted query\n   */\n  resume(): void {\n    if (this.state.status === 'paused') {\n      this.state.status = 'running';\n      logger.info('Query resumed', { id: this.state.id });\n    }\n  }\n\n  /**\n   * Abort the query completely\n   */\n  abort(): void {\n    if (this.state.status === 'running' || this.state.status === 'paused') {\n      this.state.abortController.abort();\n      this.state.status = 'aborted';\n      logger.info('Query aborted', { id: this.state.id });\n    }\n  }\n\n  /**\n   * Mark query as completed\n   */\n  complete(result?: { tokenCount?: number; costUsd?: number }): void {\n    this.state.status = 'completed';\n    if (result?.tokenCount) this.state.tokenCount = result.tokenCount;\n    if (result?.costUsd) this.state.costUsd = result.costUsd;\n\n    activeQueries.delete(this.state.id);\n    logger.info('Query completed', {\n      id: this.state.id,\n      duration: Date.now() - this.state.startTime,\n      turns: this.state.turnCount\n    });\n  }\n\n  /**\n   * Mark query as errored\n   */\n  error(message: string): void {\n    this.state.status = 'error';\n    activeQueries.delete(this.state.id);\n    logger.error('Query error', { id: this.state.id, message });\n  }\n\n  /**\n   * Increment turn count\n   */\n  incrementTurn(): void {\n    this.state.turnCount++;\n  }\n\n  /**\n   * Add model change callback\n   */\n  onModelChange(callback: (model: string) => void): void {\n    this.modelChangeCallbacks.push(callback);\n  }\n\n  /**\n   * Add permission change callback\n   */\n  onPermissionChange(callback: (mode: string) => void): void {\n    this.permissionChangeCallbacks.push(callback);\n  }\n\n  /**\n   * Get supported commands (introspection)\n   */\n  async supportedCommands(): Promise<string[]> {\n    return [\n      '/help', '/clear', '/compact', '/config', '/cost',\n      '/doctor', '/login', '/logout', '/memory', '/mcp',\n      '/model', '/permissions', '/review', '/terminal', '/vim'\n    ];\n  }\n\n  /**\n   * Get supported models (introspection)\n   */\n  async supportedModels(): Promise<string[]> {\n    return [\n      'claude-opus-4-5-20251101',\n      'claude-sonnet-4-5-20250929',\n      'claude-haiku-3-5-20241022'\n    ];\n  }\n\n  /**\n   * Get MCP server status\n   */\n  async mcpServerStatus(): Promise<Record<string, { connected: boolean; tools: number }>> {\n    // This would be populated by actual MCP server connections\n    return {\n      'claude-flow': { connected: true, tools: 213 },\n      'flow-nexus': { connected: true, tools: 45 }\n    };\n  }\n\n  /**\n   * Get account info\n   */\n  async accountInfo(): Promise<{\n    tier: string;\n    usage: { tokens: number; cost: number };\n    limits: { maxTokens: number; maxCost: number };\n  }> {\n    return {\n      tier: process.env.ANTHROPIC_TIER || 'unknown',\n      usage: {\n        tokens: this.state.tokenCount,\n        cost: this.state.costUsd\n      },\n      limits: {\n        maxTokens: parseInt(process.env.SDK_MAX_TOKENS || '100000'),\n        maxCost: parseFloat(process.env.SDK_MAX_BUDGET_USD || '10.00')\n      }\n    };\n  }\n}\n\n/**\n * Get all active queries\n */\nexport function getActiveQueries(): QueryState[] {\n  return Array.from(activeQueries.values());\n}\n\n/**\n * Get query by ID\n */\nexport function getQuery(id: string): QueryController | null {\n  const state = activeQueries.get(id);\n  if (!state) return null;\n  return new QueryController(state);\n}\n\n/**\n * Abort all active queries\n */\nexport function abortAllQueries(): void {\n  for (const state of activeQueries.values()) {\n    state.abortController.abort();\n    state.status = 'aborted';\n  }\n  activeQueries.clear();\n  logger.info('All queries aborted', { count: activeQueries.size });\n}\n\n/**\n * Get query statistics\n */\nexport function getQueryStats(): {\n  active: number;\n  total: number;\n  totalTokens: number;\n  totalCost: number;\n} {\n  const queries = Array.from(activeQueries.values());\n  return {\n    active: queries.filter(q => q.status === 'running').length,\n    total: queryCounter,\n    totalTokens: queries.reduce((sum, q) => sum + q.tokenCount, 0),\n    totalCost: queries.reduce((sum, q) => sum + q.costUsd, 0)\n  };\n}\n"]}