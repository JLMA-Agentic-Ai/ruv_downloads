{"version":3,"file":"e2b-sandbox.js","sourceRoot":"","sources":["../../src/sdk/e2b-sandbox.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * E2B Sandbox Integration - Secure cloud sandboxes for AI code execution\n *\n * Provides isolated execution environments using E2B's Firecracker-based sandboxes.\n * Supports Python, JavaScript, and shell code execution with file system access.\n *\n * @see https://e2b.dev/docs\n */\n\nimport { logger } from \"../utils/logger.js\";\n\n/**\n * E2B Sandbox configuration\n */\nexport interface E2BSandboxConfig {\n  apiKey?: string;\n  template?: string;           // Sandbox template (default: 'base')\n  timeout?: number;           // Sandbox timeout in ms (default: 300000 = 5min)\n  cwd?: string;               // Working directory\n  envVars?: Record<string, string>;\n  metadata?: Record<string, string>;\n}\n\n/**\n * Code execution result\n */\nexport interface ExecutionResult {\n  success: boolean;\n  output: string;\n  error?: string;\n  exitCode?: number;\n  logs: string[];\n  artifacts?: string[];\n}\n\n/**\n * File operation result\n */\nexport interface FileResult {\n  success: boolean;\n  path: string;\n  content?: string;\n  error?: string;\n}\n\n// Lazy-loaded E2B SDK\nlet e2bModule: any = null;\nlet codeInterpreterModule: any = null;\n\n/**\n * Initialize E2B SDK (lazy load)\n */\nasync function getE2B(): Promise<any> {\n  if (!e2bModule) {\n    try {\n      e2bModule = await import('e2b');\n    } catch (error) {\n      logger.warn('E2B SDK not installed. Run: npm install e2b @e2b/code-interpreter');\n      return null;\n    }\n  }\n  return e2bModule;\n}\n\n/**\n * Initialize Code Interpreter SDK (lazy load)\n */\nasync function getCodeInterpreter(): Promise<any> {\n  if (!codeInterpreterModule) {\n    try {\n      codeInterpreterModule = await import('@e2b/code-interpreter');\n    } catch (error) {\n      logger.warn('E2B Code Interpreter not installed. Run: npm install @e2b/code-interpreter');\n      return null;\n    }\n  }\n  return codeInterpreterModule;\n}\n\n/**\n * E2B Sandbox Manager - manages sandbox lifecycle and execution\n */\nexport class E2BSandboxManager {\n  private sandbox: any = null;\n  private config: E2BSandboxConfig;\n  private isCodeInterpreter: boolean = false;\n\n  constructor(config: E2BSandboxConfig = {}) {\n    this.config = {\n      apiKey: config.apiKey || process.env.E2B_API_KEY,\n      template: config.template || 'base',\n      timeout: config.timeout || 300000,\n      cwd: config.cwd || '/home/user',\n      envVars: config.envVars || {},\n      metadata: config.metadata || {}\n    };\n  }\n\n  /**\n   * Create and start a new sandbox\n   */\n  async create(useCodeInterpreter: boolean = true): Promise<boolean> {\n    try {\n      if (!this.config.apiKey) {\n        logger.error('E2B_API_KEY not configured');\n        return false;\n      }\n\n      if (useCodeInterpreter) {\n        const ci = await getCodeInterpreter();\n        if (!ci) return false;\n\n        this.sandbox = await ci.Sandbox.create({\n          apiKey: this.config.apiKey,\n          timeout: this.config.timeout,\n          metadata: this.config.metadata,\n          envVars: this.config.envVars\n        });\n        this.isCodeInterpreter = true;\n      } else {\n        const e2b = await getE2B();\n        if (!e2b) return false;\n\n        this.sandbox = await e2b.Sandbox.create({\n          apiKey: this.config.apiKey,\n          template: this.config.template,\n          timeout: this.config.timeout,\n          metadata: this.config.metadata,\n          envVars: this.config.envVars\n        });\n        this.isCodeInterpreter = false;\n      }\n\n      logger.info('E2B sandbox created', {\n        id: this.sandbox.sandboxId,\n        type: useCodeInterpreter ? 'code-interpreter' : 'base'\n      });\n\n      return true;\n    } catch (error) {\n      logger.error('Failed to create E2B sandbox', { error: (error as Error).message });\n      return false;\n    }\n  }\n\n  /**\n   * Run Python code in the sandbox\n   */\n  async runPython(code: string): Promise<ExecutionResult> {\n    if (!this.sandbox) {\n      return { success: false, output: '', error: 'Sandbox not initialized', logs: [] };\n    }\n\n    try {\n      if (this.isCodeInterpreter) {\n        const result = await this.sandbox.runCode(code);\n\n        // Extract logs from various formats\n        const logs: string[] = [];\n        if (Array.isArray(result.logs)) {\n          for (const log of result.logs) {\n            if (typeof log === 'string') {\n              logs.push(log);\n            } else if (log?.line) {\n              logs.push(log.line);\n            } else if (log?.text) {\n              logs.push(log.text);\n            } else if (log?.type === 'stdout' && log?.text) {\n              logs.push(log.text);\n            } else {\n              logs.push(String(log));\n            }\n          }\n        }\n\n        // Extract artifacts\n        const artifacts = Array.isArray(result.artifacts)\n          ? result.artifacts.map((a: any) => typeof a === 'string' ? a : a?.path || String(a))\n          : [];\n\n        // Build output from multiple sources (improved capture)\n        let output = '';\n\n        // Check result.text first (primary output)\n        if (result.text) {\n          output = result.text;\n        }\n        // Check result.output\n        else if (result.output) {\n          output = result.output;\n        }\n        // Check result.results array (Code Interpreter returns this)\n        else if (Array.isArray(result.results) && result.results.length > 0) {\n          output = result.results\n            .map((r: any) => r?.text || r?.html || r?.data || String(r))\n            .join('\\n');\n        }\n        // Fall back to joined logs\n        else if (logs.length > 0) {\n          output = logs.join('\\n');\n        }\n\n        return {\n          success: !result.error,\n          output,\n          error: result.error?.message || result.error?.name || (typeof result.error === 'string' ? result.error : undefined),\n          logs,\n          artifacts\n        };\n      } else {\n        // Use shell for base sandbox (more reliable output)\n        const proc = await this.sandbox.process.start({\n          cmd: 'python3',\n          args: ['-c', code],\n          cwd: this.config.cwd\n        });\n        await proc.wait();\n        return {\n          success: proc.exitCode === 0,\n          output: proc.stdout || '',\n          error: proc.stderr || undefined,\n          exitCode: proc.exitCode,\n          logs: []\n        };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        output: '',\n        error: (error as Error).message,\n        logs: []\n      };\n    }\n  }\n\n  /**\n   * Run JavaScript/TypeScript code in the sandbox\n   */\n  async runJavaScript(code: string): Promise<ExecutionResult> {\n    if (!this.sandbox) {\n      return { success: false, output: '', error: 'Sandbox not initialized', logs: [] };\n    }\n\n    try {\n      // Check if sandbox has process API (base sandbox) or use commands API\n      if (this.sandbox.process?.start) {\n        const proc = await this.sandbox.process.start({\n          cmd: 'node',\n          args: ['-e', code],\n          cwd: this.config.cwd\n        });\n        await proc.wait();\n        return {\n          success: proc.exitCode === 0,\n          output: proc.stdout || '',\n          error: proc.stderr || undefined,\n          exitCode: proc.exitCode,\n          logs: []\n        };\n      } else if (this.sandbox.commands?.run) {\n        const result = await this.sandbox.commands.run(`node -e '${code.replace(/'/g, \"\\\\'\")}'`);\n        return {\n          success: result.exitCode === 0,\n          output: result.stdout || '',\n          error: result.stderr || undefined,\n          exitCode: result.exitCode,\n          logs: []\n        };\n      } else {\n        return { success: false, output: '', error: 'No execution API available', logs: [] };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        output: '',\n        error: (error as Error).message,\n        logs: []\n      };\n    }\n  }\n\n  /**\n   * Run shell command in the sandbox\n   */\n  async runCommand(command: string, args: string[] = []): Promise<ExecutionResult> {\n    if (!this.sandbox) {\n      return { success: false, output: '', error: 'Sandbox not initialized', logs: [] };\n    }\n\n    try {\n      // Check if sandbox has process API (base sandbox) or use commands API\n      if (this.sandbox.process?.start) {\n        const proc = await this.sandbox.process.start({\n          cmd: command,\n          args,\n          cwd: this.config.cwd\n        });\n        await proc.wait();\n        return {\n          success: proc.exitCode === 0,\n          output: proc.stdout || '',\n          error: proc.stderr || undefined,\n          exitCode: proc.exitCode,\n          logs: []\n        };\n      } else if (this.sandbox.commands?.run) {\n        const fullCmd = args.length > 0 ? `${command} ${args.join(' ')}` : command;\n        const result = await this.sandbox.commands.run(fullCmd);\n        return {\n          success: result.exitCode === 0,\n          output: result.stdout || '',\n          error: result.stderr || undefined,\n          exitCode: result.exitCode,\n          logs: []\n        };\n      } else {\n        return { success: false, output: '', error: 'No execution API available', logs: [] };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        output: '',\n        error: (error as Error).message,\n        logs: []\n      };\n    }\n  }\n\n  /**\n   * Write file to sandbox\n   */\n  async writeFile(path: string, content: string): Promise<FileResult> {\n    if (!this.sandbox) {\n      return { success: false, path, error: 'Sandbox not initialized' };\n    }\n\n    try {\n      await this.sandbox.filesystem.write(path, content);\n      return { success: true, path };\n    } catch (error) {\n      return { success: false, path, error: (error as Error).message };\n    }\n  }\n\n  /**\n   * Read file from sandbox\n   */\n  async readFile(path: string): Promise<FileResult> {\n    if (!this.sandbox) {\n      return { success: false, path, error: 'Sandbox not initialized' };\n    }\n\n    try {\n      const content = await this.sandbox.filesystem.read(path);\n      return { success: true, path, content };\n    } catch (error) {\n      return { success: false, path, error: (error as Error).message };\n    }\n  }\n\n  /**\n   * List files in sandbox directory\n   */\n  async listFiles(path: string = '/'): Promise<string[]> {\n    if (!this.sandbox) {\n      return [];\n    }\n\n    try {\n      const files = await this.sandbox.filesystem.list(path);\n      return files.map((f: any) => f.name);\n    } catch (error) {\n      logger.warn('Failed to list files', { path, error: (error as Error).message });\n      return [];\n    }\n  }\n\n  /**\n   * Install packages in sandbox\n   */\n  async installPackages(packages: string[], manager: 'pip' | 'npm' = 'pip'): Promise<ExecutionResult> {\n    const cmd = manager === 'pip' ? 'pip' : 'npm';\n    const args = manager === 'pip' ? ['install', ...packages] : ['install', ...packages];\n\n    return this.runCommand(cmd, args);\n  }\n\n  /**\n   * Get sandbox ID\n   */\n  getSandboxId(): string | null {\n    return this.sandbox?.sandboxId || null;\n  }\n\n  /**\n   * Keep sandbox alive (extend timeout)\n   */\n  async keepAlive(duration: number = 300000): Promise<boolean> {\n    if (!this.sandbox) return false;\n\n    try {\n      await this.sandbox.keepAlive(duration);\n      return true;\n    } catch (error) {\n      logger.warn('Failed to keep sandbox alive', { error: (error as Error).message });\n      return false;\n    }\n  }\n\n  /**\n   * Close and destroy sandbox\n   */\n  async close(): Promise<void> {\n    if (this.sandbox) {\n      try {\n        await this.sandbox.kill();\n        logger.info('E2B sandbox closed', { id: this.sandbox.sandboxId });\n      } catch (error) {\n        logger.warn('Error closing sandbox', { error: (error as Error).message });\n      }\n      this.sandbox = null;\n    }\n  }\n}\n\n// Singleton instance for convenience\nlet defaultSandbox: E2BSandboxManager | null = null;\n\n/**\n * Get or create the default sandbox manager\n */\nexport function getE2BSandbox(config?: E2BSandboxConfig): E2BSandboxManager {\n  if (!defaultSandbox) {\n    defaultSandbox = new E2BSandboxManager(config);\n  }\n  return defaultSandbox;\n}\n\n/**\n * Quick helper to run code in E2B sandbox\n */\nexport async function runInE2BSandbox(\n  code: string,\n  language: 'python' | 'javascript' | 'shell' = 'python'\n): Promise<ExecutionResult> {\n  const sandbox = getE2BSandbox();\n\n  // Create if not exists\n  if (!sandbox.getSandboxId()) {\n    const created = await sandbox.create(language === 'python');\n    if (!created) {\n      return { success: false, output: '', error: 'Failed to create sandbox', logs: [] };\n    }\n  }\n\n  switch (language) {\n    case 'python':\n      return sandbox.runPython(code);\n    case 'javascript':\n      return sandbox.runJavaScript(code);\n    case 'shell':\n      return sandbox.runCommand('sh', ['-c', code]);\n  }\n}\n\n/**\n * Check if E2B is available\n */\nexport async function isE2BAvailable(): Promise<boolean> {\n  const e2b = await getE2B();\n  return e2b !== null && !!process.env.E2B_API_KEY;\n}\n"]}