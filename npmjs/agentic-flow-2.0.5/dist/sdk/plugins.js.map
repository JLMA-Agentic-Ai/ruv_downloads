{"version":3,"file":"plugins.js","sourceRoot":"","sources":["../../src/sdk/plugins.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Plugins System - Load and manage Claude Agent SDK plugins\n *\n * Supports loading plugins from:\n * - Local filesystem\n * - NPM packages\n * - Remote URLs\n * - In-memory definitions\n */\n\nimport { logger } from \"../utils/logger.js\";\nimport { existsSync, readFileSync } from \"fs\";\nimport { join, resolve, dirname } from \"path\";\n\n/**\n * Plugin configuration types\n */\nexport interface LocalPluginConfig {\n  type: 'local';\n  path: string;\n}\n\nexport interface NpmPluginConfig {\n  type: 'npm';\n  package: string;\n  version?: string;\n}\n\nexport interface RemotePluginConfig {\n  type: 'remote';\n  url: string;\n  checksum?: string;\n}\n\nexport interface InlinePluginConfig {\n  type: 'inline';\n  name: string;\n  tools: PluginTool[];\n}\n\nexport type PluginConfig = LocalPluginConfig | NpmPluginConfig | RemotePluginConfig | InlinePluginConfig;\n\n/**\n * Plugin tool definition\n */\nexport interface PluginTool {\n  name: string;\n  description: string;\n  inputSchema: Record<string, any>;\n  handler: (input: any) => Promise<any>;\n}\n\n/**\n * Loaded plugin instance\n */\nexport interface LoadedPlugin {\n  name: string;\n  version: string;\n  source: string;\n  tools: PluginTool[];\n  enabled: boolean;\n  loadedAt: number;\n}\n\n// Plugin registry\nconst loadedPlugins = new Map<string, LoadedPlugin>();\n\n/**\n * Load a plugin from configuration\n */\nexport async function loadPlugin(config: PluginConfig): Promise<LoadedPlugin | null> {\n  try {\n    switch (config.type) {\n      case 'local':\n        return await loadLocalPlugin(config);\n      case 'npm':\n        return await loadNpmPlugin(config);\n      case 'remote':\n        return await loadRemotePlugin(config);\n      case 'inline':\n        return loadInlinePlugin(config);\n      default:\n        logger.error('Unknown plugin type', { config });\n        return null;\n    }\n  } catch (error) {\n    logger.error('Failed to load plugin', { config, error: (error as Error).message });\n    return null;\n  }\n}\n\n/**\n * Load plugin from local filesystem\n */\nasync function loadLocalPlugin(config: LocalPluginConfig): Promise<LoadedPlugin | null> {\n  const pluginPath = resolve(config.path);\n\n  if (!existsSync(pluginPath)) {\n    logger.error('Plugin path does not exist', { path: pluginPath });\n    return null;\n  }\n\n  // Look for package.json or plugin.json\n  const packageJsonPath = join(pluginPath, 'package.json');\n  const pluginJsonPath = join(pluginPath, 'plugin.json');\n\n  let metadata: any = { name: 'unknown', version: '0.0.0' };\n\n  if (existsSync(packageJsonPath)) {\n    metadata = JSON.parse(readFileSync(packageJsonPath, 'utf-8'));\n  } else if (existsSync(pluginJsonPath)) {\n    metadata = JSON.parse(readFileSync(pluginJsonPath, 'utf-8'));\n  }\n\n  // Try to load the plugin module\n  const mainPath = join(pluginPath, metadata.main || 'index.js');\n\n  if (!existsSync(mainPath)) {\n    logger.error('Plugin main file not found', { path: mainPath });\n    return null;\n  }\n\n  const module = await import(mainPath);\n  const tools: PluginTool[] = module.tools || module.default?.tools || [];\n\n  const plugin: LoadedPlugin = {\n    name: metadata.name,\n    version: metadata.version,\n    source: `local:${pluginPath}`,\n    tools,\n    enabled: true,\n    loadedAt: Date.now()\n  };\n\n  loadedPlugins.set(plugin.name, plugin);\n  logger.info('Local plugin loaded', { name: plugin.name, tools: tools.length });\n\n  return plugin;\n}\n\n/**\n * Load plugin from NPM package\n */\nasync function loadNpmPlugin(config: NpmPluginConfig): Promise<LoadedPlugin | null> {\n  try {\n    const module = await import(config.package);\n    const metadata = module.default?.metadata || { name: config.package, version: config.version || '0.0.0' };\n    const tools: PluginTool[] = module.tools || module.default?.tools || [];\n\n    const plugin: LoadedPlugin = {\n      name: metadata.name || config.package,\n      version: metadata.version || config.version || '0.0.0',\n      source: `npm:${config.package}`,\n      tools,\n      enabled: true,\n      loadedAt: Date.now()\n    };\n\n    loadedPlugins.set(plugin.name, plugin);\n    logger.info('NPM plugin loaded', { name: plugin.name, tools: tools.length });\n\n    return plugin;\n  } catch (error) {\n    logger.error('Failed to load NPM plugin', { package: config.package, error: (error as Error).message });\n    return null;\n  }\n}\n\n/**\n * Load plugin from remote URL\n */\nasync function loadRemotePlugin(config: RemotePluginConfig): Promise<LoadedPlugin | null> {\n  try {\n    const response = await fetch(config.url);\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const content = await response.text();\n\n    // Verify checksum if provided\n    if (config.checksum) {\n      const hash = await computeHash(content);\n      if (hash !== config.checksum) {\n        throw new Error('Checksum mismatch - plugin may be compromised');\n      }\n    }\n\n    // Parse plugin definition (JSON format)\n    const pluginDef = JSON.parse(content);\n\n    const plugin: LoadedPlugin = {\n      name: pluginDef.name || 'remote-plugin',\n      version: pluginDef.version || '0.0.0',\n      source: `remote:${config.url}`,\n      tools: pluginDef.tools || [],\n      enabled: true,\n      loadedAt: Date.now()\n    };\n\n    loadedPlugins.set(plugin.name, plugin);\n    logger.info('Remote plugin loaded', { name: plugin.name, url: config.url });\n\n    return plugin;\n  } catch (error) {\n    logger.error('Failed to load remote plugin', { url: config.url, error: (error as Error).message });\n    return null;\n  }\n}\n\n/**\n * Load inline plugin from configuration\n */\nfunction loadInlinePlugin(config: InlinePluginConfig): LoadedPlugin {\n  const plugin: LoadedPlugin = {\n    name: config.name,\n    version: '1.0.0',\n    source: 'inline',\n    tools: config.tools,\n    enabled: true,\n    loadedAt: Date.now()\n  };\n\n  loadedPlugins.set(plugin.name, plugin);\n  logger.info('Inline plugin loaded', { name: plugin.name, tools: config.tools.length });\n\n  return plugin;\n}\n\n/**\n * Compute SHA-256 hash for checksum verification\n */\nasync function computeHash(content: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const data = encoder.encode(content);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n}\n\n/**\n * Get all loaded plugins\n */\nexport function getLoadedPlugins(): LoadedPlugin[] {\n  return Array.from(loadedPlugins.values());\n}\n\n/**\n * Get plugin by name\n */\nexport function getPlugin(name: string): LoadedPlugin | null {\n  return loadedPlugins.get(name) || null;\n}\n\n/**\n * Enable/disable a plugin\n */\nexport function setPluginEnabled(name: string, enabled: boolean): boolean {\n  const plugin = loadedPlugins.get(name);\n  if (!plugin) return false;\n\n  plugin.enabled = enabled;\n  logger.info('Plugin state changed', { name, enabled });\n  return true;\n}\n\n/**\n * Unload a plugin\n */\nexport function unloadPlugin(name: string): boolean {\n  const existed = loadedPlugins.delete(name);\n  if (existed) {\n    logger.info('Plugin unloaded', { name });\n  }\n  return existed;\n}\n\n/**\n * Get all tools from enabled plugins\n */\nexport function getAllPluginTools(): PluginTool[] {\n  const tools: PluginTool[] = [];\n  for (const plugin of loadedPlugins.values()) {\n    if (plugin.enabled) {\n      tools.push(...plugin.tools);\n    }\n  }\n  return tools;\n}\n\n/**\n * Execute a plugin tool\n */\nexport async function executePluginTool(toolName: string, input: any): Promise<any> {\n  for (const plugin of loadedPlugins.values()) {\n    if (!plugin.enabled) continue;\n\n    const tool = plugin.tools.find(t => t.name === toolName);\n    if (tool) {\n      logger.info('Executing plugin tool', { plugin: plugin.name, tool: toolName });\n      return tool.handler(input);\n    }\n  }\n\n  throw new Error(`Plugin tool not found: ${toolName}`);\n}\n\n/**\n * Load plugins from SDK configuration\n */\nexport async function loadPluginsFromConfig(configs: PluginConfig[]): Promise<LoadedPlugin[]> {\n  const loaded: LoadedPlugin[] = [];\n\n  for (const config of configs) {\n    const plugin = await loadPlugin(config);\n    if (plugin) {\n      loaded.push(plugin);\n    }\n  }\n\n  logger.info('Plugins loaded from config', { total: loaded.length });\n  return loaded;\n}\n\n/**\n * Get plugin configuration for SDK query options\n */\nexport function getPluginsForSdk(): any[] {\n  const plugins: any[] = [];\n\n  for (const plugin of loadedPlugins.values()) {\n    if (!plugin.enabled) continue;\n\n    if (plugin.source.startsWith('local:')) {\n      plugins.push({\n        type: 'local',\n        path: plugin.source.replace('local:', '')\n      });\n    } else if (plugin.source.startsWith('npm:')) {\n      plugins.push({\n        type: 'npm',\n        package: plugin.source.replace('npm:', '')\n      });\n    }\n  }\n\n  return plugins;\n}\n\n/**\n * Create an inline plugin helper\n */\nexport function createPlugin(name: string, tools: PluginTool[]): LoadedPlugin {\n  return loadInlinePlugin({ type: 'inline', name, tools });\n}\n\n/**\n * Plugin tool builder for type-safe tool creation\n */\nexport function defineTool<T>(config: {\n  name: string;\n  description: string;\n  inputSchema: Record<string, any>;\n  handler: (input: T) => Promise<any>;\n}): PluginTool {\n  return {\n    name: config.name,\n    description: config.description,\n    inputSchema: config.inputSchema,\n    handler: config.handler as (input: any) => Promise<any>\n  };\n}\n"]}