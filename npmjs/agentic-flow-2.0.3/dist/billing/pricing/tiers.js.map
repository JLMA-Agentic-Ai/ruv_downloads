{"version":3,"file":"tiers.js","sourceRoot":"","sources":["../../../src/billing/pricing/tiers.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Subscription Tier Definitions\n * Pricing plans for agentic-jujutsu\n */\n\nimport { SubscriptionTier, PricingTier, UsageLimits } from '../types.js';\n\nexport const DEFAULT_TIERS: Record<SubscriptionTier, PricingTier> = {\n  [SubscriptionTier.Free]: {\n    tier: SubscriptionTier.Free,\n    name: 'Free',\n    description: 'Perfect for learning and experimentation',\n    monthlyPrice: 0,\n    yearlyPrice: 0,\n    quarterlyPrice: 0,\n    limits: {\n      maxAgentHours: 100,\n      maxDeployments: 3,\n      maxAPIRequests: 10000,\n      maxStorageGB: 1,\n      maxSwarmSize: 3,\n      maxGPUHours: 0,\n      maxBandwidthGB: 10,\n      maxConcurrentJobs: 1,\n      maxTeamMembers: 1,\n      maxCustomDomains: 0\n    },\n    features: [\n      '100 agent hours/month',\n      '3 deployments',\n      '10K API requests',\n      '1GB storage',\n      'Swarm size up to 3',\n      'Community support',\n      'Basic analytics'\n    ]\n  },\n\n  [SubscriptionTier.Starter]: {\n    tier: SubscriptionTier.Starter,\n    name: 'Starter',\n    description: 'For small teams and growing projects',\n    monthlyPrice: 29,\n    yearlyPrice: 290, // 2 months free\n    quarterlyPrice: 79,\n    limits: {\n      maxAgentHours: 500,\n      maxDeployments: 10,\n      maxAPIRequests: 100000,\n      maxStorageGB: 10,\n      maxSwarmSize: 6,\n      maxGPUHours: 10,\n      maxBandwidthGB: 50,\n      maxConcurrentJobs: 5,\n      maxTeamMembers: 3,\n      maxCustomDomains: 1\n    },\n    features: [\n      '500 agent hours/month (5x Free)',\n      '10 deployments',\n      '100K API requests',\n      '10GB storage',\n      'Swarm size up to 6',\n      '10 GPU hours/month',\n      'Email support',\n      'Advanced analytics',\n      '1 custom domain'\n    ]\n  },\n\n  [SubscriptionTier.Pro]: {\n    tier: SubscriptionTier.Pro,\n    name: 'Pro',\n    description: 'For professional teams and production workloads',\n    monthlyPrice: 99,\n    yearlyPrice: 990, // 2 months free\n    quarterlyPrice: 269,\n    limits: {\n      maxAgentHours: 2000,\n      maxDeployments: 50,\n      maxAPIRequests: 1000000,\n      maxStorageGB: 100,\n      maxSwarmSize: 12,\n      maxGPUHours: 50,\n      maxBandwidthGB: 500,\n      maxConcurrentJobs: 20,\n      maxTeamMembers: 10,\n      maxCustomDomains: 5\n    },\n    features: [\n      '2,000 agent hours/month (20x Free)',\n      '50 deployments',\n      '1M API requests',\n      '100GB storage',\n      'Swarm size up to 12',\n      '50 GPU hours/month',\n      'Priority support',\n      'Advanced security',\n      'Custom integrations',\n      '5 custom domains',\n      'ReasoningBank learning',\n      'QUIC protocol support'\n    ],\n    popular: true\n  },\n\n  [SubscriptionTier.Enterprise]: {\n    tier: SubscriptionTier.Enterprise,\n    name: 'Enterprise',\n    description: 'For large organizations and mission-critical systems',\n    monthlyPrice: 499,\n    yearlyPrice: 4990, // 2 months free\n    quarterlyPrice: 1349,\n    limits: {\n      maxAgentHours: 10000,\n      maxDeployments: 500,\n      maxAPIRequests: 10000000,\n      maxStorageGB: 1000,\n      maxSwarmSize: 50,\n      maxGPUHours: 500,\n      maxBandwidthGB: 5000,\n      maxConcurrentJobs: 100,\n      maxTeamMembers: 100,\n      maxCustomDomains: 50\n    },\n    features: [\n      '10,000 agent hours/month (100x Free)',\n      'Unlimited deployments',\n      '10M API requests',\n      '1TB storage',\n      'Swarm size up to 50',\n      '500 GPU hours/month',\n      '24/7 dedicated support',\n      'Enterprise security (SSO, SAML)',\n      'SLA guarantee (99.9%)',\n      'Custom deployment patterns',\n      'On-premise option',\n      '50 custom domains',\n      'Advanced ReasoningBank',\n      'Byzantine consensus protocols',\n      'White-label options'\n    ]\n  },\n\n  [SubscriptionTier.Custom]: {\n    tier: SubscriptionTier.Custom,\n    name: 'Custom',\n    description: 'Tailored solutions for unique requirements',\n    monthlyPrice: 0, // Contact sales\n    yearlyPrice: 0,\n    quarterlyPrice: 0,\n    limits: {\n      maxAgentHours: -1, // Unlimited\n      maxDeployments: -1,\n      maxAPIRequests: -1,\n      maxStorageGB: -1,\n      maxSwarmSize: -1,\n      maxGPUHours: -1,\n      maxBandwidthGB: -1,\n      maxConcurrentJobs: -1,\n      maxTeamMembers: -1,\n      maxCustomDomains: -1\n    },\n    features: [\n      'Unlimited everything',\n      'Custom pricing',\n      'Custom features',\n      'Dedicated infrastructure',\n      'Custom SLA',\n      'Enterprise support',\n      'Professional services',\n      'Training & onboarding',\n      'Custom integrations',\n      'Regulatory compliance support'\n    ]\n  }\n};\n\nexport class PricingManager {\n  private tiers: Map<SubscriptionTier, PricingTier>;\n\n  constructor(customTiers?: Partial<Record<SubscriptionTier, PricingTier>>) {\n    this.tiers = new Map(Object.entries(DEFAULT_TIERS) as [SubscriptionTier, PricingTier][]);\n\n    // Apply custom tier overrides\n    if (customTiers) {\n      Object.entries(customTiers).forEach(([tier, config]) => {\n        if (config) {\n          this.tiers.set(tier as SubscriptionTier, config);\n        }\n      });\n    }\n  }\n\n  getTier(tier: SubscriptionTier): PricingTier | undefined {\n    return this.tiers.get(tier);\n  }\n\n  getAllTiers(): PricingTier[] {\n    return Array.from(this.tiers.values());\n  }\n\n  calculatePrice(tier: SubscriptionTier, cycle: 'monthly' | 'yearly' | 'quarterly'): number {\n    const pricingTier = this.getTier(tier);\n    if (!pricingTier) {\n      throw new Error(`Unknown tier: ${tier}`);\n    }\n\n    switch (cycle) {\n      case 'monthly':\n        return pricingTier.monthlyPrice;\n      case 'yearly':\n        return pricingTier.yearlyPrice;\n      case 'quarterly':\n        return pricingTier.quarterlyPrice;\n      default:\n        throw new Error(`Unknown billing cycle: ${cycle}`);\n    }\n  }\n\n  getAnnualSavings(tier: SubscriptionTier): number {\n    const pricingTier = this.getTier(tier);\n    if (!pricingTier) return 0;\n\n    const monthlyTotal = pricingTier.monthlyPrice * 12;\n    const yearlyTotal = pricingTier.yearlyPrice;\n    return monthlyTotal - yearlyTotal;\n  }\n\n  compareFeatures(tier1: SubscriptionTier, tier2: SubscriptionTier): {\n    upgrades: string[];\n    multipliers: Record<string, number>;\n  } {\n    const t1 = this.getTier(tier1);\n    const t2 = this.getTier(tier2);\n\n    if (!t1 || !t2) {\n      throw new Error('Invalid tier comparison');\n    }\n\n    const upgrades = t2.features.filter(f => !t1.features.includes(f));\n\n    const multipliers: Record<string, number> = {\n      agentHours: t2.limits.maxAgentHours / t1.limits.maxAgentHours,\n      deployments: t2.limits.maxDeployments / t1.limits.maxDeployments,\n      storage: t2.limits.maxStorageGB / t1.limits.maxStorageGB,\n      swarmSize: t2.limits.maxSwarmSize / t1.limits.maxSwarmSize\n    };\n\n    return { upgrades, multipliers };\n  }\n\n  getRecommendedTier(usage: Partial<UsageLimits>): SubscriptionTier {\n    const tiers = [\n      SubscriptionTier.Free,\n      SubscriptionTier.Starter,\n      SubscriptionTier.Pro,\n      SubscriptionTier.Enterprise\n    ];\n\n    for (const tier of tiers) {\n      const limits = this.getTier(tier)?.limits;\n      if (!limits) continue;\n\n      const fitsInLimits = Object.entries(usage).every(([key, value]) => {\n        const limit = limits[key as keyof UsageLimits];\n        return limit === -1 || value <= limit;\n      });\n\n      if (fitsInLimits) {\n        return tier;\n      }\n    }\n\n    return SubscriptionTier.Custom;\n  }\n}\n"]}