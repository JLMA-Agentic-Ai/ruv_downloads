{"version":3,"file":"agentdb-wrapper.js","sourceRoot":"","sources":["../../src/core/agentdb-wrapper.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * AgentDBWrapper - Clean API over raw AgentDB v2.0.0-alpha.2.11\n *\n * Provides a unified interface for:\n * - Vector search with HNSW indexing\n * - Memory operations (insert, search, update, delete)\n * - TypeScript-first type safety\n * - Error handling and validation\n *\n * Note: AgentDB is optional - falls back gracefully on Windows\n *\n * @module agentdb-wrapper\n */\n\nlet AgentDB: any = null;\nlet agentdbAvailable = false;\n\ntry {\n  const mod = await import('agentdb');\n  AgentDB = mod.AgentDB;\n  agentdbAvailable = true;\n} catch {\n  console.warn('[AgentDB] Not available - some features disabled');\n}\n\nimport type {\n  AgentDBConfig,\n  VectorEntry,\n  VectorSearchOptions,\n  VectorSearchResult,\n  MemoryInsertOptions,\n  MemoryUpdateOptions,\n  MemoryDeleteOptions,\n  MemoryGetOptions,\n  AgentDBStats,\n  BatchInsertResult,\n  ValidationError,\n  DatabaseError,\n  IndexError,\n  HNSWConfig,\n} from '../types/agentdb.js';\n\n/**\n * Main wrapper class for AgentDB operations\n *\n * @example\n * ```typescript\n * const wrapper = new AgentDBWrapper({\n *   dbPath: ':memory:',\n *   dimension: 384,\n *   hnswConfig: { M: 16, efConstruction: 200 }\n * });\n *\n * await wrapper.initialize();\n *\n * // Insert a vector\n * const vector = new Float32Array(384);\n * await wrapper.insert({ vector, metadata: { type: 'test' } });\n *\n * // Search\n * const results = await wrapper.vectorSearch(queryVector, { k: 10 });\n *\n * await wrapper.close();\n * ```\n */\nexport class AgentDBWrapper {\n  private agentDB!: any;\n  private config: AgentDBConfig;\n  private initialized = false;\n  private dimension: number;\n  private namespace: string;\n  private reflexionController: any;\n  private embedder: any;\n  private vectorBackend: any;\n\n  // For testing - allow dependency injection\n  public _agentDB?: any;\n  public _embedder?: any;\n  public _vectorBackend?: any;\n\n  /**\n   * Create a new AgentDBWrapper instance\n   *\n   * @param config - Configuration options\n   */\n  constructor(config: AgentDBConfig = {}) {\n    this.config = {\n      dbPath: config.dbPath || ':memory:',\n      namespace: config.namespace || 'default',\n      dimension: config.dimension || 384,\n      hnswConfig: {\n        M: config.hnswConfig?.M || 16,\n        efConstruction: config.hnswConfig?.efConstruction || 200,\n        efSearch: config.hnswConfig?.efSearch || 100,\n      },\n      enableAttention: config.enableAttention || false,\n      attentionConfig: config.attentionConfig,\n      autoInit: config.autoInit !== false, // Default true\n    };\n\n    this.dimension = this.config.dimension!;\n    this.namespace = this.config.namespace!;\n\n    // Auto-initialize if configured\n    if (this.config.autoInit) {\n      this.initialize().catch((err) => {\n        console.error('Auto-initialization failed:', err);\n      });\n    }\n  }\n\n  /**\n   * Initialize the AgentDB instance and dependencies\n   *\n   * @throws {DatabaseError} If initialization fails\n   */\n  async initialize(): Promise<void> {\n    if (this.initialized) {\n      return;\n    }\n\n    if (!agentdbAvailable || !AgentDB) {\n      throw new Error('AgentDB not available - install with: npm install agentdb (requires native build tools)');\n    }\n\n    try {\n      // Use injected dependencies for testing, otherwise create real instances\n      if (this._agentDB) {\n        this.agentDB = this._agentDB;\n        this.embedder = this._embedder;\n        this.vectorBackend = this._vectorBackend;\n      } else {\n        // Create real AgentDB instance\n        this.agentDB = new AgentDB({\n          dbPath: this.config.dbPath,\n          namespace: this.namespace,\n          enableAttention: this.config.enableAttention,\n          attentionConfig: this.config.attentionConfig,\n        });\n\n        await this.agentDB.initialize();\n\n        // Get controllers\n        this.reflexionController = this.agentDB.getController('reflexion');\n        this.embedder = this.reflexionController?.embedder;\n        this.vectorBackend = this.reflexionController?.vectorBackend;\n      }\n\n      // Initialize embedder if available\n      if (this.embedder && this.embedder.initialize) {\n        await this.embedder.initialize();\n      }\n\n      this.initialized = true;\n    } catch (error) {\n      throw new Error(\n        `Failed to initialize AgentDB: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Ensure wrapper is initialized before operations\n   *\n   * @throws {Error} If not initialized\n   */\n  private ensureInitialized(): void {\n    if (!this.initialized) {\n      throw new Error(\n        'AgentDBWrapper not initialized. Call initialize() first.'\n      );\n    }\n  }\n\n  /**\n   * Validate vector dimension\n   *\n   * @param vector - Vector to validate\n   * @throws {ValidationError} If dimension is invalid\n   */\n  private validateVectorDimension(vector: Float32Array): void {\n    if (vector.length !== this.dimension) {\n      throw new Error(\n        `Invalid vector dimension: expected ${this.dimension}, got ${vector.length}`\n      );\n    }\n  }\n\n  /**\n   * Generate a unique ID\n   *\n   * @returns A unique identifier\n   */\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n  }\n\n  /**\n   * Insert a vector with metadata into the database\n   *\n   * @param options - Insert options\n   * @returns The inserted entry with ID\n   * @throws {ValidationError} If vector dimension is invalid\n   * @throws {DatabaseError} If insertion fails\n   */\n  async insert(\n    options: MemoryInsertOptions\n  ): Promise<{ id: string; timestamp: number }> {\n    this.ensureInitialized();\n    this.validateVectorDimension(options.vector);\n\n    const id = options.id || this.generateId();\n    const timestamp = Date.now();\n\n    const metadata = {\n      ...options.metadata,\n      timestamp,\n      namespace: options.namespace || this.namespace,\n    };\n\n    try {\n      const controller = this._agentDB\n        ? this._agentDB.getController('reflexion')\n        : this.reflexionController;\n\n      await controller.store({\n        id,\n        vector: options.vector,\n        metadata,\n      });\n\n      return { id, timestamp };\n    } catch (error) {\n      throw new Error(\n        `Failed to insert vector: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Search for similar vectors using HNSW indexing\n   *\n   * @param query - Query vector\n   * @param options - Search options\n   * @returns Array of search results sorted by similarity (descending)\n   * @throws {ValidationError} If query dimension is invalid\n   */\n  async vectorSearch(\n    query: Float32Array,\n    options: VectorSearchOptions = {}\n  ): Promise<VectorSearchResult[]> {\n    this.ensureInitialized();\n    this.validateVectorDimension(query);\n\n    const {\n      k = 10,\n      metric = 'cosine',\n      filter,\n      includeVectors = false,\n      hnswParams,\n    } = options;\n\n    try {\n      const controller = this._agentDB\n        ? this._agentDB.getController('reflexion')\n        : this.reflexionController;\n\n      const results = await controller.retrieve(query, {\n        k,\n        metric,\n        filter,\n        includeVectors,\n        hnswParams,\n      });\n\n      return results.map((result: any) => ({\n        id: result.id,\n        score: result.score,\n        metadata: result.metadata,\n        ...(includeVectors && { vector: result.vector }),\n      }));\n    } catch (error) {\n      throw new Error(\n        `Vector search failed: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Update a vector and/or its metadata\n   *\n   * @param options - Update options\n   * @returns True if update succeeded\n   * @throws {ValidationError} If vector dimension is invalid\n   * @throws {DatabaseError} If vector not found\n   */\n  async update(options: MemoryUpdateOptions): Promise<boolean> {\n    this.ensureInitialized();\n\n    if (options.vector) {\n      this.validateVectorDimension(options.vector);\n    }\n\n    try {\n      const controller = this._agentDB\n        ? this._agentDB.getController('reflexion')\n        : this.reflexionController;\n\n      const updateData: any = {};\n\n      if (options.vector) {\n        updateData.vector = options.vector;\n      }\n\n      if (options.metadata) {\n        updateData.metadata = options.metadata;\n      }\n\n      const result = await controller.update(options.id, updateData);\n\n      if (!result) {\n        throw new Error(`Vector not found: ${options.id}`);\n      }\n\n      return result;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /**\n   * Delete a vector by ID\n   *\n   * @param options - Delete options\n   * @returns True if deletion succeeded, false if not found\n   */\n  async delete(options: MemoryDeleteOptions): Promise<boolean> {\n    this.ensureInitialized();\n\n    try {\n      const controller = this._agentDB\n        ? this._agentDB.getController('reflexion')\n        : this.reflexionController;\n\n      const result = await controller.delete(options.id);\n      return result;\n    } catch (error) {\n      throw new Error(\n        `Delete failed: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Get a vector by ID\n   *\n   * @param options - Get options\n   * @returns Vector entry or null if not found\n   */\n  async get(options: MemoryGetOptions): Promise<VectorEntry | null> {\n    this.ensureInitialized();\n\n    try {\n      const controller = this._agentDB\n        ? this._agentDB.getController('reflexion')\n        : this.reflexionController;\n\n      const result = await controller.get(options.id);\n\n      if (!result) {\n        return null;\n      }\n\n      const entry: VectorEntry = {\n        id: result.id,\n        vector: result.vector,\n        metadata: result.metadata,\n      };\n\n      // Exclude vector if not requested\n      if (options.includeVector === false) {\n        delete entry.vector;\n      }\n\n      return entry;\n    } catch (error) {\n      throw new Error(\n        `Get failed: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Insert multiple vectors in a batch\n   *\n   * @param entries - Array of entries to insert\n   * @returns Batch insert result with success/failure counts\n   */\n  async batchInsert(\n    entries: MemoryInsertOptions[]\n  ): Promise<BatchInsertResult> {\n    this.ensureInitialized();\n\n    const startTime = Date.now();\n    const result: BatchInsertResult = {\n      inserted: 0,\n      failed: [],\n      duration: 0,\n    };\n\n    const controller = this._agentDB\n      ? this._agentDB.getController('reflexion')\n      : this.reflexionController;\n\n    for (let i = 0; i < entries.length; i++) {\n      const entry = entries[i];\n\n      try {\n        await this.insert(entry);\n        result.inserted++;\n      } catch (error) {\n        result.failed.push({\n          index: i,\n          id: entry.id,\n          error: error instanceof Error ? error.message : String(error),\n        });\n      }\n    }\n\n    result.duration = Date.now() - startTime;\n    return result;\n  }\n\n  /**\n   * Get database statistics\n   *\n   * @returns Database statistics including vector count and index info\n   */\n  async getStats(): Promise<AgentDBStats> {\n    this.ensureInitialized();\n\n    try {\n      const backend = this._vectorBackend || this.vectorBackend;\n\n      const stats = await backend.getStats();\n\n      return {\n        vectorCount: stats.vectorCount || 0,\n        dimension: this.dimension,\n        databaseSize: stats.databaseSize || 0,\n        hnswStats: stats.hnswStats,\n        memoryUsage: stats.memoryUsage,\n        indexBuildTime: stats.indexBuildTime,\n      };\n    } catch (error) {\n      throw new Error(\n        `Failed to get stats: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Close the database connection\n   */\n  async close(): Promise<void> {\n    if (!this.initialized) {\n      return;\n    }\n\n    try {\n      const db = this._agentDB || this.agentDB;\n      await db.close();\n      this.initialized = false;\n    } catch (error) {\n      throw new Error(\n        `Failed to close database: ${error instanceof Error ? error.message : String(error)}`\n      );\n    }\n  }\n\n  /**\n   * Get the underlying AgentDB instance (for advanced usage)\n   *\n   * @returns The raw AgentDB instance\n   */\n  getRawInstance(): any {\n    this.ensureInitialized();\n    return this.agentDB;\n  }\n}\n"]}