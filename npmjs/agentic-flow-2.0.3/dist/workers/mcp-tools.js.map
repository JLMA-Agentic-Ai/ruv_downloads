{"version":3,"file":"mcp-tools.js","sourceRoot":"","sources":["../../src/workers/mcp-tools.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * MCP Tools for Background Workers\n * Exposes worker functionality via MCP protocol\n */\n\nimport { getWorkerDispatchService } from './dispatch-service.js';\nimport { getTriggerDetector } from './trigger-detector.js';\nimport { getWorkerRegistry } from './worker-registry.js';\nimport { getResourceGovernor } from './resource-governor.js';\nimport { WorkerTrigger, WorkerInfo } from './types.js';\n\n// MCP Tool definition interface\ninterface MCPTool {\n  name: string;\n  description: string;\n  inputSchema: {\n    type: 'object';\n    properties: Record<string, unknown>;\n    required?: string[];\n  };\n  execute: (params: Record<string, unknown>, context?: any) => Promise<unknown>;\n}\n\n/**\n * Worker dispatch tool\n */\nexport const workerDispatchTool: MCPTool = {\n  name: 'worker_dispatch',\n  description: 'Dispatch a background worker to run silently while conversation continues',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      trigger: {\n        type: 'string',\n        description: 'Worker trigger type',\n        enum: ['ultralearn', 'optimize', 'consolidate', 'predict', 'audit', 'map', 'preload', 'deepdive', 'document', 'refactor', 'benchmark', 'testgaps']\n      },\n      topic: {\n        type: 'string',\n        description: 'Optional topic or focus area for the worker'\n      },\n      sessionId: {\n        type: 'string',\n        description: 'Session identifier'\n      }\n    },\n    required: ['trigger', 'sessionId']\n  },\n  async execute(params) {\n    const { trigger, topic, sessionId } = params as {\n      trigger: WorkerTrigger;\n      topic?: string;\n      sessionId: string;\n    };\n\n    const dispatcher = getWorkerDispatchService();\n    const workerId = await dispatcher.dispatch(trigger, topic || null, sessionId);\n\n    return {\n      success: true,\n      workerId,\n      trigger,\n      topic,\n      message: `Background worker spawned: ${trigger}${topic ? ` for \"${topic}\"` : ''}`\n    };\n  }\n};\n\n/**\n * Worker status tool\n */\nexport const workerStatusTool: MCPTool = {\n  name: 'worker_status',\n  description: 'Get status of background workers',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      workerId: {\n        type: 'string',\n        description: 'Specific worker ID to check (optional)'\n      },\n      sessionId: {\n        type: 'string',\n        description: 'Filter by session ID (optional)'\n      },\n      activeOnly: {\n        type: 'boolean',\n        description: 'Only show active workers'\n      }\n    }\n  },\n  async execute(params) {\n    const { workerId, sessionId, activeOnly } = params as {\n      workerId?: string;\n      sessionId?: string;\n      activeOnly?: boolean;\n    };\n\n    const registry = getWorkerRegistry();\n    const governor = getResourceGovernor();\n\n    if (workerId) {\n      const worker = registry.get(workerId);\n      if (!worker) {\n        return { success: false, error: 'Worker not found' };\n      }\n      return { success: true, worker };\n    }\n\n    const workers = activeOnly\n      ? registry.getActive(sessionId)\n      : registry.getAll({ sessionId, limit: 20 });\n\n    const stats = governor.getStats();\n    const availability = governor.getAvailability();\n\n    return {\n      success: true,\n      workers,\n      stats: {\n        activeWorkers: stats.activeWorkers,\n        availableSlots: availability.availableSlots,\n        totalSlots: availability.totalSlots\n      }\n    };\n  }\n};\n\n/**\n * Worker cancel tool\n */\nexport const workerCancelTool: MCPTool = {\n  name: 'worker_cancel',\n  description: 'Cancel a running background worker',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      workerId: {\n        type: 'string',\n        description: 'Worker ID to cancel'\n      }\n    },\n    required: ['workerId']\n  },\n  async execute(params) {\n    const { workerId } = params as { workerId: string };\n\n    const dispatcher = getWorkerDispatchService();\n    const cancelled = dispatcher.cancel(workerId);\n\n    return {\n      success: cancelled,\n      workerId,\n      message: cancelled ? 'Worker cancelled' : 'Could not cancel worker'\n    };\n  }\n};\n\n/**\n * Worker triggers list tool\n */\nexport const workerTriggersTool: MCPTool = {\n  name: 'worker_triggers',\n  description: 'List available background worker triggers and their status',\n  inputSchema: {\n    type: 'object',\n    properties: {}\n  },\n  async execute() {\n    const detector = getTriggerDetector();\n    const configs = detector.getAllConfigs();\n    const stats = detector.getStats();\n\n    const triggers = Array.from(configs.entries()).map(([keyword, config]) => ({\n      keyword,\n      description: config.description,\n      priority: config.priority,\n      maxAgents: config.maxAgents,\n      timeout: config.timeout,\n      cooldownRemaining: stats.cooldowns[keyword] || 0\n    }));\n\n    return {\n      success: true,\n      triggers,\n      cooldowns: stats.cooldowns\n    };\n  }\n};\n\n/**\n * Worker results tool\n */\nexport const workerResultsTool: MCPTool = {\n  name: 'worker_results',\n  description: 'Get results from a completed background worker',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      workerId: {\n        type: 'string',\n        description: 'Worker ID to get results from'\n      }\n    },\n    required: ['workerId']\n  },\n  async execute(params) {\n    const { workerId } = params as { workerId: string };\n\n    const registry = getWorkerRegistry();\n    const worker = registry.get(workerId);\n\n    if (!worker) {\n      return { success: false, error: 'Worker not found' };\n    }\n\n    if (worker.status !== 'complete') {\n      return {\n        success: false,\n        status: worker.status,\n        progress: worker.progress,\n        error: 'Worker has not completed yet'\n      };\n    }\n\n    const metrics = registry.getMetrics(workerId);\n\n    return {\n      success: true,\n      worker: {\n        id: worker.id,\n        trigger: worker.trigger,\n        topic: worker.topic,\n        status: worker.status,\n        duration: (worker.completedAt! - worker.startedAt) / 1000,\n        memoryDeposits: worker.memoryDeposits,\n        resultKeys: worker.resultKeys\n      },\n      metrics\n    };\n  }\n};\n\n/**\n * Worker detect triggers tool\n */\nexport const workerDetectTool: MCPTool = {\n  name: 'worker_detect',\n  description: 'Detect background worker triggers in a prompt without dispatching',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      prompt: {\n        type: 'string',\n        description: 'Prompt to analyze for triggers'\n      }\n    },\n    required: ['prompt']\n  },\n  async execute(params) {\n    const { prompt } = params as { prompt: string };\n\n    const detector = getTriggerDetector();\n    const triggers = detector.detect(prompt);\n\n    return {\n      success: true,\n      hasTriggers: triggers.length > 0,\n      triggers: triggers.map(t => ({\n        keyword: t.keyword,\n        topic: t.topic,\n        priority: t.config.priority\n      }))\n    };\n  }\n};\n\n/**\n * Worker stats tool\n */\nexport const workerStatsTool: MCPTool = {\n  name: 'worker_stats',\n  description: 'Get aggregated statistics about background workers',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      timeframe: {\n        type: 'string',\n        description: 'Timeframe for stats',\n        enum: ['1h', '24h', '7d']\n      }\n    }\n  },\n  async execute(params) {\n    const { timeframe = '24h' } = params as { timeframe?: '1h' | '24h' | '7d' };\n\n    const registry = getWorkerRegistry();\n    const governor = getResourceGovernor();\n\n    const registryStats = registry.getStats(timeframe);\n    const resourceStats = governor.getStats();\n    const availability = governor.getAvailability();\n\n    return {\n      success: true,\n      timeframe,\n      stats: {\n        total: registryStats.total,\n        byStatus: registryStats.byStatus,\n        byTrigger: registryStats.byTrigger,\n        avgDuration: registryStats.avgDuration,\n        activeWorkers: resourceStats.activeWorkers,\n        memoryUsageMB: resourceStats.memoryUsage.heapUsed / (1024 * 1024),\n        availability: {\n          used: availability.usedSlots,\n          available: availability.availableSlots,\n          total: availability.totalSlots\n        }\n      }\n    };\n  }\n};\n\n/**\n * Worker context inject tool\n */\nexport const workerContextTool: MCPTool = {\n  name: 'worker_context',\n  description: 'Get relevant background worker results for context injection',\n  inputSchema: {\n    type: 'object',\n    properties: {\n      query: {\n        type: 'string',\n        description: 'Query to find relevant worker results'\n      },\n      sessionId: {\n        type: 'string',\n        description: 'Session ID to filter results'\n      },\n      limit: {\n        type: 'number',\n        description: 'Maximum number of results'\n      }\n    },\n    required: ['query']\n  },\n  async execute(params) {\n    const { query, sessionId, limit = 5 } = params as {\n      query: string;\n      sessionId?: string;\n      limit?: number;\n    };\n\n    const registry = getWorkerRegistry();\n    const completed = registry.getAll({\n      sessionId,\n      status: 'complete',\n      limit: 50\n    });\n\n    // Simple keyword matching\n    const keywords = query.toLowerCase().split(/\\s+/).filter(w => w.length > 3);\n    const scored: Array<{ worker: WorkerInfo; score: number }> = [];\n\n    for (const worker of completed) {\n      const workerText = `${worker.trigger} ${worker.topic || ''}`.toLowerCase();\n      let score = 0;\n\n      for (const keyword of keywords) {\n        if (workerText.includes(keyword)) {\n          score += 1;\n        }\n      }\n\n      if (score > 0) {\n        scored.push({ worker, score });\n      }\n    }\n\n    scored.sort((a, b) => b.score - a.score);\n    const relevant = scored.slice(0, limit);\n\n    return {\n      success: true,\n      results: relevant.map(({ worker, score }) => ({\n        workerId: worker.id,\n        trigger: worker.trigger,\n        topic: worker.topic,\n        relevance: score / Math.max(keywords.length, 1),\n        memoryKeys: worker.resultKeys,\n        completedAt: worker.completedAt\n      }))\n    };\n  }\n};\n\n/**\n * Get all MCP tools\n */\nexport function getWorkerMCPTools(): MCPTool[] {\n  return [\n    workerDispatchTool,\n    workerStatusTool,\n    workerCancelTool,\n    workerTriggersTool,\n    workerResultsTool,\n    workerDetectTool,\n    workerStatsTool,\n    workerContextTool\n  ];\n}\n\n/**\n * Register tools with MCP server\n */\nexport function registerWorkerTools(server: any): void {\n  const tools = getWorkerMCPTools();\n\n  for (const tool of tools) {\n    server.tool(\n      tool.name,\n      tool.description,\n      tool.inputSchema,\n      tool.execute\n    );\n  }\n}\n"]}