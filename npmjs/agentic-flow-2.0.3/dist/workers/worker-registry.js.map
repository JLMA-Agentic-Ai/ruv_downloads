{"version":3,"file":"worker-registry.js","sourceRoot":"","sources":["../../src/workers/worker-registry.ts"],"names":[],"mappings":"AAAA;;;;;GAKG;AAEH,OAAO,KAAK,IAAI,MAAM,MAAM,CAAC;AAC7B,OAAO,KAAK,EAAE,MAAM,IAAI,CAAC;AACzB,OAAO,EAAE,IAAI,EAAE,MAAM,MAAM,CAAC;AAS5B,MAAM,MAAM,GAAG,eAAe,CAAC;AAC/B,MAAM,OAAO,GAAG,YAAY,CAAC;AAiB7B,oCAAoC;AACpC,SAAS,yBAAyB,CAAC,EAAO;IACxC,OAAO;QACL,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;QAC5D,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;QAC5D,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,MAAM,IAAI,EAAE,CAAC,CAAC;QAC5D,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC;QAC3B,MAAM,EAAE,CAAC,SAAS,EAAE,EAAE,CAAC,EAAE,CAAC,MAAM,CAAC,SAAS,CAAC;QAC3C,OAAO,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC;QACjC,KAAK,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,KAAK,EAAE;KACxB,CAAC;AACJ,CAAC;AAED,4BAA4B;AAC5B,SAAS,kBAAkB,CAAC,EAAO,EAAE,MAAc;IACjD,2BAA2B;IAC3B,MAAM,MAAM,GAAG,GAAG,EAAE;QAClB,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,EAAE,CAAC,MAAM,EAAE,CAAC;YACzB,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjC,EAAE,CAAC,aAAa,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QACnC,CAAC;QAAC,MAAM,CAAC,CAAC,wBAAwB,CAAC,CAAC;IACtC,CAAC,CAAC;IAEF,OAAO;QACL,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;YACnB,EAAE,CAAC,GAAG,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YACpB,MAAM,EAAE,CAAC;QACX,CAAC;QACD,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;YACnB,MAAM,IAAI,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC7B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAClB,IAAI,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC;gBAChB,MAAM,GAAG,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;gBAC/B,IAAI,CAAC,IAAI,EAAE,CAAC;gBACZ,OAAO,GAAG,CAAC;YACb,CAAC;YACD,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,OAAO,SAAS,CAAC;QACnB,CAAC;QACD,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE;YACnB,MAAM,OAAO,GAAU,EAAE,CAAC;YAC1B,MAAM,IAAI,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC7B,IAAI,MAAM;gBAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC9B,OAAO,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC;gBACnB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;YACnC,CAAC;YACD,IAAI,CAAC,IAAI,EAAE,CAAC;YACZ,OAAO,OAAO,CAAC;QACjB,CAAC;QACD,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE;YACZ,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACb,MAAM,EAAE,CAAC;QACX,CAAC;QACD,MAAM,EAAE,GAAG,EAAE,GAA4C,CAAC;QAC1D,OAAO,EAAE,CAAC,GAAG,EAAE,EAAE;YACf,MAAM,IAAI,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;YAC7B,OAAO;gBACL,GAAG,EAAE,CAAC,GAAG,MAAa,EAAE,EAAE;oBACxB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAClB,IAAI,CAAC,IAAI,EAAE,CAAC;oBACZ,IAAI,CAAC,KAAK,EAAE,CAAC;oBACb,MAAM,EAAE,CAAC;oBACT,OAAO,EAAE,OAAO,EAAE,EAAE,CAAC,eAAe,EAAE,EAAE,CAAC;gBAC3C,CAAC;gBACD,GAAG,EAAE,CAAC,GAAG,MAAa,EAAE,EAAE;oBACxB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAClB,IAAI,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC;wBAChB,MAAM,GAAG,GAAG,IAAI,CAAC,WAAW,EAAE,CAAC;wBAC/B,IAAI,CAAC,KAAK,EAAE,CAAC;wBACb,OAAO,GAAG,CAAC;oBACb,CAAC;oBACD,IAAI,CAAC,KAAK,EAAE,CAAC;oBACb,OAAO,SAAS,CAAC;gBACnB,CAAC;gBACD,GAAG,EAAE,CAAC,GAAG,MAAa,EAAE,EAAE;oBACxB,MAAM,OAAO,GAAU,EAAE,CAAC;oBAC1B,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAClB,OAAO,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC;wBACnB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;oBACnC,CAAC;oBACD,IAAI,CAAC,KAAK,EAAE,CAAC;oBACb,OAAO,OAAO,CAAC;gBACjB,CAAC;aACF,CAAC;QACJ,CAAC;QACD,KAAK,EAAE,GAAG,EAAE;YACV,MAAM,EAAE,CAAC;YACT,EAAE,CAAC,KAAK,EAAE,CAAC;QACb,CAAC;KACF,CAAC;AACJ,CAAC;AAED,MAAM,OAAO,cAAc;IACjB,EAAE,CAAa;IACf,WAAW,GAAG,KAAK,CAAC;IACpB,SAAS,GAA2C,QAAQ,CAAC;IAC7D,MAAM,CAAS;IAEvB,YAAY,MAAe;QACzB,MAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,MAAM,CAAC,CAAC;QAC7C,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC;YACxB,EAAE,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;QACzC,CAAC;QAED,IAAI,CAAC,MAAM,GAAG,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC;QAChD,IAAI,CAAC,cAAc,EAAE,CAAC;IACxB,CAAC;IAEO,cAAc;QACpB,6CAA6C;QAC7C,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,OAAO,CAAC,gBAAgB,CAAC,CAAC;YAC3C,IAAI,CAAC,EAAE,GAAG,yBAAyB,CAAC,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YAC/D,IAAI,CAAC,SAAS,GAAG,gBAAgB,CAAC;YAClC,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,OAAO;QACT,CAAC;QAAC,MAAM,CAAC;YACP,mEAAmE;QACrE,CAAC;QAED,oCAAoC;QACpC,IAAI,CAAC;YACH,MAAM,SAAS,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;YACpC,yDAAyD;YACzD,wDAAwD;YACxD,MAAM,UAAU,GAAG,SAAS,EAAE,CAAC,IAAI,CAAC,CAAC,GAAQ,EAAE,EAAE;gBAC/C,IAAI,EAAE,CAAC;gBACP,IAAI,CAAC;oBACH,MAAM,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;oBAChD,EAAE,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;gBACpC,CAAC;gBAAC,MAAM,CAAC;oBACP,EAAE,GAAG,IAAI,GAAG,CAAC,QAAQ,EAAE,CAAC;gBAC1B,CAAC;gBACD,IAAI,CAAC,EAAE,GAAG,kBAAkB,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gBAC9C,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;gBAC1B,IAAI,CAAC,UAAU,EAAE,CAAC;YACpB,CAAC,CAAC,CAAC;YAEH,kDAAkD;YAClD,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAEzB,iCAAiC;YACjC,UAAU,CAAC,KAAK,CAAC,GAAG,EAAE;gBACpB,uBAAuB;YACzB,CAAC,CAAC,CAAC;YACH,OAAO;QACT,CAAC;QAAC,MAAM,CAAC;YACP,uBAAuB;QACzB,CAAC;QAED,iDAAiD;QACjD,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC3B,CAAC;IAEO,iBAAiB;QACvB,MAAM,MAAM,GAAG,IAAI,GAAG,EAAe,CAAC;QACtC,IAAI,CAAC,EAAE,GAAG;YACR,GAAG,EAAE,GAAG,EAAE,GAAE,CAAC;YACb,GAAG,EAAE,CAAC,GAAG,EAAE,MAAM,EAAE,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,CAAC;YAC7C,GAAG,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;YACtC,IAAI,EAAE,GAAG,EAAE,GAAE,CAAC;YACd,MAAM,EAAE,GAAG,EAAE,GAAE,CAAC;YAChB,OAAO,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;gBACjB,GAAG,EAAE,CAAC,GAAG,MAAa,EAAE,EAAE;oBACxB,IAAI,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC;wBAC3B,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE;4BACpB,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC;4BACb,UAAU,EAAE,MAAM,CAAC,CAAC,CAAC;4BACrB,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;4BAClB,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;4BAChB,MAAM,EAAE,QAAQ;4BAChB,QAAQ,EAAE,CAAC;4BACX,UAAU,EAAE,IAAI,CAAC,GAAG,EAAE;yBACvB,CAAC,CAAC;oBACL,CAAC;oBACD,OAAO,EAAE,OAAO,EAAE,CAAC,EAAE,CAAC;gBACxB,CAAC;gBACD,GAAG,EAAE,CAAC,GAAG,MAAa,EAAE,EAAE,CAAC,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAChD,GAAG,EAAE,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;aACvC,CAAC;YACF,KAAK,EAAE,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,EAAE;SAC5B,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;QAC1B,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IAC1B,CAAC;IAEO,UAAU;QAChB,IAAI,IAAI,CAAC,WAAW;YAAE,OAAO;QAE7B,oDAAoD;QACpD,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC;QACrC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,sBAAsB,CAAC,CAAC;QAEvC,gBAAgB;QAChB,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;KAiCZ,CAAC,CAAC;QAEH,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;IAC1B,CAAC;IAED;;OAEG;IACH,MAAM,CACJ,OAAsB,EACtB,SAAiB,EACjB,KAAqB;QAErB,MAAM,EAAE,GAAG,UAAU,IAAI,EAAE,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;QAC1C,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAEvB,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;;KAG5B,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,IAAI,IAAI,EAAE,GAAG,CAAC,CAAC;QAErD,uBAAuB;QACvB,MAAM,WAAW,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;KAEnC,CAAC,CAAC;QACH,WAAW,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;QAEpB,OAAO,EAAE,CAAC;IACZ,CAAC;IAED;;OAEG;IACH,GAAG,CAAC,QAAkB;QACpB,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;KAE5B,CAAC,CAAC;QAEH,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAQ,CAAC;QACtC,IAAI,CAAC,GAAG;YAAE,OAAO,IAAI,CAAC;QAEtB,OAAO,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;IACnC,CAAC;IAED;;OAEG;IACH,YAAY,CACV,QAAkB,EAClB,MAAoB,EACpB,KAKC;QAED,MAAM,OAAO,GAAa,CAAC,YAAY,CAAC,CAAC;QACzC,MAAM,MAAM,GAAU,CAAC,MAAM,CAAC,CAAC;QAE/B,IAAI,MAAM,KAAK,SAAS,IAAI,CAAC,KAAK,EAAE,QAAQ,EAAE,CAAC;YAC7C,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC/B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QAC1B,CAAC;QAED,IAAI,MAAM,KAAK,UAAU,IAAI,MAAM,KAAK,QAAQ,IAAI,MAAM,KAAK,WAAW,EAAE,CAAC;YAC3E,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACjC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;QAC1B,CAAC;QAED,IAAI,KAAK,EAAE,QAAQ,KAAK,SAAS,EAAE,CAAC;YAClC,OAAO,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;YAC7B,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAC9B,CAAC;QAED,IAAI,KAAK,EAAE,YAAY,KAAK,SAAS,EAAE,CAAC;YACtC,OAAO,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAClC,CAAC;QAED,IAAI,KAAK,EAAE,KAAK,KAAK,SAAS,EAAE,CAAC;YAC/B,OAAO,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAC3B,CAAC;QAED,IAAI,KAAK,EAAE,OAAO,KAAK,SAAS,EAAE,CAAC;YACjC,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACjC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;QAC7C,CAAC;QAED,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAEtB,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;YAErB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC;;KAEzB,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;IACtB,CAAC;IAED;;OAEG;IACH,uBAAuB,CAAC,QAAkB,EAAE,GAAY;QACtD,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;;;;KAK5B,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,GAAG,IAAI,EAAE,EAAE,QAAQ,CAAC,CAAC;IAChC,CAAC;IAED;;OAEG;IACH,aAAa,CAAC,QAAkB,EAAE,OAA+B;QAC/D,MAAM,OAAO,GAAa,EAAE,CAAC;QAC7B,MAAM,MAAM,GAAU,EAAE,CAAC;QAEzB,IAAI,OAAO,CAAC,aAAa,KAAK,SAAS,EAAE,CAAC;YACxC,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YACnC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACrC,CAAC;QACD,IAAI,OAAO,CAAC,aAAa,KAAK,SAAS,EAAE,CAAC;YACxC,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YACnC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;QACrC,CAAC;QACD,IAAI,OAAO,CAAC,kBAAkB,KAAK,SAAS,EAAE,CAAC;YAC7C,OAAO,CAAC,IAAI,CAAC,0BAA0B,CAAC,CAAC;YACzC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC,CAAC;QAC1C,CAAC;QACD,IAAI,OAAO,CAAC,SAAS,KAAK,SAAS,EAAE,CAAC;YACpC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAChC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACjC,CAAC;QACD,IAAI,OAAO,CAAC,YAAY,KAAK,SAAS,EAAE,CAAC;YACvC,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YACnC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;QACpC,CAAC;QACD,IAAI,OAAO,CAAC,UAAU,KAAK,SAAS,EAAE,CAAC;YACrC,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAChC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAClC,CAAC;QAED,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC;YAAE,OAAO;QAEjC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAEtB,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;YAErB,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC;;KAEzB,CAAC,CAAC;QAEH,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC;IACtB,CAAC;IAED;;OAEG;IACH,MAAM,CAAC,OAMN;QACC,MAAM,UAAU,GAAa,EAAE,CAAC;QAChC,MAAM,MAAM,GAAU,EAAE,CAAC;QAEzB,IAAI,OAAO,EAAE,SAAS,EAAE,CAAC;YACvB,UAAU,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAClC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACjC,CAAC;QAED,IAAI,OAAO,EAAE,MAAM,EAAE,CAAC;YACpB,IAAI,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC;gBAClC,UAAU,CAAC,IAAI,CAAC,cAAc,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC3E,MAAM,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;YACjC,CAAC;iBAAM,CAAC;gBACN,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;gBAC9B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;YAC9B,CAAC;QACH,CAAC;QAED,IAAI,OAAO,EAAE,OAAO,EAAE,CAAC;YACrB,UAAU,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAC/B,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;QAC/B,CAAC;QAED,IAAI,OAAO,EAAE,KAAK,EAAE,CAAC;YACnB,UAAU,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACnC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC;QAED,IAAI,GAAG,GAAG,kCAAkC,CAAC;QAC7C,IAAI,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC1B,GAAG,IAAI,SAAS,GAAG,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC9C,CAAC;QACD,GAAG,IAAI,2BAA2B,CAAC;QAEnC,IAAI,OAAO,EAAE,KAAK,EAAE,CAAC;YACnB,GAAG,IAAI,UAAU,CAAC;YAClB,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QAC7B,CAAC;QAED,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAU,CAAC;QAE1C,OAAO,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,CAAC;IACpD,CAAC;IAED;;OAEG;IACH,SAAS,CAAC,SAAkB;QAC1B,OAAO,IAAI,CAAC,MAAM,CAAC;YACjB,SAAS;YACT,MAAM,EAAE,CAAC,QAAQ,EAAE,SAAS,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,aAAa,CAAC,SAAkB;QAC9B,IAAI,GAAG,GAAG;;;KAGT,CAAC;QACF,MAAM,MAAM,GAAU,EAAE,CAAC;QAEzB,IAAI,SAAS,EAAE,CAAC;YACd,GAAG,IAAI,uBAAuB,CAAC;YAC/B,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACzB,CAAC;QAED,GAAG,IAAI,kBAAkB,CAAC;QAE1B,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,MAAM,CAAU,CAAC;QAE1C,MAAM,MAAM,GAA2B;YACrC,MAAM,EAAE,CAAC;YACT,OAAO,EAAE,CAAC;YACV,QAAQ,EAAE,CAAC;YACX,MAAM,EAAE,CAAC;YACT,SAAS,EAAE,CAAC;YACZ,OAAO,EAAE,CAAC;SACX,CAAC;QAEF,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE,CAAC;YACvB,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC;QACjC,CAAC;QAED,OAAO,MAAsC,CAAC;IAChD,CAAC;IAED;;OAEG;IACH,UAAU,CAAC,QAAkB;QAC3B,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;KAE5B,CAAC,CAAC;QAEH,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAQ,CAAC;QACtC,IAAI,CAAC,GAAG;YAAE,OAAO,IAAI,CAAC;QAEtB,OAAO;YACL,QAAQ,EAAE,GAAG,CAAC,SAAS;YACvB,aAAa,EAAE,GAAG,CAAC,cAAc;YACjC,aAAa,EAAE,GAAG,CAAC,cAAc;YACjC,kBAAkB,EAAE,GAAG,CAAC,oBAAoB;YAC5C,SAAS,EAAE,GAAG,CAAC,WAAW;YAC1B,YAAY,EAAE,GAAG,CAAC,cAAc;YAChC,UAAU,EAAE,GAAG,CAAC,WAAW;SAC5B,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,OAAO,CAAC,SAAiB,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;QAC1C,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,MAAM,CAAC;QAEnC,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;;KAG5B,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;QAChC,OAAO,MAAM,CAAC,OAAO,CAAC;IACxB,CAAC;IAED;;OAEG;IACH,QAAQ,CAAC,YAAiC,KAAK;QAM7C,MAAM,KAAK,GAAG;YACZ,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;YACjC,KAAK,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;YACvC,IAAI,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI;SAC3C,CAAC,SAAS,CAAC,CAAC;QAEb,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;;;;;KAM5B,CAAC,CAAC;QAEH,MAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAQ,CAAC;QAEnC,OAAO;YACL,KAAK,EAAE,GAAG,CAAC,KAAK;YAChB,QAAQ,EAAE,IAAI,CAAC,aAAa,EAAE;YAC9B,SAAS,EAAE,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC;YACrC,WAAW,EAAE,GAAG,CAAC,YAAY,IAAI,CAAC;SACnC,CAAC;IACJ,CAAC;IAEO,cAAc,CAAC,KAAa;QAClC,MAAM,IAAI,GAAG,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC;;;;;KAK5B,CAAC,CAAC;QAEH,MAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAU,CAAC;QACtC,MAAM,MAAM,GAA2B,EAAE,CAAC;QAE1C,KAAK,MAAM,GAAG,IAAI,IAAI,EAAE,CAAC;YACvB,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC;QAClC,CAAC;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;IAEO,eAAe,CAAC,GAAQ;QAC9B,IAAI,OAAO,GAA0B,SAAS,CAAC;QAC/C,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,IAAI,IAAI,CAAC,CAAC;YACpD,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBACnC,OAAO,GAAG,MAAM,CAAC;YACnB,CAAC;QACH,CAAC;QAAC,MAAM,CAAC;YACP,uBAAuB;QACzB,CAAC;QAED,OAAO;YACL,EAAE,EAAE,GAAG,CAAC,EAAE;YACV,OAAO,EAAE,GAAG,CAAC,OAAwB;YACrC,KAAK,EAAE,GAAG,CAAC,KAAK;YAChB,SAAS,EAAE,GAAG,CAAC,UAAU;YACzB,MAAM,EAAE,GAAG,CAAC,MAAsB;YAClC,QAAQ,EAAE,GAAG,CAAC,QAAQ;YACtB,YAAY,EAAE,GAAG,CAAC,aAAa;YAC/B,SAAS,EAAE,GAAG,CAAC,UAAU;YACzB,WAAW,EAAE,GAAG,CAAC,YAAY;YAC7B,KAAK,EAAE,GAAG,CAAC,aAAa;YACxB,cAAc,EAAE,GAAG,CAAC,eAAe;YACnC,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,WAAW,IAAI,IAAI,CAAC;YAC/C,SAAS,EAAE,GAAG,CAAC,UAAU;YACzB,OAAO;SACR,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,KAAK;QACH,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,CAAC;IAClB,CAAC;CACF;AAED,qBAAqB;AACrB,IAAI,QAAQ,GAA0B,IAAI,CAAC;AAE3C,MAAM,UAAU,iBAAiB;IAC/B,IAAI,CAAC,QAAQ,EAAE,CAAC;QACd,QAAQ,GAAG,IAAI,cAAc,EAAE,CAAC;IAClC,CAAC;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC","sourcesContent":["/**\n * WorkerRegistry - SQLite-backed persistence for background workers\n *\n * Supports both better-sqlite3 (native) and sql.js (WASM) backends.\n * Automatically falls back to sql.js on Windows or when native fails.\n */\n\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ulid } from 'ulid';\nimport {\n  WorkerId,\n  WorkerTrigger,\n  WorkerStatus,\n  WorkerInfo,\n  WorkerMetrics\n} from './types.js';\n\nconst DB_DIR = '.agentic-flow';\nconst DB_FILE = 'workers.db';\n\n// Database interface for both backends\ninterface DbWrapper {\n  run(sql: string, params?: any[]): void;\n  get<T>(sql: string, params?: any[]): T | undefined;\n  all<T>(sql: string, params?: any[]): T[];\n  exec(sql: string): void;\n  pragma(directive: string): void;\n  prepare(sql: string): {\n    run(...params: any[]): any;\n    get(...params: any[]): any;\n    all(...params: any[]): any[];\n  };\n  close(): void;\n}\n\n// Create wrapper for better-sqlite3\nfunction createBetterSqliteWrapper(db: any): DbWrapper {\n  return {\n    run: (sql, params) => db.prepare(sql).run(...(params || [])),\n    get: (sql, params) => db.prepare(sql).get(...(params || [])),\n    all: (sql, params) => db.prepare(sql).all(...(params || [])),\n    exec: (sql) => db.exec(sql),\n    pragma: (directive) => db.pragma(directive),\n    prepare: (sql) => db.prepare(sql),\n    close: () => db.close()\n  };\n}\n\n// Create wrapper for sql.js\nfunction createSqlJsWrapper(db: any, dbPath: string): DbWrapper {\n  // sql.js needs manual save\n  const saveDb = () => {\n    try {\n      const data = db.export();\n      const buffer = Buffer.from(data);\n      fs.writeFileSync(dbPath, buffer);\n    } catch { /* ignore save errors */ }\n  };\n\n  return {\n    run: (sql, params) => {\n      db.run(sql, params);\n      saveDb();\n    },\n    get: (sql, params) => {\n      const stmt = db.prepare(sql);\n      stmt.bind(params);\n      if (stmt.step()) {\n        const row = stmt.getAsObject();\n        stmt.free();\n        return row;\n      }\n      stmt.free();\n      return undefined;\n    },\n    all: (sql, params) => {\n      const results: any[] = [];\n      const stmt = db.prepare(sql);\n      if (params) stmt.bind(params);\n      while (stmt.step()) {\n        results.push(stmt.getAsObject());\n      }\n      stmt.free();\n      return results;\n    },\n    exec: (sql) => {\n      db.exec(sql);\n      saveDb();\n    },\n    pragma: () => { /* sql.js doesn't support all pragmas */ },\n    prepare: (sql) => {\n      const stmt = db.prepare(sql);\n      return {\n        run: (...params: any[]) => {\n          stmt.bind(params);\n          stmt.step();\n          stmt.reset();\n          saveDb();\n          return { changes: db.getRowsModified() };\n        },\n        get: (...params: any[]) => {\n          stmt.bind(params);\n          if (stmt.step()) {\n            const row = stmt.getAsObject();\n            stmt.reset();\n            return row;\n          }\n          stmt.reset();\n          return undefined;\n        },\n        all: (...params: any[]) => {\n          const results: any[] = [];\n          stmt.bind(params);\n          while (stmt.step()) {\n            results.push(stmt.getAsObject());\n          }\n          stmt.reset();\n          return results;\n        }\n      };\n    },\n    close: () => {\n      saveDb();\n      db.close();\n    }\n  };\n}\n\nexport class WorkerRegistry {\n  private db!: DbWrapper;\n  private initialized = false;\n  private dbBackend: 'better-sqlite3' | 'sql.js' | 'memory' = 'memory';\n  private dbPath: string;\n\n  constructor(dbPath?: string) {\n    const dir = path.join(process.cwd(), DB_DIR);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n\n    this.dbPath = dbPath || path.join(dir, DB_FILE);\n    this.initializeSync();\n  }\n\n  private initializeSync(): void {\n    // Try better-sqlite3 first (fastest, native)\n    try {\n      const Database = require('better-sqlite3');\n      this.db = createBetterSqliteWrapper(new Database(this.dbPath));\n      this.dbBackend = 'better-sqlite3';\n      this.initialize();\n      return;\n    } catch {\n      // better-sqlite3 not available (Windows without build tools, etc.)\n    }\n\n    // Try sql.js (WASM, cross-platform)\n    try {\n      const initSqlJs = require('sql.js');\n      // sql.js init is async, but we need sync for constructor\n      // Use a synchronous workaround by loading existing data\n      const sqlPromise = initSqlJs().then((SQL: any) => {\n        let db;\n        try {\n          const fileBuffer = fs.readFileSync(this.dbPath);\n          db = new SQL.Database(fileBuffer);\n        } catch {\n          db = new SQL.Database();\n        }\n        this.db = createSqlJsWrapper(db, this.dbPath);\n        this.dbBackend = 'sql.js';\n        this.initialize();\n      });\n\n      // For now, use memory fallback until sql.js loads\n      this.useMemoryFallback();\n\n      // Replace with sql.js when ready\n      sqlPromise.catch(() => {\n        // Keep memory fallback\n      });\n      return;\n    } catch {\n      // sql.js not available\n    }\n\n    // Final fallback: in-memory Map (no persistence)\n    this.useMemoryFallback();\n  }\n\n  private useMemoryFallback(): void {\n    const memory = new Map<string, any>();\n    this.db = {\n      run: () => {},\n      get: (sql, params) => memory.get(params?.[0]),\n      all: () => Array.from(memory.values()),\n      exec: () => {},\n      pragma: () => {},\n      prepare: (sql) => ({\n        run: (...params: any[]) => {\n          if (sql.includes('INSERT')) {\n            memory.set(params[0], {\n              id: params[0],\n              session_id: params[1],\n              trigger: params[2],\n              topic: params[3],\n              status: 'queued',\n              progress: 0,\n              created_at: Date.now()\n            });\n          }\n          return { changes: 1 };\n        },\n        get: (...params: any[]) => memory.get(params[0]),\n        all: () => Array.from(memory.values())\n      }),\n      close: () => memory.clear()\n    };\n    this.dbBackend = 'memory';\n    this.initialized = true;\n  }\n\n  private initialize(): void {\n    if (this.initialized) return;\n\n    // Enable WAL mode for better concurrent performance\n    this.db.pragma('journal_mode = WAL');\n    this.db.pragma('synchronous = NORMAL');\n\n    // Create tables\n    this.db.exec(`\n      CREATE TABLE IF NOT EXISTS background_workers (\n        id TEXT PRIMARY KEY,\n        session_id TEXT NOT NULL,\n        trigger TEXT NOT NULL,\n        topic TEXT,\n        status TEXT DEFAULT 'queued',\n        progress INTEGER DEFAULT 0,\n        current_phase TEXT,\n        started_at INTEGER,\n        completed_at INTEGER,\n        error_message TEXT,\n        memory_deposits INTEGER DEFAULT 0,\n        result_keys TEXT DEFAULT '[]',\n        results_data TEXT DEFAULT '{}',\n        created_at INTEGER DEFAULT (strftime('%s', 'now') * 1000)\n      );\n\n      CREATE INDEX IF NOT EXISTS idx_workers_session ON background_workers(session_id);\n      CREATE INDEX IF NOT EXISTS idx_workers_status ON background_workers(status);\n      CREATE INDEX IF NOT EXISTS idx_workers_trigger ON background_workers(trigger);\n      CREATE INDEX IF NOT EXISTS idx_workers_created ON background_workers(created_at);\n\n      CREATE TABLE IF NOT EXISTS worker_metrics (\n        worker_id TEXT PRIMARY KEY,\n        files_analyzed INTEGER DEFAULT 0,\n        patterns_found INTEGER DEFAULT 0,\n        memory_bytes_written INTEGER DEFAULT 0,\n        cpu_time_ms INTEGER DEFAULT 0,\n        peak_memory_mb REAL DEFAULT 0,\n        error_count INTEGER DEFAULT 0,\n        FOREIGN KEY (worker_id) REFERENCES background_workers(id)\n      );\n    `);\n\n    this.initialized = true;\n  }\n\n  /**\n   * Create a new worker entry\n   */\n  create(\n    trigger: WorkerTrigger,\n    sessionId: string,\n    topic?: string | null\n  ): WorkerId {\n    const id = `worker-${ulid().slice(0, 8)}`;\n    const now = Date.now();\n\n    const stmt = this.db.prepare(`\n      INSERT INTO background_workers (id, session_id, trigger, topic, created_at)\n      VALUES (?, ?, ?, ?, ?)\n    `);\n\n    stmt.run(id, sessionId, trigger, topic || null, now);\n\n    // Create metrics entry\n    const metricsStmt = this.db.prepare(`\n      INSERT INTO worker_metrics (worker_id) VALUES (?)\n    `);\n    metricsStmt.run(id);\n\n    return id;\n  }\n\n  /**\n   * Get worker by ID\n   */\n  get(workerId: WorkerId): WorkerInfo | null {\n    const stmt = this.db.prepare(`\n      SELECT * FROM background_workers WHERE id = ?\n    `);\n\n    const row = stmt.get(workerId) as any;\n    if (!row) return null;\n\n    return this.rowToWorkerInfo(row);\n  }\n\n  /**\n   * Update worker status\n   */\n  updateStatus(\n    workerId: WorkerId,\n    status: WorkerStatus,\n    extra?: {\n      progress?: number;\n      currentPhase?: string;\n      error?: string;\n      results?: Record<string, unknown>;\n    }\n  ): void {\n    const updates: string[] = ['status = ?'];\n    const params: any[] = [status];\n\n    if (status === 'running' && !extra?.progress) {\n      updates.push('started_at = ?');\n      params.push(Date.now());\n    }\n\n    if (status === 'complete' || status === 'failed' || status === 'cancelled') {\n      updates.push('completed_at = ?');\n      params.push(Date.now());\n    }\n\n    if (extra?.progress !== undefined) {\n      updates.push('progress = ?');\n      params.push(extra.progress);\n    }\n\n    if (extra?.currentPhase !== undefined) {\n      updates.push('current_phase = ?');\n      params.push(extra.currentPhase);\n    }\n\n    if (extra?.error !== undefined) {\n      updates.push('error_message = ?');\n      params.push(extra.error);\n    }\n\n    if (extra?.results !== undefined) {\n      updates.push('results_data = ?');\n      params.push(JSON.stringify(extra.results));\n    }\n\n    params.push(workerId);\n\n    const stmt = this.db.prepare(`\n      UPDATE background_workers\n      SET ${updates.join(', ')}\n      WHERE id = ?\n    `);\n\n    stmt.run(...params);\n  }\n\n  /**\n   * Increment memory deposits counter\n   */\n  incrementMemoryDeposits(workerId: WorkerId, key?: string): void {\n    const stmt = this.db.prepare(`\n      UPDATE background_workers\n      SET memory_deposits = memory_deposits + 1,\n          result_keys = json_insert(result_keys, '$[#]', ?)\n      WHERE id = ?\n    `);\n\n    stmt.run(key || '', workerId);\n  }\n\n  /**\n   * Update worker metrics\n   */\n  updateMetrics(workerId: WorkerId, metrics: Partial<WorkerMetrics>): void {\n    const updates: string[] = [];\n    const params: any[] = [];\n\n    if (metrics.filesAnalyzed !== undefined) {\n      updates.push('files_analyzed = ?');\n      params.push(metrics.filesAnalyzed);\n    }\n    if (metrics.patternsFound !== undefined) {\n      updates.push('patterns_found = ?');\n      params.push(metrics.patternsFound);\n    }\n    if (metrics.memoryBytesWritten !== undefined) {\n      updates.push('memory_bytes_written = ?');\n      params.push(metrics.memoryBytesWritten);\n    }\n    if (metrics.cpuTimeMs !== undefined) {\n      updates.push('cpu_time_ms = ?');\n      params.push(metrics.cpuTimeMs);\n    }\n    if (metrics.peakMemoryMB !== undefined) {\n      updates.push('peak_memory_mb = ?');\n      params.push(metrics.peakMemoryMB);\n    }\n    if (metrics.errorCount !== undefined) {\n      updates.push('error_count = ?');\n      params.push(metrics.errorCount);\n    }\n\n    if (updates.length === 0) return;\n\n    params.push(workerId);\n\n    const stmt = this.db.prepare(`\n      UPDATE worker_metrics\n      SET ${updates.join(', ')}\n      WHERE worker_id = ?\n    `);\n\n    stmt.run(...params);\n  }\n\n  /**\n   * Get all workers, optionally filtered\n   */\n  getAll(options?: {\n    sessionId?: string;\n    status?: WorkerStatus | WorkerStatus[];\n    trigger?: WorkerTrigger;\n    limit?: number;\n    since?: number;\n  }): WorkerInfo[] {\n    const conditions: string[] = [];\n    const params: any[] = [];\n\n    if (options?.sessionId) {\n      conditions.push('session_id = ?');\n      params.push(options.sessionId);\n    }\n\n    if (options?.status) {\n      if (Array.isArray(options.status)) {\n        conditions.push(`status IN (${options.status.map(() => '?').join(', ')})`);\n        params.push(...options.status);\n      } else {\n        conditions.push('status = ?');\n        params.push(options.status);\n      }\n    }\n\n    if (options?.trigger) {\n      conditions.push('trigger = ?');\n      params.push(options.trigger);\n    }\n\n    if (options?.since) {\n      conditions.push('created_at >= ?');\n      params.push(options.since);\n    }\n\n    let sql = 'SELECT * FROM background_workers';\n    if (conditions.length > 0) {\n      sql += ' WHERE ' + conditions.join(' AND ');\n    }\n    sql += ' ORDER BY created_at DESC';\n\n    if (options?.limit) {\n      sql += ' LIMIT ?';\n      params.push(options.limit);\n    }\n\n    const stmt = this.db.prepare(sql);\n    const rows = stmt.all(...params) as any[];\n\n    return rows.map(row => this.rowToWorkerInfo(row));\n  }\n\n  /**\n   * Get active workers (queued or running)\n   */\n  getActive(sessionId?: string): WorkerInfo[] {\n    return this.getAll({\n      sessionId,\n      status: ['queued', 'running']\n    });\n  }\n\n  /**\n   * Count workers by status\n   */\n  countByStatus(sessionId?: string): Record<WorkerStatus, number> {\n    let sql = `\n      SELECT status, COUNT(*) as count\n      FROM background_workers\n    `;\n    const params: any[] = [];\n\n    if (sessionId) {\n      sql += ' WHERE session_id = ?';\n      params.push(sessionId);\n    }\n\n    sql += ' GROUP BY status';\n\n    const stmt = this.db.prepare(sql);\n    const rows = stmt.all(...params) as any[];\n\n    const counts: Record<string, number> = {\n      queued: 0,\n      running: 0,\n      complete: 0,\n      failed: 0,\n      cancelled: 0,\n      timeout: 0\n    };\n\n    for (const row of rows) {\n      counts[row.status] = row.count;\n    }\n\n    return counts as Record<WorkerStatus, number>;\n  }\n\n  /**\n   * Get worker metrics\n   */\n  getMetrics(workerId: WorkerId): WorkerMetrics | null {\n    const stmt = this.db.prepare(`\n      SELECT * FROM worker_metrics WHERE worker_id = ?\n    `);\n\n    const row = stmt.get(workerId) as any;\n    if (!row) return null;\n\n    return {\n      workerId: row.worker_id,\n      filesAnalyzed: row.files_analyzed,\n      patternsFound: row.patterns_found,\n      memoryBytesWritten: row.memory_bytes_written,\n      cpuTimeMs: row.cpu_time_ms,\n      peakMemoryMB: row.peak_memory_mb,\n      errorCount: row.error_count\n    };\n  }\n\n  /**\n   * Delete old workers\n   */\n  cleanup(maxAge: number = 24 * 60 * 60 * 1000): number {\n    const cutoff = Date.now() - maxAge;\n\n    const stmt = this.db.prepare(`\n      DELETE FROM background_workers\n      WHERE created_at < ? AND status IN ('complete', 'failed', 'cancelled', 'timeout')\n    `);\n\n    const result = stmt.run(cutoff);\n    return result.changes;\n  }\n\n  /**\n   * Get aggregated stats for dashboard\n   */\n  getStats(timeframe: '1h' | '24h' | '7d' = '24h'): {\n    total: number;\n    byStatus: Record<WorkerStatus, number>;\n    byTrigger: Record<string, number>;\n    avgDuration: number;\n  } {\n    const since = {\n      '1h': Date.now() - 60 * 60 * 1000,\n      '24h': Date.now() - 24 * 60 * 60 * 1000,\n      '7d': Date.now() - 7 * 24 * 60 * 60 * 1000\n    }[timeframe];\n\n    const stmt = this.db.prepare(`\n      SELECT\n        COUNT(*) as total,\n        AVG(CASE WHEN completed_at IS NOT NULL THEN completed_at - started_at ELSE NULL END) as avg_duration\n      FROM background_workers\n      WHERE created_at >= ?\n    `);\n\n    const row = stmt.get(since) as any;\n\n    return {\n      total: row.total,\n      byStatus: this.countByStatus(),\n      byTrigger: this.countByTrigger(since),\n      avgDuration: row.avg_duration || 0\n    };\n  }\n\n  private countByTrigger(since: number): Record<string, number> {\n    const stmt = this.db.prepare(`\n      SELECT trigger, COUNT(*) as count\n      FROM background_workers\n      WHERE created_at >= ?\n      GROUP BY trigger\n    `);\n\n    const rows = stmt.all(since) as any[];\n    const counts: Record<string, number> = {};\n\n    for (const row of rows) {\n      counts[row.trigger] = row.count;\n    }\n\n    return counts;\n  }\n\n  private rowToWorkerInfo(row: any): WorkerInfo {\n    let results: WorkerInfo['results'] = undefined;\n    try {\n      const parsed = JSON.parse(row.results_data || '{}');\n      if (Object.keys(parsed).length > 0) {\n        results = parsed;\n      }\n    } catch {\n      // Invalid JSON, ignore\n    }\n\n    return {\n      id: row.id,\n      trigger: row.trigger as WorkerTrigger,\n      topic: row.topic,\n      sessionId: row.session_id,\n      status: row.status as WorkerStatus,\n      progress: row.progress,\n      currentPhase: row.current_phase,\n      startedAt: row.started_at,\n      completedAt: row.completed_at,\n      error: row.error_message,\n      memoryDeposits: row.memory_deposits,\n      resultKeys: JSON.parse(row.result_keys || '[]'),\n      createdAt: row.created_at,\n      results\n    };\n  }\n\n  /**\n   * Close database connection\n   */\n  close(): void {\n    this.db.close();\n  }\n}\n\n// Singleton instance\nlet instance: WorkerRegistry | null = null;\n\nexport function getWorkerRegistry(): WorkerRegistry {\n  if (!instance) {\n    instance = new WorkerRegistry();\n  }\n  return instance;\n}\n"]}