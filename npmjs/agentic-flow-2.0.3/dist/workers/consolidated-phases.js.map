{"version":3,"file":"consolidated-phases.js","sourceRoot":"","sources":["../../src/workers/consolidated-phases.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Consolidated Phase System\n *\n * Eliminates redundancy between phase-executors.ts and ruvector-native-integration.ts\n * by providing a unified phase registry that:\n * 1. Uses native implementations as primary (faster, SIMD-optimized)\n * 2. Falls back to legacy implementations if needed\n * 3. Shares the cached ONNX embedder across all phases\n */\n\nimport { WorkerContext } from './types.js';\nimport { PhaseResult, FileFilterConfig, DEFAULT_FILE_FILTER } from './custom-worker-config.js';\nimport { getCachedOnnxEmbedder } from '../utils/model-cache.js';\n\n// ============================================================================\n// Unified Phase Context\n// ============================================================================\n\nexport interface UnifiedPhaseContext {\n  files: string[];\n  patterns: string[];\n  bytes: number;\n  dependencies: Map<string, string[]>;\n  metrics: Record<string, number>;\n  embeddings: Map<string, Float32Array>;\n  vectors: Map<string, number[]>;\n  phaseData: Map<string, Record<string, unknown>>;\n  vulnerabilities: Array<{ type: string; file: string; line: number; severity: string }>;\n}\n\nexport function createUnifiedContext(): UnifiedPhaseContext {\n  return {\n    files: [],\n    patterns: [],\n    bytes: 0,\n    dependencies: new Map(),\n    metrics: {},\n    embeddings: new Map(),\n    vectors: new Map(),\n    phaseData: new Map(),\n    vulnerabilities: []\n  };\n}\n\n// ============================================================================\n// Unified Phase Executor\n// ============================================================================\n\nexport type UnifiedPhaseExecutor = (\n  workerContext: WorkerContext,\n  phaseContext: UnifiedPhaseContext,\n  options: Record<string, unknown>\n) => Promise<PhaseResult>;\n\nconst unifiedExecutors = new Map<string, UnifiedPhaseExecutor>();\n\nexport function registerUnifiedPhase(type: string, executor: UnifiedPhaseExecutor): void {\n  unifiedExecutors.set(type, executor);\n}\n\nexport function getUnifiedPhase(type: string): UnifiedPhaseExecutor | undefined {\n  return unifiedExecutors.get(type);\n}\n\nexport function listUnifiedPhases(): string[] {\n  return Array.from(unifiedExecutors.keys());\n}\n\n// ============================================================================\n// Core Phases (Consolidated - No Duplication)\n// ============================================================================\n\n// FILE DISCOVERY - Single implementation\nregisterUnifiedPhase('file-discovery', async (workerContext, phaseContext, options) => {\n  const { glob } = await import('glob');\n  const filter = { ...DEFAULT_FILE_FILTER, ...options } as FileFilterConfig;\n  const patterns = (options.patterns as string[]) || filter.include || ['**/*.{ts,js,tsx,jsx}'];\n  const ignore = (options.ignore as string[]) || filter.exclude || ['node_modules/**', 'dist/**', '.git/**'];\n\n  try {\n    const allFiles: string[] = [];\n    for (const pattern of patterns) {\n      const files = await glob(pattern, {\n        cwd: process.cwd(),\n        ignore,\n        absolute: true,\n        nodir: true,\n        maxDepth: filter.maxDepth || 10\n      });\n      allFiles.push(...files);\n    }\n\n    // Deduplicate and limit\n    phaseContext.files = [...new Set(allFiles)].slice(0, filter.maxFiles || 500);\n    phaseContext.metrics['files_discovered'] = phaseContext.files.length;\n\n    return {\n      success: true,\n      data: { filesFound: phaseContext.files.length, patterns },\n      files: phaseContext.files\n    };\n  } catch (error) {\n    return {\n      success: false,\n      data: {},\n      error: error instanceof Error ? error.message : 'File discovery failed'\n    };\n  }\n});\n\n// PATTERN EXTRACTION - Single implementation\nregisterUnifiedPhase('pattern-extraction', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n  const patterns: string[] = [];\n\n  const extractors = [\n    { regex: /(?:export\\s+)?(?:async\\s+)?function\\s+(\\w+)/g, type: 'function' },\n    { regex: /(?:export\\s+)?class\\s+(\\w+)/g, type: 'class' },\n    { regex: /(?:export\\s+)?interface\\s+(\\w+)/g, type: 'interface' },\n    { regex: /(?:export\\s+)?type\\s+(\\w+)\\s*=/g, type: 'type' },\n    { regex: /(?:const|let|var)\\s+(\\w+)\\s*=/g, type: 'variable' },\n    { regex: /import\\s+.*?from\\s+['\"]([^'\"]+)['\"]/g, type: 'import' },\n    { regex: /TODO:?\\s*(.+?)$/gm, type: 'todo' },\n    { regex: /FIXME:?\\s*(.+?)$/gm, type: 'fixme' }\n  ];\n\n  const maxFiles = Math.min(phaseContext.files.length, 100);\n  let bytesProcessed = 0;\n\n  for (let i = 0; i < maxFiles; i++) {\n    const file = phaseContext.files[i];\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      bytesProcessed += content.length;\n\n      for (const { regex } of extractors) {\n        const matches = content.matchAll(regex);\n        for (const match of matches) {\n          patterns.push(match[1] || match[0]);\n        }\n      }\n    } catch {\n      // Skip unreadable files\n    }\n  }\n\n  phaseContext.patterns.push(...patterns);\n  phaseContext.bytes += bytesProcessed;\n  phaseContext.metrics['patterns_found'] = patterns.length;\n\n  return {\n    success: true,\n    data: {\n      patternsFound: patterns.length,\n      bytesProcessed,\n      samplePatterns: [...new Set(patterns)].slice(0, 20)\n    },\n    patterns: phaseContext.patterns\n  };\n});\n\n// EMBEDDING GENERATION - Single implementation using cached embedder\nregisterUnifiedPhase('embedding-generation', async (workerContext, phaseContext, options) => {\n  const embedder = await getCachedOnnxEmbedder();\n\n  if (!embedder) {\n    return {\n      success: false,\n      data: {},\n      error: 'ONNX embedder not available - install ruvector for SIMD-accelerated embeddings'\n    };\n  }\n\n  const textsToEmbed = phaseContext.patterns.slice(0, 100);\n  let embeddingsGenerated = 0;\n  const startTime = Date.now();\n\n  for (const text of textsToEmbed) {\n    if (text.length > 3 && text.length < 500) {\n      try {\n        const embedding = await embedder.embed?.(text)\n          || await embedder.encode?.(text)\n          || await embedder.generate?.(text);\n\n        if (embedding) {\n          const vector = embedding instanceof Float32Array\n            ? embedding\n            : new Float32Array(embedding);\n          phaseContext.embeddings.set(text, vector);\n          embeddingsGenerated++;\n        }\n      } catch {\n        // Skip failed embeddings\n      }\n    }\n  }\n\n  const durationMs = Date.now() - startTime;\n  phaseContext.metrics['embeddings_generated'] = embeddingsGenerated;\n  phaseContext.metrics['embedding_latency_ms'] = durationMs;\n\n  return {\n    success: true,\n    data: {\n      embeddingsGenerated,\n      dimension: 384,\n      durationMs,\n      throughputPerSec: embeddingsGenerated > 0 ? (embeddingsGenerated / (durationMs / 1000)).toFixed(1) : '0',\n      usingSIMD: true\n    }\n  };\n});\n\n// VECTOR STORAGE - Single implementation\nregisterUnifiedPhase('vector-storage', async (workerContext, phaseContext, options) => {\n  let vectorsStored = 0;\n\n  for (const [key, embedding] of phaseContext.embeddings) {\n    phaseContext.vectors.set(key, Array.from(embedding));\n    vectorsStored++;\n  }\n\n  phaseContext.metrics['vectors_stored'] = vectorsStored;\n\n  return {\n    success: true,\n    data: {\n      vectorsStored,\n      indexSize: vectorsStored,\n      dimension: 384\n    }\n  };\n});\n\n// SECURITY ANALYSIS - Single comprehensive implementation\nregisterUnifiedPhase('security-analysis', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n\n  const securityPatterns = [\n    // High severity\n    { pattern: /password\\s*[:=]\\s*['\"][^'\"]+['\"]/gi, type: 'hardcoded-password', severity: 'high' },\n    { pattern: /api[_-]?key\\s*[:=]\\s*['\"][^'\"]+['\"]/gi, type: 'hardcoded-api-key', severity: 'high' },\n    { pattern: /secret\\s*[:=]\\s*['\"][^'\"]+['\"]/gi, type: 'hardcoded-secret', severity: 'high' },\n    { pattern: /private[_-]?key\\s*[:=]\\s*['\"][^'\"]+['\"]/gi, type: 'hardcoded-private-key', severity: 'high' },\n    { pattern: /bearer\\s+[a-zA-Z0-9_-]+/gi, type: 'exposed-token', severity: 'high' },\n    // Medium severity\n    { pattern: /eval\\s*\\(/g, type: 'eval-usage', severity: 'medium' },\n    { pattern: /innerHTML\\s*=/g, type: 'xss-risk', severity: 'medium' },\n    { pattern: /dangerouslySetInnerHTML/g, type: 'xss-risk', severity: 'medium' },\n    { pattern: /child_process.*exec/g, type: 'command-injection-risk', severity: 'medium' },\n    { pattern: /\\$\\{.*\\}/g, type: 'template-injection', severity: 'medium' },\n    { pattern: /document\\.(write|cookie)/g, type: 'dom-manipulation', severity: 'medium' },\n    // Low severity\n    { pattern: /console\\.(log|debug|info)/g, type: 'console-output', severity: 'low' },\n    { pattern: /process\\.env\\.\\w+/g, type: 'env-usage', severity: 'low' },\n    { pattern: /TODO.*security|FIXME.*security/gi, type: 'security-todo', severity: 'low' }\n  ];\n\n  const vulnerabilities: typeof phaseContext.vulnerabilities = [];\n  const maxFiles = Math.min(phaseContext.files.length, 100);\n\n  for (let i = 0; i < maxFiles; i++) {\n    const file = phaseContext.files[i];\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      const lines = content.split('\\n');\n\n      for (let lineNum = 0; lineNum < lines.length; lineNum++) {\n        const line = lines[lineNum];\n        for (const { pattern, type, severity } of securityPatterns) {\n          pattern.lastIndex = 0; // Reset regex\n          if (pattern.test(line)) {\n            vulnerabilities.push({\n              type,\n              file: file.split('/').pop() || file,\n              line: lineNum + 1,\n              severity\n            });\n          }\n        }\n      }\n    } catch {\n      // Skip unreadable files\n    }\n  }\n\n  phaseContext.vulnerabilities.push(...vulnerabilities);\n  phaseContext.metrics['vulnerabilities_found'] = vulnerabilities.length;\n\n  const summary = {\n    high: vulnerabilities.filter(v => v.severity === 'high').length,\n    medium: vulnerabilities.filter(v => v.severity === 'medium').length,\n    low: vulnerabilities.filter(v => v.severity === 'low').length\n  };\n\n  return {\n    success: true,\n    data: {\n      vulnerabilities: vulnerabilities.slice(0, 30),\n      summary,\n      filesScanned: maxFiles\n    },\n    patterns: vulnerabilities.map(v => `[${v.severity}] ${v.type}`)\n  };\n});\n\n// COMPLEXITY ANALYSIS - Single implementation\nregisterUnifiedPhase('complexity-analysis', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n\n  const complexityMarkers = [\n    /\\bif\\s*\\(/g,\n    /\\belse\\s+if\\s*\\(/g,\n    /\\belse\\s*\\{/g,\n    /\\bfor\\s*\\(/g,\n    /\\bwhile\\s*\\(/g,\n    /\\bdo\\s*\\{/g,\n    /\\bswitch\\s*\\(/g,\n    /\\bcase\\s+/g,\n    /\\bcatch\\s*\\(/g,\n    /\\?\\s*.*:/g,  // Ternary\n    /&&|\\|\\|/g,   // Logical operators\n    /\\?\\./g       // Optional chaining\n  ];\n\n  const fileComplexity: Array<{ file: string; complexity: number; lines: number }> = [];\n  let totalComplexity = 0;\n  let totalLines = 0;\n\n  const maxFiles = Math.min(phaseContext.files.length, 100);\n\n  for (let i = 0; i < maxFiles; i++) {\n    const file = phaseContext.files[i];\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      const lines = content.split('\\n').length;\n      let complexity = 1; // Base complexity\n\n      for (const marker of complexityMarkers) {\n        const matches = content.match(marker);\n        if (matches) {\n          complexity += matches.length;\n        }\n      }\n\n      fileComplexity.push({\n        file: file.split('/').pop() || file,\n        complexity,\n        lines\n      });\n\n      totalComplexity += complexity;\n      totalLines += lines;\n    } catch {\n      // Skip unreadable files\n    }\n  }\n\n  fileComplexity.sort((a, b) => b.complexity - a.complexity);\n\n  phaseContext.metrics['total_complexity'] = totalComplexity;\n  phaseContext.metrics['total_lines'] = totalLines;\n  phaseContext.metrics['avg_complexity'] = maxFiles > 0 ? totalComplexity / maxFiles : 0;\n\n  return {\n    success: true,\n    data: {\n      avgComplexity: maxFiles > 0 ? (totalComplexity / maxFiles).toFixed(1) : '0',\n      totalLines,\n      filesAnalyzed: maxFiles,\n      highComplexityFiles: fileComplexity.filter(f => f.complexity > 20).length,\n      topFiles: fileComplexity.slice(0, 10)\n    }\n  };\n});\n\n// DEPENDENCY DISCOVERY - Single implementation\nregisterUnifiedPhase('dependency-discovery', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n  const dependencies = new Map<string, string[]>();\n\n  const importPatterns = [\n    /import\\s+.*?from\\s+['\"]([^'\"]+)['\"]/g,\n    /require\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/g,\n    /import\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*\\)/g\n  ];\n\n  const maxFiles = Math.min(phaseContext.files.length, 100);\n  let bytesProcessed = 0;\n\n  for (let i = 0; i < maxFiles; i++) {\n    const file = phaseContext.files[i];\n    const fileName = file.split('/').pop() || file;\n    const fileDeps: string[] = [];\n\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      bytesProcessed += content.length;\n\n      for (const pattern of importPatterns) {\n        const matches = content.matchAll(pattern);\n        for (const match of matches) {\n          const dep = match[1];\n          if (!fileDeps.includes(dep)) {\n            fileDeps.push(dep);\n          }\n        }\n      }\n\n      if (fileDeps.length > 0) {\n        dependencies.set(fileName, fileDeps);\n      }\n    } catch {\n      // Skip unreadable files\n    }\n  }\n\n  // Merge into context\n  for (const [file, deps] of dependencies) {\n    phaseContext.dependencies.set(file, deps);\n  }\n\n  phaseContext.bytes += bytesProcessed;\n  phaseContext.metrics['dependencies_found'] = dependencies.size;\n\n  return {\n    success: true,\n    data: {\n      filesWithDeps: dependencies.size,\n      totalDeps: Array.from(dependencies.values()).reduce((sum, deps) => sum + deps.length, 0),\n      bytesProcessed\n    }\n  };\n});\n\n// SUMMARIZATION - Single implementation\nregisterUnifiedPhase('summarization', async (workerContext, phaseContext, options) => {\n  return {\n    success: true,\n    data: {\n      summary: {\n        filesAnalyzed: phaseContext.files.length,\n        patternsFound: phaseContext.patterns.length,\n        uniquePatterns: [...new Set(phaseContext.patterns)].length,\n        bytesProcessed: phaseContext.bytes,\n        embeddingsGenerated: phaseContext.embeddings.size,\n        vectorsStored: phaseContext.vectors.size,\n        vulnerabilitiesFound: phaseContext.vulnerabilities.length,\n        dependencyFiles: phaseContext.dependencies.size\n      },\n      metrics: phaseContext.metrics\n    }\n  };\n});\n\n// ============================================================================\n// Additional Phases (Not duplicated)\n// ============================================================================\n\n// API DISCOVERY\nregisterUnifiedPhase('api-discovery', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n  const apis: Array<{ method: string; path: string; file: string }> = [];\n\n  const apiPatterns = [\n    /app\\.(get|post|put|delete|patch)\\s*\\(\\s*['\"]([^'\"]+)['\"]/gi,\n    /router\\.(get|post|put|delete|patch)\\s*\\(\\s*['\"]([^'\"]+)['\"]/gi,\n    /@(Get|Post|Put|Delete|Patch)\\s*\\(\\s*['\"]([^'\"]+)['\"]/gi,\n    /fetch\\s*\\(\\s*['\"]([^'\"]+)['\"]/gi\n  ];\n\n  for (const file of phaseContext.files.slice(0, 100)) {\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      for (const pattern of apiPatterns) {\n        const matches = content.matchAll(pattern);\n        for (const match of matches) {\n          apis.push({\n            method: match[1]?.toUpperCase() || 'GET',\n            path: match[2],\n            file: file.split('/').pop() || file\n          });\n        }\n      }\n    } catch {\n      // Skip\n    }\n  }\n\n  return {\n    success: true,\n    data: { apis: apis.slice(0, 50), totalApis: apis.length }\n  };\n});\n\n// TODO EXTRACTION\nregisterUnifiedPhase('todo-extraction', async (workerContext, phaseContext, options) => {\n  const fs = await import('fs/promises');\n  const todos: Array<{ type: string; text: string; file: string; line: number }> = [];\n\n  const todoPatterns = [\n    { pattern: /\\/\\/\\s*TODO:?\\s*(.+?)$/gm, type: 'TODO' },\n    { pattern: /\\/\\/\\s*FIXME:?\\s*(.+?)$/gm, type: 'FIXME' },\n    { pattern: /\\/\\/\\s*HACK:?\\s*(.+?)$/gm, type: 'HACK' },\n    { pattern: /\\/\\/\\s*XXX:?\\s*(.+?)$/gm, type: 'XXX' },\n    { pattern: /\\/\\*\\s*TODO:?\\s*(.+?)\\*\\//gm, type: 'TODO' }\n  ];\n\n  for (const file of phaseContext.files.slice(0, 100)) {\n    try {\n      const content = await fs.readFile(file, 'utf-8');\n      const lines = content.split('\\n');\n\n      for (let lineNum = 0; lineNum < lines.length; lineNum++) {\n        const line = lines[lineNum];\n        for (const { pattern, type } of todoPatterns) {\n          pattern.lastIndex = 0;\n          const match = pattern.exec(line);\n          if (match) {\n            todos.push({\n              type,\n              text: match[1].trim(),\n              file: file.split('/').pop() || file,\n              line: lineNum + 1\n            });\n          }\n        }\n      }\n    } catch {\n      // Skip\n    }\n  }\n\n  return {\n    success: true,\n    data: {\n      todos: todos.slice(0, 50),\n      counts: {\n        TODO: todos.filter(t => t.type === 'TODO').length,\n        FIXME: todos.filter(t => t.type === 'FIXME').length,\n        HACK: todos.filter(t => t.type === 'HACK').length\n      }\n    },\n    patterns: todos.map(t => `[${t.type}] ${t.text}`)\n  };\n});\n\n// ============================================================================\n// Unified Pipeline Runner\n// ============================================================================\n\nexport async function runUnifiedPipeline(\n  workerContext: WorkerContext,\n  phases: string[],\n  options: Record<string, unknown> = {}\n): Promise<{\n  success: boolean;\n  phases: string[];\n  context: UnifiedPhaseContext;\n  results: Record<string, PhaseResult>;\n  duration: number;\n}> {\n  const startTime = Date.now();\n  const context = createUnifiedContext();\n  const results: Record<string, PhaseResult> = {};\n  const executedPhases: string[] = [];\n\n  for (const phaseName of phases) {\n    const executor = unifiedExecutors.get(phaseName);\n    if (!executor) {\n      console.warn(`Unknown phase: ${phaseName}`);\n      continue;\n    }\n\n    try {\n      const result = await executor(workerContext, context, options);\n      results[phaseName] = result;\n      executedPhases.push(phaseName);\n\n      if (!result.success) {\n        console.warn(`Phase ${phaseName} failed:`, result.error);\n      }\n    } catch (error) {\n      results[phaseName] = {\n        success: false,\n        data: {},\n        error: error instanceof Error ? error.message : String(error)\n      };\n    }\n  }\n\n  return {\n    success: Object.values(results).every(r => r.success),\n    phases: executedPhases,\n    context,\n    results,\n    duration: Date.now() - startTime\n  };\n}\n"]}