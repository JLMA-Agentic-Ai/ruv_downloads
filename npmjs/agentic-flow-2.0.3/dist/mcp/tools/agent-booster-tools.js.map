{"version":3,"file":"agent-booster-tools.js","sourceRoot":"","sources":["../../../src/mcp/tools/agent-booster-tools.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Agent Booster MCP Tools\n *\n * Ultra-fast code editing (352x faster than cloud APIs, $0 cost)\n * Uses Agent Booster's local WASM engine for sub-millisecond transformations\n */\n\nimport { AgentBooster } from 'agent-booster';\nimport type { MCPTool } from './sona-tools.js';\nimport type { MorphApplyRequest, MorphApplyResponse } from 'agent-booster';\n\n// Initialize Agent Booster instance\nconst booster = new AgentBooster({\n  confidenceThreshold: 0.5,\n  maxChunks: 100\n});\n\n/**\n * Agent Booster MCP Tools\n */\nexport const agentBoosterMCPTools: MCPTool[] = [\n  {\n    name: 'agent_booster_edit_file',\n    description: 'Ultra-fast code editing (352x faster than cloud APIs, $0 cost). Apply precise code edits using Agent Booster\\'s local WASM engine. Use \"// ... existing code ...\" markers for unchanged sections.',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        target_filepath: {\n          type: 'string',\n          description: 'Path of the file to modify'\n        },\n        instructions: {\n          type: 'string',\n          description: 'First-person instruction (e.g., \"I will add error handling\")'\n        },\n        code_edit: {\n          type: 'string',\n          description: 'Precise code lines to edit, using \"// ... existing code ...\" for unchanged sections'\n        },\n        language: {\n          type: 'string',\n          description: 'Programming language (auto-detected from file extension if not provided)'\n        }\n      },\n      required: ['target_filepath', 'instructions', 'code_edit']\n    }\n  },\n  {\n    name: 'agent_booster_batch_edit',\n    description: 'Apply multiple code edits in a single operation (ultra-fast batch processing). Perfect for multi-file refactoring.',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        edits: {\n          type: 'array',\n          description: 'Array of edit requests',\n          items: {\n            type: 'object',\n            properties: {\n              target_filepath: {\n                type: 'string',\n                description: 'File path'\n              },\n              instructions: {\n                type: 'string',\n                description: 'First-person instruction'\n              },\n              code_edit: {\n                type: 'string',\n                description: 'Code edit with markers'\n              },\n              language: {\n                type: 'string',\n                description: 'Programming language'\n              }\n            },\n            required: ['target_filepath', 'instructions', 'code_edit']\n          }\n        }\n      },\n      required: ['edits']\n    }\n  },\n  {\n    name: 'agent_booster_parse_markdown',\n    description: 'Parse markdown code blocks with filepath= and instruction= metadata, then apply all edits. Compatible with LLM-generated multi-file refactoring outputs.',\n    inputSchema: {\n      type: 'object',\n      properties: {\n        markdown: {\n          type: 'string',\n          description: 'Markdown text containing code blocks with filepath= and instruction= metadata'\n        }\n      },\n      required: ['markdown']\n    }\n  }\n];\n\n/**\n * Agent Booster MCP Tool Handlers\n */\nexport const agentBoosterMCPHandlers = {\n  /**\n   * Edit a single file with Agent Booster\n   */\n  agent_booster_edit_file: async (params: {\n    target_filepath: string;\n    instructions: string;\n    code_edit: string;\n    language?: string;\n  }): Promise<MorphApplyResponse> => {\n    const fs = require('fs/promises');\n    const path = require('path');\n\n    try {\n      // Read current file content\n      const originalCode = await fs.readFile(params.target_filepath, 'utf8');\n\n      // Auto-detect language from file extension if not provided\n      const language = params.language || path.extname(params.target_filepath).slice(1);\n\n      // Apply edit using Agent Booster - use any for flexible signature\n      const result = await booster.apply({\n        code: originalCode,\n        edit: params.code_edit,\n        language,\n        target_filepath: params.target_filepath,\n        instructions: params.code_edit,\n        code_edit: params.code_edit\n      } as any);\n\n      // Write modified code if successful\n      if (result.success) {\n        await fs.writeFile(params.target_filepath, result.output, 'utf8');\n      }\n\n      return {\n        ...result,\n        // Add metadata\n        metadata: {\n          filepath: params.target_filepath,\n          instructions: params.instructions,\n          language,\n          originalSize: originalCode.length,\n          modifiedSize: result.output.length\n        }\n      } as any;\n    } catch (error: any) {\n      return {\n        output: '',\n        success: false,\n        latency: 0,\n        tokens: { input: 0, output: 0 },\n        confidence: 0,\n        strategy: 'failed',\n        error: error.message\n      } as any;\n    }\n  },\n\n  /**\n   * Apply multiple edits in batch\n   */\n  agent_booster_batch_edit: async (params: {\n    edits: Array<{\n      target_filepath: string;\n      instructions: string;\n      code_edit: string;\n      language?: string;\n    }>;\n  }): Promise<{ results: MorphApplyResponse[]; summary: any }> => {\n    const results: MorphApplyResponse[] = [];\n    const fs = require('fs/promises');\n    const path = require('path');\n\n    let totalLatency = 0;\n    let successCount = 0;\n    let totalBytes = 0;\n\n    for (const edit of params.edits) {\n      try {\n        // Read current file content\n        const originalCode = await fs.readFile(edit.target_filepath, 'utf8');\n\n        // Auto-detect language\n        const language = edit.language || path.extname(edit.target_filepath).slice(1);\n\n        // Apply edit using Agent Booster - use any for flexible signature\n        const result = await booster.apply({\n          code: originalCode,\n          edit: edit.code_edit,\n          language,\n          target_filepath: edit.target_filepath,\n          instructions: edit.code_edit,\n          code_edit: edit.code_edit\n        } as any);\n\n        // Write modified code if successful\n        if (result.success) {\n          await fs.writeFile(edit.target_filepath, result.output, 'utf8');\n          successCount++;\n        }\n\n        totalLatency += result.latency;\n        totalBytes += Buffer.byteLength(result.output, 'utf8');\n\n        results.push({\n          ...result,\n          metadata: {\n            filepath: edit.target_filepath,\n            instructions: edit.instructions\n          }\n        } as any);\n      } catch (error: any) {\n        results.push({\n          output: '',\n          success: false,\n          latency: 0,\n          tokens: { input: 0, output: 0 },\n          confidence: 0,\n          strategy: 'failed',\n          error: error.message,\n          metadata: {\n            filepath: edit.target_filepath\n          }\n        } as any);\n      }\n    }\n\n    return {\n      results,\n      summary: {\n        total: params.edits.length,\n        successful: successCount,\n        failed: params.edits.length - successCount,\n        totalLatency,\n        avgLatency: totalLatency / params.edits.length,\n        totalBytes,\n        speedupVsCloud: Math.round(352 / (totalLatency / params.edits.length))\n      }\n    };\n  },\n\n  /**\n   * Parse markdown and apply edits\n   */\n  agent_booster_parse_markdown: async (params: {\n    markdown: string;\n  }): Promise<{ results: MorphApplyResponse[]; summary: any }> => {\n    // Parse markdown code blocks\n    const codeBlockRegex = /```(\\w+)?\\s+filepath=[\"']([^\"']+)[\"']\\s+instruction=[\"']([^\"']+)[\"']\\s*\\n([\\s\\S]*?)```/g;\n    const edits: Array<{\n      target_filepath: string;\n      instructions: string;\n      code_edit: string;\n      language?: string;\n    }> = [];\n\n    let match;\n    while ((match = codeBlockRegex.exec(params.markdown)) !== null) {\n      edits.push({\n        language: match[1],\n        target_filepath: match[2],\n        instructions: match[3],\n        code_edit: match[4].trim()\n      });\n    }\n\n    if (edits.length === 0) {\n      return {\n        results: [],\n        summary: {\n          total: 0,\n          successful: 0,\n          failed: 0,\n          error: 'No code blocks found with required metadata'\n        }\n      };\n    }\n\n    // Apply all edits\n    return agentBoosterMCPHandlers.agent_booster_batch_edit({ edits });\n  }\n};\n\n/**\n * Get Agent Booster statistics\n */\nexport function getAgentBoosterStats() {\n  return {\n    engine: 'Agent Booster WASM',\n    version: '0.2.2',\n    performance: {\n      avgLatency: '1ms',\n      speedup: '352x vs cloud APIs',\n      costSavings: '$240/month'\n    },\n    features: {\n      local: true,\n      offline: true,\n      privacy: 'Complete (no data sent to cloud)',\n      languages: [\n        'javascript', 'typescript', 'python', 'rust', 'go',\n        'java', 'c', 'cpp', 'ruby', 'php', 'swift', 'kotlin'\n      ]\n    }\n  };\n}\n"]}