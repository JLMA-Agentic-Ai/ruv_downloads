{"version":3,"file":"agent-converter.js","sourceRoot":"","sources":["../../src/sdk/agent-converter.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Agent Converter - Converts agentic-flow agent definitions to Claude Agent SDK format\n *\n * Takes agents defined in .claude/agents/ and converts them to SDK's agents option format\n * for native subagent support via the Task tool.\n */\n\nimport { logger } from \"../utils/logger.js\";\nimport { listAgents, getAgent, AgentDefinition } from \"../utils/agentLoader.js\";\n\n/**\n * SDK Agent Definition format (from Claude Agent SDK)\n */\nexport interface SDKAgentDefinition {\n  description: string;\n  prompt: string;\n  tools?: string[];\n  model?: 'sonnet' | 'opus' | 'haiku' | 'inherit';\n}\n\n/**\n * Default tools for different agent types\n */\nconst AGENT_TYPE_TOOLS: Record<string, string[]> = {\n  'researcher': ['Read', 'Glob', 'Grep', 'WebSearch', 'WebFetch'],\n  'coder': ['Read', 'Write', 'Edit', 'Bash', 'Glob', 'Grep'],\n  'analyst': ['Read', 'Glob', 'Grep', 'WebSearch', 'WebFetch'],\n  'reviewer': ['Read', 'Glob', 'Grep'],\n  'tester': ['Read', 'Glob', 'Grep', 'Bash'],\n  'documenter': ['Read', 'Write', 'Edit', 'Glob', 'Grep'],\n  'architect': ['Read', 'Glob', 'Grep', 'WebSearch'],\n  'coordinator': ['Read', 'Glob', 'Grep', 'Task'],  // Can spawn subagents\n  'default': ['Read', 'Glob', 'Grep']\n};\n\n/**\n * Infer agent type from name or description\n */\nfunction inferAgentType(agent: AgentDefinition): string {\n  const name = agent.name.toLowerCase();\n  const desc = agent.description.toLowerCase();\n\n  if (name.includes('research') || desc.includes('research')) return 'researcher';\n  if (name.includes('code') || desc.includes('code') || desc.includes('implement')) return 'coder';\n  if (name.includes('review') || desc.includes('review')) return 'reviewer';\n  if (name.includes('test') || desc.includes('test')) return 'tester';\n  if (name.includes('doc') || desc.includes('document')) return 'documenter';\n  if (name.includes('arch') || desc.includes('architect')) return 'architect';\n  if (name.includes('coord') || desc.includes('orchestrat')) return 'coordinator';\n  if (name.includes('analy') || desc.includes('analy')) return 'analyst';\n\n  return 'default';\n}\n\n/**\n * Infer model for agent based on complexity\n */\nfunction inferAgentModel(agent: AgentDefinition): 'sonnet' | 'opus' | 'haiku' | 'inherit' {\n  const name = agent.name.toLowerCase();\n  const desc = agent.description.toLowerCase();\n\n  // Use opus for complex tasks\n  if (desc.includes('complex') || desc.includes('architect') || desc.includes('security')) {\n    return 'opus';\n  }\n\n  // Use haiku for simple/fast tasks\n  if (name.includes('format') || name.includes('simple') || desc.includes('quick')) {\n    return 'haiku';\n  }\n\n  // Default to inherit (use parent model)\n  return 'inherit';\n}\n\n/**\n * Convert a single agentic-flow agent to SDK format\n */\nexport function convertAgentToSdkFormat(agent: AgentDefinition): SDKAgentDefinition {\n  const agentType = inferAgentType(agent);\n  const tools = AGENT_TYPE_TOOLS[agentType] || AGENT_TYPE_TOOLS.default;\n\n  return {\n    description: agent.description,\n    prompt: agent.systemPrompt,\n    tools,\n    model: inferAgentModel(agent)\n  };\n}\n\n// Cache for converted agents (invalidated on reload)\nlet cachedSdkAgents: Record<string, SDKAgentDefinition> | null = null;\nlet cacheTimestamp = 0;\nconst CACHE_TTL_MS = 60 * 1000; // 1 minute cache\n\n/**\n * Convert all loaded agents to SDK format (with caching)\n */\nexport function convertAllAgentsToSdkFormat(): Record<string, SDKAgentDefinition> {\n  // Return cached if valid\n  if (cachedSdkAgents && Date.now() - cacheTimestamp < CACHE_TTL_MS) {\n    return cachedSdkAgents;\n  }\n\n  const sdkAgents: Record<string, SDKAgentDefinition> = {};\n\n  try {\n    const agents = listAgents();\n\n    for (const agentInfo of agents) {\n      try {\n        const agent = getAgent(agentInfo.name);\n        if (agent) {\n          // Use sanitized name (replace spaces/special chars)\n          const safeName = agentInfo.name.replace(/[^a-zA-Z0-9-_]/g, '-').toLowerCase();\n          sdkAgents[safeName] = convertAgentToSdkFormat(agent);\n        }\n      } catch (error) {\n        logger.warn('Failed to convert agent', { name: agentInfo.name, error: (error as Error).message });\n      }\n    }\n\n    logger.info('Converted agents to SDK format', { count: Object.keys(sdkAgents).length });\n  } catch (error) {\n    logger.warn('Failed to list agents', { error: (error as Error).message });\n  }\n\n  // Update cache\n  cachedSdkAgents = sdkAgents;\n  cacheTimestamp = Date.now();\n\n  return sdkAgents;\n}\n\n/**\n * Invalidate agent cache (call after agent definitions change)\n */\nexport function invalidateAgentCache(): void {\n  cachedSdkAgents = null;\n  cacheTimestamp = 0;\n}\n\n/**\n * Get essential agents for most tasks\n */\nexport function getEssentialAgents(): Record<string, SDKAgentDefinition> {\n  return {\n    'researcher': {\n      description: 'Expert at researching codebases, finding patterns, and gathering context',\n      prompt: 'You are a research specialist. Find relevant code, patterns, and documentation. Provide comprehensive context for the task.',\n      tools: ['Read', 'Glob', 'Grep', 'WebSearch', 'WebFetch'],\n      model: 'sonnet'\n    },\n    'coder': {\n      description: 'Expert at implementing code changes, writing new features, and fixing bugs',\n      prompt: 'You are a coding specialist. Write clean, well-tested code. Follow existing patterns and conventions.',\n      tools: ['Read', 'Write', 'Edit', 'Bash', 'Glob', 'Grep'],\n      model: 'sonnet'\n    },\n    'reviewer': {\n      description: 'Expert at code review, finding issues, and suggesting improvements',\n      prompt: 'You are a code review specialist. Find bugs, security issues, and code quality problems. Suggest specific improvements.',\n      tools: ['Read', 'Glob', 'Grep'],\n      model: 'sonnet'\n    },\n    'tester': {\n      description: 'Expert at writing and running tests, ensuring code quality',\n      prompt: 'You are a testing specialist. Write comprehensive tests. Verify code works correctly.',\n      tools: ['Read', 'Glob', 'Grep', 'Bash'],\n      model: 'sonnet'\n    },\n    'documenter': {\n      description: 'Expert at writing documentation, comments, and explanations',\n      prompt: 'You are a documentation specialist. Write clear, comprehensive documentation. Update READMEs and comments.',\n      tools: ['Read', 'Write', 'Edit', 'Glob', 'Grep'],\n      model: 'haiku'\n    }\n  };\n}\n\n/**\n * Get agents for a specific use case\n */\nexport function getAgentsForUseCase(useCase: 'code' | 'research' | 'review' | 'full'): Record<string, SDKAgentDefinition> {\n  const essential = getEssentialAgents();\n\n  switch (useCase) {\n    case 'code':\n      return { coder: essential.coder, tester: essential.tester };\n    case 'research':\n      return { researcher: essential.researcher };\n    case 'review':\n      return { reviewer: essential.reviewer };\n    case 'full':\n    default:\n      return essential;\n  }\n}\n\n/**\n * Merge custom agents with essential agents\n */\nexport function getMergedAgents(includeCustom: boolean = true): Record<string, SDKAgentDefinition> {\n  const essential = getEssentialAgents();\n\n  if (!includeCustom) {\n    return essential;\n  }\n\n  const custom = convertAllAgentsToSdkFormat();\n\n  // Merge with custom taking precedence\n  return { ...essential, ...custom };\n}\n"]}