{"version":3,"file":"custom-worker-config.js","sourceRoot":"","sources":["../../src/workers/custom-worker-config.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Custom Worker Configuration System\n *\n * Enables creation of custom workers by mixing and matching:\n * - Phases (discovery, analysis, pattern-matching, etc.)\n * - Capabilities (ONNX embeddings, VectorDB, SONA learning, etc.)\n * - Settings (timeouts, concurrency, output formats)\n */\n\nimport { WorkerTrigger, WorkerPriority, WorkerResults, WorkerContext } from './types.js';\n\n// ============================================================================\n// Phase System - Composable analysis phases\n// ============================================================================\n\nexport type PhaseType =\n  // Discovery phases\n  | 'file-discovery'\n  | 'pattern-discovery'\n  | 'dependency-discovery'\n  | 'api-discovery'\n  // Analysis phases\n  | 'static-analysis'\n  | 'complexity-analysis'\n  | 'security-analysis'\n  | 'performance-analysis'\n  | 'import-analysis'\n  | 'type-analysis'\n  // Pattern phases\n  | 'pattern-extraction'\n  | 'todo-extraction'\n  | 'secret-detection'\n  | 'code-smell-detection'\n  // Build phases\n  | 'graph-build'\n  | 'call-graph'\n  | 'dependency-graph'\n  // Learning phases\n  | 'vectorization'\n  | 'embedding-generation'\n  | 'pattern-storage'\n  | 'sona-training'\n  // Output phases\n  | 'summarization'\n  | 'report-generation'\n  | 'indexing'\n  // Custom\n  | 'custom';\n\nexport interface PhaseConfig {\n  /** Phase type */\n  type: PhaseType;\n  /** Phase name (for custom phases) */\n  name?: string;\n  /** Phase description */\n  description?: string;\n  /** Timeout in ms */\n  timeout?: number;\n  /** Options passed to phase executor */\n  options?: Record<string, unknown>;\n  /** Custom executor function (for 'custom' type) */\n  executor?: (context: WorkerContext, options: Record<string, unknown>) => Promise<PhaseResult>;\n}\n\nexport interface PhaseResult {\n  success: boolean;\n  data: Record<string, unknown>;\n  files?: string[];\n  patterns?: string[];\n  bytes?: number;\n  error?: string;\n}\n\n// ============================================================================\n// Capability System - Enable/disable features\n// ============================================================================\n\nexport interface CapabilityConfig {\n  /** Use ONNX WASM for embeddings (faster, SIMD) */\n  onnxEmbeddings?: boolean;\n  /** Use VectorDB for pattern storage */\n  vectorDb?: boolean;\n  /** Use SONA for trajectory learning */\n  sonaLearning?: boolean;\n  /** Use ReasoningBank for memory */\n  reasoningBank?: boolean;\n  /** Use IntelligenceStore for patterns */\n  intelligenceStore?: boolean;\n  /** Enable real-time progress events */\n  progressEvents?: boolean;\n  /** Enable memory deposits */\n  memoryDeposits?: boolean;\n  /** Enable result persistence */\n  persistResults?: boolean;\n}\n\nexport const DEFAULT_CAPABILITIES: CapabilityConfig = {\n  onnxEmbeddings: true,\n  vectorDb: true,\n  sonaLearning: true,\n  reasoningBank: true,\n  intelligenceStore: true,\n  progressEvents: true,\n  memoryDeposits: true,\n  persistResults: true\n};\n\n// ============================================================================\n// File Filter System\n// ============================================================================\n\nexport interface FileFilterConfig {\n  /** Glob patterns to include */\n  include?: string[];\n  /** Glob patterns to exclude */\n  exclude?: string[];\n  /** File extensions to include */\n  extensions?: string[];\n  /** Max file size in bytes */\n  maxFileSize?: number;\n  /** Max files to process */\n  maxFiles?: number;\n  /** Max directory depth */\n  maxDepth?: number;\n}\n\nexport const DEFAULT_FILE_FILTER: FileFilterConfig = {\n  include: ['**/*.{ts,js,tsx,jsx,py,go,rs,java,c,cpp,h}'],\n  exclude: ['node_modules/**', 'dist/**', '.git/**', 'vendor/**', '__pycache__/**'],\n  extensions: ['ts', 'js', 'tsx', 'jsx', 'py', 'go', 'rs', 'java', 'c', 'cpp', 'h'],\n  maxFileSize: 1024 * 1024, // 1MB\n  maxFiles: 500,\n  maxDepth: 10\n};\n\n// ============================================================================\n// Output Configuration\n// ============================================================================\n\nexport interface OutputConfig {\n  /** Output format */\n  format?: 'json' | 'summary' | 'detailed' | 'minimal';\n  /** Include sample patterns in output */\n  includeSamples?: boolean;\n  /** Max samples to include */\n  maxSamples?: number;\n  /** Include file list in output */\n  includeFileList?: boolean;\n  /** Include timing metrics */\n  includeMetrics?: boolean;\n  /** Store output to file */\n  outputPath?: string;\n}\n\nexport const DEFAULT_OUTPUT: OutputConfig = {\n  format: 'summary',\n  includeSamples: true,\n  maxSamples: 10,\n  includeFileList: false,\n  includeMetrics: true\n};\n\n// ============================================================================\n// Custom Worker Definition\n// ============================================================================\n\nexport interface CustomWorkerDefinition {\n  /** Unique worker name (becomes trigger keyword) */\n  name: string;\n  /** Worker description */\n  description: string;\n  /** Trigger keywords (aliases) */\n  triggers?: string[];\n  /** Worker priority */\n  priority?: WorkerPriority;\n  /** Timeout in ms */\n  timeout?: number;\n  /** Cooldown between runs in ms */\n  cooldown?: number;\n  /** Topic extractor regex */\n  topicExtractor?: string;\n  /** Phases to execute in order */\n  phases: PhaseConfig[];\n  /** Capabilities to enable */\n  capabilities?: Partial<CapabilityConfig>;\n  /** File filter configuration */\n  fileFilter?: Partial<FileFilterConfig>;\n  /** Output configuration */\n  output?: Partial<OutputConfig>;\n  /** Custom metadata */\n  metadata?: Record<string, unknown>;\n}\n\n// ============================================================================\n// Worker Template Presets\n// ============================================================================\n\nexport const WORKER_PRESETS: Record<string, Partial<CustomWorkerDefinition>> = {\n  /** Quick file scan - fast discovery only */\n  'quick-scan': {\n    description: 'Quick file discovery and basic stats',\n    priority: 'low',\n    timeout: 30000,\n    phases: [\n      { type: 'file-discovery' },\n      { type: 'summarization' }\n    ],\n    capabilities: {\n      onnxEmbeddings: false,\n      vectorDb: false,\n      sonaLearning: false\n    }\n  },\n\n  /** Deep analysis - comprehensive code analysis */\n  'deep-analysis': {\n    description: 'Comprehensive code analysis with all capabilities',\n    priority: 'medium',\n    timeout: 300000,\n    phases: [\n      { type: 'file-discovery' },\n      { type: 'static-analysis' },\n      { type: 'complexity-analysis' },\n      { type: 'import-analysis' },\n      { type: 'pattern-extraction' },\n      { type: 'graph-build' },\n      { type: 'vectorization' },\n      { type: 'summarization' }\n    ],\n    capabilities: DEFAULT_CAPABILITIES\n  },\n\n  /** Security focused - security analysis only */\n  'security-scan': {\n    description: 'Security-focused analysis',\n    priority: 'high',\n    timeout: 120000,\n    phases: [\n      { type: 'file-discovery' },\n      { type: 'security-analysis' },\n      { type: 'secret-detection' },\n      { type: 'dependency-discovery' },\n      { type: 'report-generation' }\n    ],\n    capabilities: {\n      onnxEmbeddings: false,\n      persistResults: true\n    }\n  },\n\n  /** Learning focused - pattern learning and storage */\n  'learning': {\n    description: 'Pattern learning and memory storage',\n    priority: 'low',\n    timeout: 180000,\n    phases: [\n      { type: 'file-discovery' },\n      { type: 'pattern-extraction' },\n      { type: 'embedding-generation' },\n      { type: 'pattern-storage' },\n      { type: 'sona-training' }\n    ],\n    capabilities: {\n      onnxEmbeddings: true,\n      vectorDb: true,\n      sonaLearning: true,\n      reasoningBank: true\n    }\n  },\n\n  /** API documentation - API discovery and docs */\n  'api-docs': {\n    description: 'API endpoint discovery and documentation',\n    priority: 'medium',\n    timeout: 120000,\n    phases: [\n      { type: 'file-discovery', options: { include: ['**/*.{ts,js}'] } },\n      { type: 'api-discovery' },\n      { type: 'type-analysis' },\n      { type: 'report-generation' }\n    ],\n    fileFilter: {\n      include: ['**/routes/**', '**/api/**', '**/controllers/**', '**/handlers/**']\n    }\n  },\n\n  /** Test coverage - test file analysis */\n  'test-analysis': {\n    description: 'Test file discovery and coverage analysis',\n    priority: 'medium',\n    timeout: 90000,\n    phases: [\n      { type: 'file-discovery', options: { pattern: '**/*.{test,spec}.{ts,js}' } },\n      { type: 'static-analysis' },\n      { type: 'pattern-extraction' },\n      { type: 'summarization' }\n    ],\n    fileFilter: {\n      include: ['**/*.test.ts', '**/*.spec.ts', '**/*.test.js', '**/*.spec.js', '**/test/**', '**/tests/**']\n    }\n  }\n};\n\n// ============================================================================\n// Configuration File Format\n// ============================================================================\n\nexport interface WorkerConfigFile {\n  /** Version of config format */\n  version: '1.0';\n  /** Custom worker definitions */\n  workers: CustomWorkerDefinition[];\n  /** Global settings */\n  settings?: {\n    /** Default capabilities for all workers */\n    defaultCapabilities?: Partial<CapabilityConfig>;\n    /** Default file filter */\n    defaultFileFilter?: Partial<FileFilterConfig>;\n    /** Default output config */\n    defaultOutput?: Partial<OutputConfig>;\n    /** Max concurrent workers */\n    maxConcurrent?: number;\n    /** Enable debug logging */\n    debug?: boolean;\n  };\n}\n\n// ============================================================================\n// Example Configuration\n// ============================================================================\n\nexport const EXAMPLE_CONFIG: WorkerConfigFile = {\n  version: '1.0',\n  workers: [\n    {\n      name: 'auth-scanner',\n      description: 'Scan for authentication patterns and security issues',\n      triggers: ['auth-scan', 'scan-auth'],\n      priority: 'high',\n      timeout: 120000,\n      topicExtractor: 'auth(?:entication)?\\\\s+(.+)',\n      phases: [\n        { type: 'file-discovery', options: { include: ['**/auth/**', '**/login/**', '**/session/**'] } },\n        { type: 'pattern-extraction', options: { patterns: ['jwt', 'oauth', 'session', 'token'] } },\n        { type: 'security-analysis' },\n        { type: 'secret-detection' },\n        { type: 'vectorization' },\n        { type: 'report-generation' }\n      ],\n      capabilities: {\n        onnxEmbeddings: true,\n        vectorDb: true,\n        persistResults: true\n      },\n      output: {\n        format: 'detailed',\n        includeSamples: true\n      }\n    },\n    {\n      name: 'perf-analyzer',\n      description: 'Analyze code for performance bottlenecks',\n      triggers: ['perf-scan', 'analyze-perf'],\n      priority: 'medium',\n      phases: [\n        { type: 'file-discovery' },\n        { type: 'complexity-analysis' },\n        { type: 'performance-analysis' },\n        { type: 'call-graph' },\n        { type: 'summarization' }\n      ]\n    }\n  ],\n  settings: {\n    defaultCapabilities: {\n      onnxEmbeddings: true,\n      progressEvents: true\n    },\n    maxConcurrent: 5,\n    debug: false\n  }\n};\n\n// ============================================================================\n// Validation\n// ============================================================================\n\nexport function validateWorkerDefinition(def: CustomWorkerDefinition): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n\n  if (!def.name || def.name.length < 2) {\n    errors.push('Worker name must be at least 2 characters');\n  }\n\n  if (!/^[a-z][a-z0-9-]*$/.test(def.name)) {\n    errors.push('Worker name must be lowercase alphanumeric with hyphens');\n  }\n\n  if (!def.description) {\n    errors.push('Worker description is required');\n  }\n\n  if (!def.phases || def.phases.length === 0) {\n    errors.push('At least one phase is required');\n  }\n\n  for (const phase of def.phases || []) {\n    if (phase.type === 'custom' && !phase.executor && !phase.name) {\n      errors.push('Custom phases require a name or executor');\n    }\n  }\n\n  return { valid: errors.length === 0, errors };\n}\n"]}