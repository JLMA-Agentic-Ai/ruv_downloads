{"version":3,"file":"custom-worker-factory.js","sourceRoot":"","sources":["../../src/workers/custom-worker-factory.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Custom Worker Factory\n *\n * Creates worker implementations from CustomWorkerDefinition configs.\n * Handles loading config files, validating definitions, and registering\n * custom workers with the dispatch service.\n */\n\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport { parse as parseYaml, stringify as stringifyYaml } from 'yaml';\nimport {\n  CustomWorkerDefinition,\n  WorkerConfigFile,\n  validateWorkerDefinition,\n  WORKER_PRESETS,\n  DEFAULT_CAPABILITIES,\n  DEFAULT_FILE_FILTER,\n  DEFAULT_OUTPUT,\n  CapabilityConfig,\n  FileFilterConfig,\n  OutputConfig\n} from './custom-worker-config.js';\nimport { WorkerContext, WorkerResults } from './types.js';\nimport { executePhasePipeline, PhaseContext } from './phase-executors.js';\n\n// ============================================================================\n// Custom Worker Instance\n// ============================================================================\n\nexport interface CustomWorkerInstance {\n  /** Worker definition */\n  definition: CustomWorkerDefinition;\n  /** Merged capabilities */\n  capabilities: CapabilityConfig;\n  /** Merged file filter */\n  fileFilter: FileFilterConfig;\n  /** Merged output config */\n  output: OutputConfig;\n  /** Execute the worker */\n  execute: (context: WorkerContext) => Promise<WorkerResults>;\n}\n\n// ============================================================================\n// Factory Functions\n// ============================================================================\n\n/**\n * Create a worker instance from a definition\n */\nexport function createCustomWorker(\n  definition: CustomWorkerDefinition,\n  globalSettings?: {\n    defaultCapabilities?: Partial<CapabilityConfig>;\n    defaultFileFilter?: Partial<FileFilterConfig>;\n    defaultOutput?: Partial<OutputConfig>;\n  }\n): CustomWorkerInstance {\n  // Validate definition\n  const validation = validateWorkerDefinition(definition);\n  if (!validation.valid) {\n    throw new Error(`Invalid worker definition: ${validation.errors.join(', ')}`);\n  }\n\n  // Merge capabilities\n  const capabilities: CapabilityConfig = {\n    ...DEFAULT_CAPABILITIES,\n    ...globalSettings?.defaultCapabilities,\n    ...definition.capabilities\n  };\n\n  // Merge file filter\n  const fileFilter: FileFilterConfig = {\n    ...DEFAULT_FILE_FILTER,\n    ...globalSettings?.defaultFileFilter,\n    ...definition.fileFilter\n  };\n\n  // Merge output config\n  const output: OutputConfig = {\n    ...DEFAULT_OUTPUT,\n    ...globalSettings?.defaultOutput,\n    ...definition.output\n  };\n\n  // Create executor\n  const execute = async (context: WorkerContext): Promise<WorkerResults> => {\n    const startTime = Date.now();\n\n    try {\n      // Execute phase pipeline\n      const result = await executePhasePipeline(\n        context,\n        definition.phases,\n        (phase, progress) => {\n          // Progress callback for real-time updates\n          if (capabilities.progressEvents) {\n            console.log(`[${definition.name}] Phase: ${phase} (${progress}%)`);\n          }\n        }\n      );\n\n      // Build results\n      const completedCount = Array.from(result.results.values()).filter(r => r?.success).length;\n      const results: WorkerResults = {\n        status: result.success ? 'complete' : 'failed',\n        success: result.success,\n        completedPhases: completedCount,\n        totalPhases: definition.phases.length,\n        memoryKeys: [],\n        duration: Date.now() - startTime,\n        data: buildResultsData(result.phaseContext, result.results, output)\n      };\n\n      // Handle learning capabilities\n      if (capabilities.sonaLearning && result.phaseContext.patterns.length > 0) {\n        results.data.sonaTrainingTriggered = true;\n      }\n\n      if (capabilities.vectorDb && result.phaseContext.patterns.length > 0) {\n        results.data.vectorDbUpdated = true;\n      }\n\n      // Add timing\n      results.data.executionTimeMs = Date.now() - startTime;\n      results.data.phasesExecuted = definition.phases.length;\n\n      // Add errors if any\n      if (result.errors.length > 0) {\n        results.data.errors = result.errors;\n      }\n\n      return results;\n    } catch (error) {\n      return {\n        status: 'failed' as const,\n        success: false,\n        completedPhases: 0,\n        totalPhases: definition.phases.length,\n        memoryKeys: [],\n        duration: Date.now() - startTime,\n        error: error instanceof Error ? error.message : 'Worker execution failed',\n        data: {\n          error: error instanceof Error ? error.message : 'Worker execution failed',\n          executionTimeMs: Date.now() - startTime\n        }\n      };\n    }\n  };\n\n  return {\n    definition,\n    capabilities,\n    fileFilter,\n    output,\n    execute\n  };\n}\n\n/**\n * Build results data from phase context\n */\nfunction buildResultsData(\n  phaseContext: PhaseContext,\n  phaseResults: Map<string, any>,\n  outputConfig: OutputConfig\n): Record<string, unknown> {\n  const data: Record<string, unknown> = {\n    files_analyzed: phaseContext.files.length,\n    patterns_found: phaseContext.patterns.length,\n    bytes_processed: phaseContext.bytes\n  };\n\n  // Add samples if configured\n  if (outputConfig.includeSamples) {\n    const maxSamples = outputConfig.maxSamples || 10;\n    data.sample_patterns = phaseContext.patterns.slice(0, maxSamples);\n  }\n\n  // Add file list if configured\n  if (outputConfig.includeFileList) {\n    data.files = phaseContext.files;\n  }\n\n  // Add metrics if configured\n  if (outputConfig.includeMetrics) {\n    data.metrics = phaseContext.metrics;\n  }\n\n  // Add phase-specific data\n  const phaseData: Record<string, unknown> = {};\n  for (const [phase, result] of phaseResults) {\n    if (result?.data) {\n      phaseData[phase] = result.data;\n    }\n  }\n  data.phaseResults = phaseData;\n\n  return data;\n}\n\n// ============================================================================\n// Create from Preset\n// ============================================================================\n\n/**\n * Create a worker from a preset\n */\nexport function createFromPreset(\n  presetName: string,\n  overrides?: Partial<CustomWorkerDefinition>\n): CustomWorkerInstance {\n  const preset = WORKER_PRESETS[presetName];\n  if (!preset) {\n    throw new Error(`Unknown preset: ${presetName}. Available: ${Object.keys(WORKER_PRESETS).join(', ')}`);\n  }\n\n  const definition: CustomWorkerDefinition = {\n    name: overrides?.name || presetName,\n    description: preset.description || `Worker from ${presetName} preset`,\n    triggers: overrides?.triggers || [presetName],\n    priority: preset.priority || 'medium',\n    timeout: preset.timeout || 120000,\n    phases: overrides?.phases || preset.phases || [],\n    capabilities: { ...preset.capabilities, ...overrides?.capabilities },\n    fileFilter: { ...preset.fileFilter, ...overrides?.fileFilter },\n    output: { ...preset.output, ...overrides?.output },\n    ...overrides\n  };\n\n  return createCustomWorker(definition);\n}\n\n// ============================================================================\n// Config File Loading\n// ============================================================================\n\nconst CONFIG_FILENAMES = [\n  'workers.yaml',\n  'workers.yml',\n  'workers.json',\n  '.agentic-flow/workers.yaml',\n  '.agentic-flow/workers.yml',\n  '.agentic-flow/workers.json'\n];\n\n/**\n * Load workers from a config file\n */\nexport async function loadWorkersFromConfig(\n  configPath?: string\n): Promise<CustomWorkerInstance[]> {\n  let content: string;\n  let actualPath: string;\n\n  if (configPath) {\n    actualPath = path.isAbsolute(configPath) ? configPath : path.join(process.cwd(), configPath);\n    try {\n      content = await fs.readFile(actualPath, 'utf-8');\n    } catch (error) {\n      throw new Error(`Failed to read config file: ${actualPath}`);\n    }\n  } else {\n    // Search for config file\n    for (const filename of CONFIG_FILENAMES) {\n      const tryPath = path.join(process.cwd(), filename);\n      try {\n        content = await fs.readFile(tryPath, 'utf-8');\n        actualPath = tryPath;\n        break;\n      } catch {\n        continue;\n      }\n    }\n    if (!content!) {\n      return [];\n    }\n  }\n\n  // Parse config\n  let config: WorkerConfigFile;\n  if (actualPath!.endsWith('.json')) {\n    config = JSON.parse(content);\n  } else {\n    config = parseYaml(content) as WorkerConfigFile;\n  }\n\n  // Validate version\n  if (config.version !== '1.0') {\n    console.warn(`Unknown config version: ${config.version}. Expected 1.0`);\n  }\n\n  // Create workers\n  const workers: CustomWorkerInstance[] = [];\n  for (const def of config.workers) {\n    try {\n      const worker = createCustomWorker(def, config.settings);\n      workers.push(worker);\n    } catch (error) {\n      console.error(`Failed to create worker \"${def.name}\": ${error}`);\n    }\n  }\n\n  return workers;\n}\n\n// ============================================================================\n// Worker Registry Integration\n// ============================================================================\n\nexport class CustomWorkerManager {\n  private workers = new Map<string, CustomWorkerInstance>();\n  private triggerMap = new Map<string, string>(); // trigger -> worker name\n\n  /**\n   * Register a custom worker\n   */\n  register(worker: CustomWorkerInstance): void {\n    const name = worker.definition.name;\n    this.workers.set(name, worker);\n\n    // Register triggers\n    this.triggerMap.set(name, name);\n    for (const trigger of worker.definition.triggers || []) {\n      this.triggerMap.set(trigger.toLowerCase(), name);\n    }\n  }\n\n  /**\n   * Create and register from preset\n   */\n  registerPreset(presetName: string, overrides?: Partial<CustomWorkerDefinition>): CustomWorkerInstance {\n    const worker = createFromPreset(presetName, overrides);\n    this.register(worker);\n    return worker;\n  }\n\n  /**\n   * Create and register from definition\n   */\n  registerDefinition(definition: CustomWorkerDefinition): CustomWorkerInstance {\n    const worker = createCustomWorker(definition);\n    this.register(worker);\n    return worker;\n  }\n\n  /**\n   * Load and register from config file\n   */\n  async loadFromConfig(configPath?: string): Promise<number> {\n    const workers = await loadWorkersFromConfig(configPath);\n    workers.forEach(w => this.register(w));\n    return workers.length;\n  }\n\n  /**\n   * Get worker by name or trigger\n   */\n  get(nameOrTrigger: string): CustomWorkerInstance | undefined {\n    const key = nameOrTrigger.toLowerCase();\n    const name = this.triggerMap.get(key);\n    return name ? this.workers.get(name) : undefined;\n  }\n\n  /**\n   * Check if a trigger matches a custom worker\n   */\n  matchesTrigger(input: string): string | undefined {\n    const lower = input.toLowerCase();\n    for (const [trigger, name] of this.triggerMap) {\n      if (lower.includes(trigger)) {\n        return name;\n      }\n    }\n    return undefined;\n  }\n\n  /**\n   * List all registered workers\n   */\n  list(): CustomWorkerInstance[] {\n    return Array.from(this.workers.values());\n  }\n\n  /**\n   * List available presets\n   */\n  listPresets(): string[] {\n    return Object.keys(WORKER_PRESETS);\n  }\n\n  /**\n   * Get preset definition\n   */\n  getPreset(name: string): Partial<CustomWorkerDefinition> | undefined {\n    return WORKER_PRESETS[name];\n  }\n\n  /**\n   * Execute a custom worker\n   */\n  async execute(nameOrTrigger: string, context: WorkerContext): Promise<WorkerResults> {\n    const worker = this.get(nameOrTrigger);\n    if (!worker) {\n      return {\n        status: 'failed' as const,\n        success: false,\n        completedPhases: 0,\n        totalPhases: 0,\n        memoryKeys: [],\n        duration: 0,\n        error: `Custom worker not found: ${nameOrTrigger}`,\n        data: { error: `Custom worker not found: ${nameOrTrigger}` }\n      };\n    }\n\n    return worker.execute(context);\n  }\n\n  /**\n   * Generate example config file\n   */\n  generateExampleConfig(): string {\n    const example: WorkerConfigFile = {\n      version: '1.0',\n      workers: [\n        {\n          name: 'my-scanner',\n          description: 'Custom code scanner',\n          triggers: ['scan-my'],\n          priority: 'medium',\n          timeout: 120000,\n          phases: [\n            { type: 'file-discovery' },\n            { type: 'pattern-extraction' },\n            { type: 'security-analysis' },\n            { type: 'summarization' }\n          ],\n          capabilities: {\n            onnxEmbeddings: true,\n            vectorDb: true\n          },\n          output: {\n            format: 'detailed',\n            includeSamples: true\n          }\n        }\n      ],\n      settings: {\n        defaultCapabilities: {\n          progressEvents: true\n        },\n        maxConcurrent: 3,\n        debug: false\n      }\n    };\n\n    return `# Custom Workers Configuration\n# Save as workers.yaml or .agentic-flow/workers.yaml\n\n${stringifyYaml(example)}`;\n  }\n}\n\n// Singleton instance\nexport const customWorkerManager = new CustomWorkerManager();\n\n// ============================================================================\n// CLI Helper Functions\n// ============================================================================\n\nexport function formatWorkerInfo(worker: CustomWorkerInstance): string {\n  const def = worker.definition;\n  const lines = [\n    `Name: ${def.name}`,\n    `Description: ${def.description}`,\n    `Triggers: ${[def.name, ...(def.triggers || [])].join(', ')}`,\n    `Priority: ${def.priority || 'medium'}`,\n    `Timeout: ${(def.timeout || 120000) / 1000}s`,\n    `Phases: ${def.phases.map(p => p.type).join(' → ')}`,\n    '',\n    'Capabilities:',\n    ...Object.entries(worker.capabilities)\n      .filter(([_, v]) => v)\n      .map(([k]) => `  ✓ ${k}`)\n  ];\n\n  return lines.join('\\n');\n}\n\nexport function formatPresetList(): string {\n  const lines = ['Available Presets:', ''];\n\n  for (const [name, preset] of Object.entries(WORKER_PRESETS)) {\n    lines.push(`  ${name}`);\n    lines.push(`    ${preset.description}`);\n    lines.push(`    Phases: ${preset.phases?.map(p => p.type).join(' → ') || 'none'}`);\n    lines.push('');\n  }\n\n  return lines.join('\\n');\n}\n"]}