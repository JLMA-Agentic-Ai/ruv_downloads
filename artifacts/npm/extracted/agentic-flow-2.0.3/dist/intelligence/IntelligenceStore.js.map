{"version":3,"file":"IntelligenceStore.js","sourceRoot":"","sources":["../../src/intelligence/IntelligenceStore.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * IntelligenceStore - SQLite persistence for RuVector intelligence layer\n *\n * Uses sql.js (pure JS SQLite) as primary backend for cross-platform compatibility\n * Falls back to better-sqlite3 only if sql.js fails\n */\n\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'fs';\nimport { dirname, join } from 'path';\nimport { homedir } from 'os';\n\nexport interface StoredTrajectory {\n  id: number;\n  taskDescription: string;\n  agent: string;\n  steps: number;\n  outcome: 'success' | 'failure' | 'partial';\n  startTime: number;\n  endTime: number;\n  metadata?: string; // JSON\n}\n\nexport interface StoredPattern {\n  id: number;\n  taskType: string;\n  approach: string;\n  embedding: Buffer; // Float32Array as Buffer\n  similarity: number;\n  usageCount: number;\n  successRate: number;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport interface StoredRouting {\n  id: number;\n  task: string;\n  recommendedAgent: string;\n  confidence: number;\n  latencyMs: number;\n  wasSuccessful: boolean;\n  timestamp: number;\n}\n\nexport interface LearningStats {\n  totalTrajectories: number;\n  successfulTrajectories: number;\n  totalRoutings: number;\n  successfulRoutings: number;\n  totalPatterns: number;\n  sonaAdaptations: number;\n  hnswQueries: number;\n  lastUpdated: number;\n}\n\n// Unified database interface\ninterface DbInterface {\n  run(sql: string, params?: any[]): { lastInsertRowid: number; changes: number };\n  get<T>(sql: string, params?: any[]): T | undefined;\n  all<T>(sql: string, params?: any[]): T[];\n  exec(sql: string): void;\n  close(): void;\n}\n\n// sql.js wrapper\nclass SqlJsWrapper implements DbInterface {\n  private db: any;\n  private dbPath: string;\n  private saveTimeout: NodeJS.Timeout | null = null;\n\n  constructor(db: any, dbPath: string) {\n    this.db = db;\n    this.dbPath = dbPath;\n  }\n\n  private scheduleSave(): void {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n    this.saveTimeout = setTimeout(() => {\n      this.saveNow();\n    }, 100); // Debounce saves\n  }\n\n  private saveNow(): void {\n    try {\n      const data = this.db.export();\n      const buffer = Buffer.from(data);\n      writeFileSync(this.dbPath, buffer);\n    } catch {\n      // Ignore save errors\n    }\n  }\n\n  run(sql: string, params?: any[]): { lastInsertRowid: number; changes: number } {\n    this.db.run(sql, params || []);\n    const lastId = this.db.exec('SELECT last_insert_rowid() as id')[0]?.values[0]?.[0] || 0;\n    const changes = this.db.getRowsModified();\n    this.scheduleSave();\n    return { lastInsertRowid: lastId as number, changes };\n  }\n\n  get<T>(sql: string, params?: any[]): T | undefined {\n    const stmt = this.db.prepare(sql);\n    if (params) stmt.bind(params);\n    if (stmt.step()) {\n      const columns = stmt.getColumnNames();\n      const values = stmt.get();\n      stmt.free();\n      const result: any = {};\n      columns.forEach((col: string, i: number) => {\n        result[col] = values[i];\n      });\n      return result;\n    }\n    stmt.free();\n    return undefined;\n  }\n\n  all<T>(sql: string, params?: any[]): T[] {\n    const results: T[] = [];\n    const stmt = this.db.prepare(sql);\n    if (params) stmt.bind(params);\n    while (stmt.step()) {\n      const columns = stmt.getColumnNames();\n      const values = stmt.get();\n      const row: any = {};\n      columns.forEach((col: string, i: number) => {\n        row[col] = values[i];\n      });\n      results.push(row);\n    }\n    stmt.free();\n    return results;\n  }\n\n  exec(sql: string): void {\n    this.db.exec(sql);\n    this.scheduleSave();\n  }\n\n  close(): void {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n    this.saveNow();\n    this.db.close();\n  }\n}\n\n// better-sqlite3 wrapper\nclass BetterSqliteWrapper implements DbInterface {\n  private db: any;\n\n  constructor(db: any) {\n    this.db = db;\n  }\n\n  run(sql: string, params?: any[]): { lastInsertRowid: number; changes: number } {\n    const stmt = this.db.prepare(sql);\n    const result = params ? stmt.run(...params) : stmt.run();\n    return { lastInsertRowid: result.lastInsertRowid as number, changes: result.changes };\n  }\n\n  get<T>(sql: string, params?: any[]): T | undefined {\n    const stmt = this.db.prepare(sql);\n    return params ? stmt.get(...params) : stmt.get();\n  }\n\n  all<T>(sql: string, params?: any[]): T[] {\n    const stmt = this.db.prepare(sql);\n    return params ? stmt.all(...params) : stmt.all();\n  }\n\n  exec(sql: string): void {\n    this.db.exec(sql);\n  }\n\n  close(): void {\n    this.db.close();\n  }\n}\n\nexport class IntelligenceStore {\n  private db: DbInterface | null = null;\n  private dbPath: string;\n  private initialized: boolean = false;\n  private initPromise: Promise<void> | null = null;\n  private static instance: IntelligenceStore | null = null;\n\n  private constructor(dbPath: string) {\n    this.dbPath = dbPath;\n  }\n\n  /**\n   * Initialize the database (async to support sql.js)\n   */\n  private async initialize(): Promise<void> {\n    if (this.initialized) return;\n    if (this.initPromise) return this.initPromise;\n\n    this.initPromise = this.doInitialize();\n    await this.initPromise;\n  }\n\n  private async doInitialize(): Promise<void> {\n    // Ensure directory exists\n    const dir = dirname(this.dbPath);\n    if (!existsSync(dir)) {\n      mkdirSync(dir, { recursive: true });\n    }\n\n    // Try sql.js first (pure JS, no native modules)\n    try {\n      const initSqlJs = (await import('sql.js')).default;\n      const SQL = await initSqlJs();\n\n      let db;\n      if (existsSync(this.dbPath)) {\n        const fileBuffer = readFileSync(this.dbPath);\n        db = new SQL.Database(fileBuffer);\n      } else {\n        db = new SQL.Database();\n      }\n\n      this.db = new SqlJsWrapper(db, this.dbPath);\n      this.initialized = true;\n      this.initSchema();\n      return;\n    } catch (e) {\n      // sql.js failed, try better-sqlite3\n    }\n\n    // Try better-sqlite3 as fallback\n    try {\n      const Database = (await import('better-sqlite3')).default;\n      const db = new Database(this.dbPath);\n      db.pragma('journal_mode = WAL');\n      db.pragma('synchronous = NORMAL');\n      this.db = new BetterSqliteWrapper(db);\n      this.initialized = true;\n      this.initSchema();\n      return;\n    } catch (e) {\n      // Both failed, use in-memory fallback\n    }\n\n    // Last resort: in-memory sql.js (won't persist but won't crash)\n    try {\n      const initSqlJs = (await import('sql.js')).default;\n      const SQL = await initSqlJs();\n      const db = new SQL.Database();\n      this.db = new SqlJsWrapper(db, this.dbPath);\n      this.initialized = true;\n      this.initSchema();\n      console.error('[IntelligenceStore] Warning: Using in-memory database (persistence disabled)');\n    } catch {\n      // Complete failure - create a no-op stub\n      this.db = {\n        run: () => ({ lastInsertRowid: 0, changes: 0 }),\n        get: () => undefined,\n        all: () => [],\n        exec: () => {},\n        close: () => {},\n      };\n      this.initialized = true;\n      console.error('[IntelligenceStore] Warning: Database unavailable, intelligence features disabled');\n    }\n  }\n\n  /**\n   * Ensure database is initialized before operations\n   */\n  private async ensureInitialized(): Promise<void> {\n    if (!this.initialized) {\n      await this.initialize();\n    }\n  }\n\n  /**\n   * Get singleton instance\n   */\n  static getInstance(dbPath?: string): IntelligenceStore {\n    if (!IntelligenceStore.instance) {\n      const path = dbPath || IntelligenceStore.getDefaultPath();\n      IntelligenceStore.instance = new IntelligenceStore(path);\n    }\n    return IntelligenceStore.instance;\n  }\n\n  /**\n   * Get default database path (cross-platform)\n   */\n  static getDefaultPath(): string {\n    // Check for project-local .agentic-flow directory first\n    const localPath = join(process.cwd(), '.agentic-flow', 'intelligence.db');\n    const localDir = dirname(localPath);\n\n    if (existsSync(localDir)) {\n      return localPath;\n    }\n\n    // Fall back to home directory\n    const homeDir = homedir();\n    return join(homeDir, '.agentic-flow', 'intelligence.db');\n  }\n\n  /**\n   * Initialize database schema\n   */\n  private initSchema(): void {\n    if (!this.db) return;\n\n    this.db.exec(`\n      -- Trajectories table\n      CREATE TABLE IF NOT EXISTS trajectories (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        task_description TEXT NOT NULL,\n        agent TEXT NOT NULL,\n        steps INTEGER DEFAULT 0,\n        outcome TEXT DEFAULT 'partial',\n        start_time INTEGER NOT NULL,\n        end_time INTEGER,\n        metadata TEXT,\n        created_at INTEGER DEFAULT (strftime('%s', 'now'))\n      );\n\n      -- Patterns table (for ReasoningBank)\n      CREATE TABLE IF NOT EXISTS patterns (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        task_type TEXT NOT NULL,\n        approach TEXT NOT NULL,\n        embedding BLOB,\n        similarity REAL DEFAULT 0,\n        usage_count INTEGER DEFAULT 0,\n        success_rate REAL DEFAULT 0,\n        created_at INTEGER DEFAULT (strftime('%s', 'now')),\n        updated_at INTEGER DEFAULT (strftime('%s', 'now'))\n      );\n\n      -- Routings table\n      CREATE TABLE IF NOT EXISTS routings (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        task TEXT NOT NULL,\n        recommended_agent TEXT NOT NULL,\n        confidence REAL NOT NULL,\n        latency_ms INTEGER NOT NULL,\n        was_successful INTEGER DEFAULT 0,\n        timestamp INTEGER DEFAULT (strftime('%s', 'now'))\n      );\n\n      -- Stats table (single row)\n      CREATE TABLE IF NOT EXISTS stats (\n        id INTEGER PRIMARY KEY CHECK (id = 1),\n        total_trajectories INTEGER DEFAULT 0,\n        successful_trajectories INTEGER DEFAULT 0,\n        total_routings INTEGER DEFAULT 0,\n        successful_routings INTEGER DEFAULT 0,\n        total_patterns INTEGER DEFAULT 0,\n        sona_adaptations INTEGER DEFAULT 0,\n        hnsw_queries INTEGER DEFAULT 0,\n        last_updated INTEGER DEFAULT (strftime('%s', 'now'))\n      );\n\n      -- Initialize stats row if not exists\n      INSERT OR IGNORE INTO stats (id) VALUES (1);\n    `);\n\n    // Create indexes separately (sql.js doesn't support CREATE INDEX IF NOT EXISTS in exec)\n    try {\n      this.db.exec(`CREATE INDEX IF NOT EXISTS idx_trajectories_agent ON trajectories(agent);`);\n      this.db.exec(`CREATE INDEX IF NOT EXISTS idx_trajectories_outcome ON trajectories(outcome);`);\n      this.db.exec(`CREATE INDEX IF NOT EXISTS idx_patterns_task_type ON patterns(task_type);`);\n      this.db.exec(`CREATE INDEX IF NOT EXISTS idx_routings_agent ON routings(recommended_agent);`);\n      this.db.exec(`CREATE INDEX IF NOT EXISTS idx_routings_timestamp ON routings(timestamp);`);\n    } catch {\n      // Indexes may already exist\n    }\n  }\n\n  // ============ Trajectory Methods ============\n\n  /**\n   * Start a new trajectory\n   */\n  async startTrajectory(taskDescription: string, agent: string): Promise<number> {\n    await this.ensureInitialized();\n    if (!this.db) return 0;\n\n    const result = this.db.run(\n      `INSERT INTO trajectories (task_description, agent, start_time) VALUES (?, ?, ?)`,\n      [taskDescription, agent, Date.now()]\n    );\n\n    await this.incrementStat('total_trajectories');\n    return result.lastInsertRowid;\n  }\n\n  /**\n   * Add step to trajectory\n   */\n  async addTrajectoryStep(trajectoryId: number): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.run(`UPDATE trajectories SET steps = steps + 1 WHERE id = ?`, [trajectoryId]);\n  }\n\n  /**\n   * End trajectory with outcome\n   */\n  async endTrajectory(trajectoryId: number, outcome: 'success' | 'failure' | 'partial', metadata?: Record<string, any>): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.run(\n      `UPDATE trajectories SET outcome = ?, end_time = ?, metadata = ? WHERE id = ?`,\n      [outcome, Date.now(), metadata ? JSON.stringify(metadata) : null, trajectoryId]\n    );\n\n    if (outcome === 'success') {\n      await this.incrementStat('successful_trajectories');\n    }\n  }\n\n  /**\n   * Get active trajectories (no end_time)\n   */\n  async getActiveTrajectories(): Promise<StoredTrajectory[]> {\n    await this.ensureInitialized();\n    if (!this.db) return [];\n\n    return this.db.all<StoredTrajectory>(`SELECT * FROM trajectories WHERE end_time IS NULL`);\n  }\n\n  /**\n   * Get recent trajectories\n   */\n  async getRecentTrajectories(limit: number = 10): Promise<StoredTrajectory[]> {\n    await this.ensureInitialized();\n    if (!this.db) return [];\n\n    return this.db.all<StoredTrajectory>(\n      `SELECT * FROM trajectories ORDER BY start_time DESC LIMIT ?`,\n      [limit]\n    );\n  }\n\n  // ============ Pattern Methods ============\n\n  /**\n   * Store a pattern\n   */\n  async storePattern(taskType: string, approach: string, embedding?: Float32Array): Promise<number> {\n    await this.ensureInitialized();\n    if (!this.db) return 0;\n\n    const embeddingBuffer = embedding ? Buffer.from(embedding.buffer) : null;\n    const result = this.db.run(\n      `INSERT INTO patterns (task_type, approach, embedding) VALUES (?, ?, ?)`,\n      [taskType, approach, embeddingBuffer]\n    );\n\n    await this.incrementStat('total_patterns');\n    return result.lastInsertRowid;\n  }\n\n  /**\n   * Update pattern usage\n   */\n  async updatePatternUsage(patternId: number, wasSuccessful: boolean): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.run(\n      `UPDATE patterns SET usage_count = usage_count + 1, success_rate = (success_rate * usage_count + ?) / (usage_count + 1), updated_at = strftime('%s', 'now') WHERE id = ?`,\n      [wasSuccessful ? 1 : 0, patternId]\n    );\n  }\n\n  /**\n   * Find patterns by task type\n   */\n  async findPatterns(taskType: string, limit: number = 5): Promise<StoredPattern[]> {\n    await this.ensureInitialized();\n    if (!this.db) return [];\n\n    return this.db.all<StoredPattern>(\n      `SELECT * FROM patterns WHERE task_type LIKE ? ORDER BY success_rate DESC, usage_count DESC LIMIT ?`,\n      [`%${taskType}%`, limit]\n    );\n  }\n\n  // ============ Routing Methods ============\n\n  /**\n   * Record a routing decision\n   */\n  async recordRouting(task: string, recommendedAgent: string, confidence: number, latencyMs: number): Promise<number> {\n    await this.ensureInitialized();\n    if (!this.db) return 0;\n\n    const result = this.db.run(\n      `INSERT INTO routings (task, recommended_agent, confidence, latency_ms) VALUES (?, ?, ?, ?)`,\n      [task, recommendedAgent, confidence, latencyMs]\n    );\n\n    await this.incrementStat('total_routings');\n    return result.lastInsertRowid;\n  }\n\n  /**\n   * Update routing outcome\n   */\n  async updateRoutingOutcome(routingId: number, wasSuccessful: boolean): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.run(`UPDATE routings SET was_successful = ? WHERE id = ?`, [wasSuccessful ? 1 : 0, routingId]);\n\n    if (wasSuccessful) {\n      await this.incrementStat('successful_routings');\n    }\n  }\n\n  /**\n   * Get routing accuracy for an agent\n   */\n  async getAgentAccuracy(agent: string): Promise<{ total: number; successful: number; accuracy: number }> {\n    await this.ensureInitialized();\n    if (!this.db) return { total: 0, successful: 0, accuracy: 0 };\n\n    const result = this.db.get<{ total: number; successful: number }>(\n      `SELECT COUNT(*) as total, SUM(was_successful) as successful FROM routings WHERE recommended_agent = ?`,\n      [agent]\n    );\n\n    return {\n      total: result?.total || 0,\n      successful: result?.successful || 0,\n      accuracy: result?.total ? (result.successful || 0) / result.total : 0,\n    };\n  }\n\n  // ============ Stats Methods ============\n\n  /**\n   * Get all stats\n   */\n  async getStats(): Promise<LearningStats> {\n    await this.ensureInitialized();\n    if (!this.db) {\n      return {\n        totalTrajectories: 0,\n        successfulTrajectories: 0,\n        totalRoutings: 0,\n        successfulRoutings: 0,\n        totalPatterns: 0,\n        sonaAdaptations: 0,\n        hnswQueries: 0,\n        lastUpdated: Date.now(),\n      };\n    }\n\n    const row = this.db.get<any>(`SELECT * FROM stats WHERE id = 1`);\n\n    return {\n      totalTrajectories: row?.total_trajectories || 0,\n      successfulTrajectories: row?.successful_trajectories || 0,\n      totalRoutings: row?.total_routings || 0,\n      successfulRoutings: row?.successful_routings || 0,\n      totalPatterns: row?.total_patterns || 0,\n      sonaAdaptations: row?.sona_adaptations || 0,\n      hnswQueries: row?.hnsw_queries || 0,\n      lastUpdated: row?.last_updated || Date.now(),\n    };\n  }\n\n  /**\n   * Increment a stat counter\n   */\n  async incrementStat(statName: string, amount: number = 1): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.run(\n      `UPDATE stats SET ${statName} = ${statName} + ?, last_updated = strftime('%s', 'now') WHERE id = 1`,\n      [amount]\n    );\n  }\n\n  /**\n   * Record SONA adaptation\n   */\n  async recordSonaAdaptation(): Promise<void> {\n    await this.incrementStat('sona_adaptations');\n  }\n\n  /**\n   * Record HNSW query\n   */\n  async recordHnswQuery(): Promise<void> {\n    await this.incrementStat('hnsw_queries');\n  }\n\n  // ============ Utility Methods ============\n\n  /**\n   * Get summary for display (simplified for UI)\n   */\n  async getSummary(): Promise<{\n    trajectories: number;\n    routings: number;\n    patterns: number;\n    operations: number;\n  }> {\n    const stats = await this.getStats();\n\n    return {\n      trajectories: stats.totalTrajectories,\n      routings: stats.totalRoutings,\n      patterns: stats.totalPatterns,\n      operations: stats.sonaAdaptations + stats.hnswQueries,\n    };\n  }\n\n  /**\n   * Get detailed summary for reports\n   */\n  async getDetailedSummary(): Promise<{\n    trajectories: { total: number; active: number; successful: number };\n    routings: { total: number; accuracy: number };\n    patterns: number;\n    operations: { sona: number; hnsw: number };\n  }> {\n    const stats = await this.getStats();\n    const active = await this.getActiveTrajectories();\n\n    return {\n      trajectories: {\n        total: stats.totalTrajectories,\n        active: active.length,\n        successful: stats.successfulTrajectories,\n      },\n      routings: {\n        total: stats.totalRoutings,\n        accuracy: stats.totalRoutings > 0 ? stats.successfulRoutings / stats.totalRoutings : 0,\n      },\n      patterns: stats.totalPatterns,\n      operations: {\n        sona: stats.sonaAdaptations,\n        hnsw: stats.hnswQueries,\n      },\n    };\n  }\n\n  /**\n   * Close database connection\n   */\n  close(): void {\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n    }\n    this.initialized = false;\n    IntelligenceStore.instance = null;\n  }\n\n  /**\n   * Reset all data (for testing)\n   */\n  async reset(): Promise<void> {\n    await this.ensureInitialized();\n    if (!this.db) return;\n\n    this.db.exec(`\n      DELETE FROM trajectories;\n      DELETE FROM patterns;\n      DELETE FROM routings;\n      UPDATE stats SET\n        total_trajectories = 0,\n        successful_trajectories = 0,\n        total_routings = 0,\n        successful_routings = 0,\n        total_patterns = 0,\n        sona_adaptations = 0,\n        hnsw_queries = 0,\n        last_updated = strftime('%s', 'now')\n      WHERE id = 1;\n    `);\n  }\n}\n\n// Export singleton getter\nexport function getIntelligenceStore(dbPath?: string): IntelligenceStore {\n  return IntelligenceStore.getInstance(dbPath);\n}\n"]}