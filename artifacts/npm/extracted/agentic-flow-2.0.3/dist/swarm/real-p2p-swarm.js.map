{"version":3,"file":"real-p2p-swarm.js","sourceRoot":"","sources":["../../src/swarm/real-p2p-swarm.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Real P2P Swarm Coordination\n *\n * IMPROVED VERSION with actual P2P connections:\n * - Real GunDB relay connections\n * - Actual WebRTC via PeerJS\n * - Persistent learning storage\n * - Better error handling\n */\n\nimport crypto from 'crypto';\nimport { logger } from '../utils/logger.js';\n\n// Lazy-load P2P modules\nlet Gun: any = null;\nlet Peer: any = null;\n\n/**\n * Load GunDB (lazy)\n */\nasync function getGun(): Promise<any> {\n  if (!Gun) {\n    try {\n      Gun = (await import('gun')).default;\n    } catch {\n      logger.warn('GunDB not installed. Run: npm install gun');\n      return null;\n    }\n  }\n  return Gun;\n}\n\n/**\n * Load PeerJS (lazy)\n */\nasync function getPeer(): Promise<any> {\n  if (!Peer) {\n    try {\n      const peerjs = await import('peerjs');\n      Peer = peerjs.Peer || peerjs.default;\n    } catch {\n      logger.warn('PeerJS not installed. Run: npm install peerjs');\n      return null;\n    }\n  }\n  return Peer;\n}\n\n/**\n * Encryption utilities\n */\nclass SwarmCrypto {\n  private algorithm = 'aes-256-gcm';\n\n  generateKey(): string {\n    return crypto.randomBytes(32).toString('base64');\n  }\n\n  encrypt(data: string, keyBase64: string): {\n    ciphertext: string;\n    iv: string;\n    tag: string;\n  } {\n    const key = Buffer.from(keyBase64, 'base64');\n    const iv = crypto.randomBytes(16);\n    const cipher = crypto.createCipheriv(this.algorithm, key, iv) as crypto.CipherGCM;\n\n    let ciphertext = cipher.update(data, 'utf8', 'base64');\n    ciphertext += cipher.final('base64');\n\n    return {\n      ciphertext,\n      iv: iv.toString('base64'),\n      tag: cipher.getAuthTag().toString('base64'),\n    };\n  }\n\n  decrypt(ciphertext: string, keyBase64: string, ivBase64: string, tagBase64: string): string {\n    const key = Buffer.from(keyBase64, 'base64');\n    const iv = Buffer.from(ivBase64, 'base64');\n    const tag = Buffer.from(tagBase64, 'base64');\n\n    const decipher = crypto.createDecipheriv(this.algorithm, key, iv) as crypto.DecipherGCM;\n    decipher.setAuthTag(tag);\n\n    let plaintext = decipher.update(ciphertext, 'base64', 'utf8');\n    plaintext += decipher.final('utf8');\n\n    return plaintext;\n  }\n\n  hash(data: string): string {\n    return crypto.createHash('sha256').update(data).digest('hex');\n  }\n}\n\n/**\n * Real GunDB Swarm (connects to actual relays)\n */\nexport class RealGunDBSwarm {\n  private gun: any = null;\n  private swarmNode: any = null;\n  private crypto: SwarmCrypto;\n  private swarmKey: string;\n  private swarmId: string;\n  private connected: boolean = false;\n\n  static readonly FREE_RELAYS = [\n    'https://gun-manhattan.herokuapp.com/gun',\n    'https://gun-us.herokuapp.com/gun',\n    'https://gun-eu.herokuapp.com/gun',\n  ];\n\n  constructor(swarmKey?: string, relays?: string[]) {\n    this.crypto = new SwarmCrypto();\n    this.swarmKey = swarmKey || this.crypto.generateKey();\n    this.swarmId = this.crypto.hash(this.swarmKey).slice(0, 16);\n  }\n\n  /**\n   * Connect to GunDB relays\n   */\n  async connect(relays?: string[]): Promise<boolean> {\n    const GunDB = await getGun();\n    if (!GunDB) {\n      logger.warn('GunDB not available, using simulation mode');\n      return false;\n    }\n\n    try {\n      this.gun = GunDB(relays || RealGunDBSwarm.FREE_RELAYS);\n      this.swarmNode = this.gun.get(`agentic-flow-swarm-${this.swarmId}`);\n      this.connected = true;\n\n      logger.info('Connected to GunDB relays', {\n        swarmId: this.swarmId,\n        relays: relays?.length || RealGunDBSwarm.FREE_RELAYS.length,\n      });\n\n      return true;\n    } catch (error) {\n      logger.error('Failed to connect to GunDB', { error });\n      return false;\n    }\n  }\n\n  /**\n   * Register agent with swarm\n   */\n  async registerAgent(agentId: string, capabilities: string[]): Promise<void> {\n    if (!this.connected || !this.swarmNode) {\n      logger.warn('Not connected to GunDB');\n      return;\n    }\n\n    const agentData = {\n      id: agentId,\n      capabilities: capabilities.join(','),\n      joinedAt: Date.now(),\n      status: 'active',\n    };\n\n    // Encrypt sensitive data\n    const encrypted = this.crypto.encrypt(\n      JSON.stringify(agentData),\n      this.swarmKey\n    );\n\n    this.swarmNode.get('agents').get(agentId).put({\n      ...encrypted,\n      agentId, // Keep ID visible for routing\n    });\n\n    logger.debug('Agent registered to GunDB', { agentId });\n  }\n\n  /**\n   * Publish message to swarm (real-time sync)\n   */\n  async publish(topic: string, data: any): Promise<string> {\n    const messageId = this.crypto.hash(JSON.stringify(data) + Date.now()).slice(0, 16);\n\n    const message = {\n      id: messageId,\n      topic,\n      timestamp: Date.now(),\n    };\n\n    // Encrypt payload\n    const encrypted = this.crypto.encrypt(\n      JSON.stringify(data),\n      this.swarmKey\n    );\n\n    if (this.connected && this.swarmNode) {\n      this.swarmNode.get('messages').get(topic).get(messageId).put({\n        ...message,\n        ...encrypted,\n      });\n    }\n\n    return messageId;\n  }\n\n  /**\n   * Subscribe to topic\n   */\n  subscribe(topic: string, callback: (data: any) => void): void {\n    if (!this.connected || !this.swarmNode) {\n      logger.warn('Not connected to GunDB');\n      return;\n    }\n\n    this.swarmNode.get('messages').get(topic).map().on((msg: any, id: string) => {\n      if (msg && msg.ciphertext) {\n        try {\n          const decrypted = this.crypto.decrypt(\n            msg.ciphertext,\n            this.swarmKey,\n            msg.iv,\n            msg.tag\n          );\n          callback(JSON.parse(decrypted));\n        } catch (error) {\n          // Ignore decryption errors (wrong key)\n        }\n      }\n    });\n  }\n\n  /**\n   * Sync Q-table to swarm\n   */\n  async syncQTable(agentId: string, qTable: number[][]): Promise<string> {\n    return this.publish('q_table_sync', {\n      agentId,\n      qTable,\n      dimensions: `${qTable.length}x${qTable[0]?.length || 0}`,\n    });\n  }\n\n  /**\n   * Sync memory vectors\n   */\n  async syncMemory(agentId: string, vectors: number[][], namespace: string): Promise<string> {\n    return this.publish('memory_sync', {\n      agentId,\n      vectorCount: vectors.length,\n      dimensions: vectors[0]?.length || 0,\n      namespace,\n      checksum: this.crypto.hash(JSON.stringify(vectors)).slice(0, 8),\n    });\n  }\n\n  /**\n   * Get connection status\n   */\n  isConnected(): boolean {\n    return this.connected;\n  }\n\n  /**\n   * Get swarm key (for sharing)\n   */\n  getSwarmKey(): string {\n    return this.swarmKey;\n  }\n\n  /**\n   * Get swarm ID\n   */\n  getSwarmId(): string {\n    return this.swarmId;\n  }\n}\n\n/**\n * Real WebRTC Swarm (using PeerJS)\n */\nexport class RealWebRTCSwarm {\n  private peer: any = null;\n  private connections: Map<string, any> = new Map();\n  private crypto: SwarmCrypto;\n  private swarmKey: string;\n  private swarmId: string;\n  private peerId: string | null = null;\n\n  constructor(swarmKey?: string) {\n    this.crypto = new SwarmCrypto();\n    this.swarmKey = swarmKey || this.crypto.generateKey();\n    this.swarmId = this.crypto.hash(this.swarmKey).slice(0, 16);\n  }\n\n  /**\n   * Initialize PeerJS connection\n   */\n  async initialize(agentId: string): Promise<string | null> {\n    const PeerClass = await getPeer();\n    if (!PeerClass) {\n      logger.warn('PeerJS not available');\n      return null;\n    }\n\n    return new Promise((resolve) => {\n      try {\n        this.peerId = `swarm-${this.swarmId}-${agentId}`;\n        this.peer = new PeerClass(this.peerId);\n\n        this.peer.on('open', (id: string) => {\n          logger.info('WebRTC peer connected', { peerId: id });\n          resolve(id);\n        });\n\n        this.peer.on('connection', (conn: any) => {\n          this.handleConnection(conn);\n        });\n\n        this.peer.on('error', (err: Error) => {\n          logger.error('PeerJS error', { error: err.message });\n          resolve(null);\n        });\n\n        // Timeout after 10 seconds\n        setTimeout(() => resolve(null), 10000);\n      } catch (error) {\n        logger.error('Failed to initialize PeerJS', { error });\n        resolve(null);\n      }\n    });\n  }\n\n  /**\n   * Handle incoming connection\n   */\n  private handleConnection(conn: any): void {\n    conn.on('open', () => {\n      this.connections.set(conn.peer, conn);\n      logger.debug('Peer connected', { peer: conn.peer });\n    });\n\n    conn.on('data', (data: any) => {\n      if (data.encrypted) {\n        try {\n          const decrypted = this.crypto.decrypt(\n            data.ciphertext,\n            this.swarmKey,\n            data.iv,\n            data.tag\n          );\n          this.handleMessage(JSON.parse(decrypted), conn.peer);\n        } catch {\n          // Ignore decryption errors\n        }\n      }\n    });\n\n    conn.on('close', () => {\n      this.connections.delete(conn.peer);\n    });\n  }\n\n  /**\n   * Handle decrypted message\n   */\n  private handleMessage(message: any, from: string): void {\n    logger.debug('Received P2P message', { from, type: message.type });\n    // Override in subclass or add event emitter\n  }\n\n  /**\n   * Connect to another peer\n   */\n  async connectToPeer(peerId: string): Promise<boolean> {\n    if (!this.peer) {\n      return false;\n    }\n\n    return new Promise((resolve) => {\n      const conn = this.peer.connect(peerId);\n\n      conn.on('open', () => {\n        this.connections.set(peerId, conn);\n        resolve(true);\n      });\n\n      conn.on('error', () => {\n        resolve(false);\n      });\n\n      setTimeout(() => resolve(false), 5000);\n    });\n  }\n\n  /**\n   * Send encrypted message to peer\n   */\n  async sendToPeer(peerId: string, data: any): Promise<boolean> {\n    const conn = this.connections.get(peerId);\n    if (!conn) {\n      return false;\n    }\n\n    const encrypted = this.crypto.encrypt(\n      JSON.stringify(data),\n      this.swarmKey\n    );\n\n    conn.send({\n      encrypted: true,\n      ...encrypted,\n    });\n\n    return true;\n  }\n\n  /**\n   * Broadcast to all connected peers\n   */\n  async broadcast(data: any): Promise<number> {\n    let sent = 0;\n\n    for (const [peerId] of this.connections) {\n      if (await this.sendToPeer(peerId, data)) {\n        sent++;\n      }\n    }\n\n    return sent;\n  }\n\n  /**\n   * Get connected peer count\n   */\n  getConnectedPeers(): number {\n    return this.connections.size;\n  }\n\n  /**\n   * Get peer ID\n   */\n  getPeerId(): string | null {\n    return this.peerId;\n  }\n\n  /**\n   * Disconnect\n   */\n  disconnect(): void {\n    if (this.peer) {\n      this.peer.destroy();\n      this.peer = null;\n    }\n    this.connections.clear();\n  }\n}\n\n/**\n * Combined Real P2P Swarm Coordinator\n */\nexport class RealP2PSwarmCoordinator {\n  private gundb: RealGunDBSwarm;\n  private webrtc: RealWebRTCSwarm;\n  private swarmKey: string;\n  private initialized: boolean = false;\n\n  constructor(swarmKey?: string) {\n    const crypto = new SwarmCrypto();\n    this.swarmKey = swarmKey || crypto.generateKey();\n    this.gundb = new RealGunDBSwarm(this.swarmKey);\n    this.webrtc = new RealWebRTCSwarm(this.swarmKey);\n  }\n\n  /**\n   * Initialize all P2P connections\n   */\n  async initialize(agentId: string): Promise<{\n    gundb: boolean;\n    webrtc: boolean;\n    swarmId: string;\n  }> {\n    const gundbConnected = await this.gundb.connect();\n    const webrtcPeerId = await this.webrtc.initialize(agentId);\n\n    if (gundbConnected) {\n      await this.gundb.registerAgent(agentId, ['coordinator']);\n    }\n\n    this.initialized = true;\n\n    return {\n      gundb: gundbConnected,\n      webrtc: webrtcPeerId !== null,\n      swarmId: this.gundb.getSwarmId(),\n    };\n  }\n\n  /**\n   * Publish via GunDB (real-time)\n   */\n  async publish(topic: string, data: any): Promise<string> {\n    return this.gundb.publish(topic, data);\n  }\n\n  /**\n   * Subscribe via GunDB\n   */\n  subscribe(topic: string, callback: (data: any) => void): void {\n    this.gundb.subscribe(topic, callback);\n  }\n\n  /**\n   * Send direct P2P message\n   */\n  async sendDirect(peerId: string, data: any): Promise<boolean> {\n    return this.webrtc.sendToPeer(peerId, data);\n  }\n\n  /**\n   * Broadcast via WebRTC\n   */\n  async broadcastDirect(data: any): Promise<number> {\n    return this.webrtc.broadcast(data);\n  }\n\n  /**\n   * Sync learning state\n   */\n  async syncLearning(agentId: string, qTable: number[][], vectors?: number[][]): Promise<{\n    qTableId: string;\n    memoryId?: string;\n  }> {\n    const qTableId = await this.gundb.syncQTable(agentId, qTable);\n\n    let memoryId: string | undefined;\n    if (vectors && vectors.length > 0) {\n      memoryId = await this.gundb.syncMemory(agentId, vectors, 'default');\n    }\n\n    return { qTableId, memoryId };\n  }\n\n  /**\n   * Get status\n   */\n  getStatus(): {\n    gundb: boolean;\n    webrtc: { connected: boolean; peers: number };\n    swarmId: string;\n    swarmKey: string;\n  } {\n    return {\n      gundb: this.gundb.isConnected(),\n      webrtc: {\n        connected: this.webrtc.getPeerId() !== null,\n        peers: this.webrtc.getConnectedPeers(),\n      },\n      swarmId: this.gundb.getSwarmId(),\n      swarmKey: this.swarmKey,\n    };\n  }\n\n  /**\n   * Cleanup\n   */\n  disconnect(): void {\n    this.webrtc.disconnect();\n  }\n}\n\n/**\n * Quick start helper\n */\nexport async function createRealP2PSwarm(\n  agentId: string,\n  swarmKey?: string\n): Promise<RealP2PSwarmCoordinator> {\n  const swarm = new RealP2PSwarmCoordinator(swarmKey);\n  await swarm.initialize(agentId);\n  return swarm;\n}\n\nexport { SwarmCrypto };\n"]}