{"version":3,"file":"p2p-swarm-wasm.js","sourceRoot":"","sources":["../../src/swarm/p2p-swarm-wasm.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * P2P Swarm V2 WASM Integration\n *\n * Provides WASM-accelerated components for P2P Swarm:\n * - Ed25519 identity (faster key generation)\n * - HNSW indexing (fast member/capability search)\n * - Semantic matching (intelligent task routing)\n */\n\nimport {\n  initRuVectorWasm,\n  isWasmInitialized,\n  generateIdentity,\n  signData,\n  verifySignature,\n  RuVectorHnswIndex,\n  RuVectorSemanticMatcher,\n} from '../wasm/ruvector-edge.js';\nimport { logger } from '../utils/logger.js';\n\n//=============================================================================\n// WASM-Enhanced Identity Manager\n//=============================================================================\n\n/**\n * WASM-accelerated identity manager for P2P Swarm\n * Falls back to Node.js crypto when WASM unavailable\n */\nexport class WasmIdentityManager {\n  private publicKey: Uint8Array | null = null;\n  private secretKey: Uint8Array | null = null;\n  private publicKeyHex: string = '';\n  private initialized: boolean = false;\n  private sendCounter: number = 0;\n  private recvCounters: Map<string, number> = new Map();\n  private seenNonces: Map<string, Map<string, number>> = new Map();\n  private maxNonceAge = 300000; // 5 minutes\n\n  async initialize(): Promise<void> {\n    if (this.initialized) return;\n\n    // Try to initialize WASM\n    await initRuVectorWasm();\n\n    // Generate identity (uses WASM if available)\n    const identity = await generateIdentity();\n    this.publicKey = identity.publicKey;\n    this.secretKey = identity.secretKey;\n    this.publicKeyHex = identity.publicKeyHex;\n    this.initialized = true;\n\n    logger.info('WASM identity manager initialized', {\n      wasmAccelerated: isWasmInitialized(),\n      publicKeyPrefix: this.publicKeyHex.slice(0, 16),\n    });\n  }\n\n  /**\n   * Get public key as hex string\n   */\n  getPublicKeyHex(): string {\n    return this.publicKeyHex;\n  }\n\n  /**\n   * Get public key as Uint8Array\n   */\n  getPublicKey(): Uint8Array {\n    if (!this.publicKey) throw new Error('Identity not initialized');\n    return this.publicKey;\n  }\n\n  /**\n   * Sign data and return base64 signature\n   */\n  async sign(data: string): Promise<string> {\n    if (!this.secretKey) throw new Error('Identity not initialized');\n    const signature = await signData(\n      new Uint8Array(Buffer.from(data)),\n      this.secretKey\n    );\n    return Buffer.from(signature).toString('base64');\n  }\n\n  /**\n   * Verify signature from peer\n   */\n  async verify(data: string, signature: string, peerPublicKeyHex: string): Promise<boolean> {\n    try {\n      const pubKey = new Uint8Array(Buffer.from(peerPublicKeyHex, 'hex'));\n      const sig = new Uint8Array(Buffer.from(signature, 'base64'));\n      const dataBytes = new Uint8Array(Buffer.from(data));\n      return await verifySignature(dataBytes, sig, pubKey);\n    } catch (error) {\n      logger.warn('Signature verification failed', { error });\n      return false;\n    }\n  }\n\n  /**\n   * Get next send counter (monotonic)\n   */\n  getNextCounter(): number {\n    return ++this.sendCounter;\n  }\n\n  /**\n   * Validate counter from peer (must be strictly increasing)\n   */\n  validateCounter(peerId: string, counter: number): boolean {\n    const lastSeen = this.recvCounters.get(peerId) || 0;\n    if (counter <= lastSeen) {\n      return false;\n    }\n    this.recvCounters.set(peerId, counter);\n    return true;\n  }\n\n  /**\n   * Generate and track nonce\n   */\n  generateNonce(): string {\n    const crypto = require('crypto');\n    return crypto.randomBytes(16).toString('hex');\n  }\n\n  /**\n   * Validate nonce (replay protection)\n   */\n  validateNonce(senderId: string, nonce: string, timestamp: number): boolean {\n    // Reject old messages\n    if (Date.now() - timestamp > this.maxNonceAge) {\n      return false;\n    }\n\n    // Get or create nonce set for sender\n    if (!this.seenNonces.has(senderId)) {\n      this.seenNonces.set(senderId, new Map());\n    }\n    const senderNonces = this.seenNonces.get(senderId)!;\n\n    // Reject replayed nonces\n    if (senderNonces.has(nonce)) {\n      return false;\n    }\n\n    senderNonces.set(nonce, timestamp);\n    return true;\n  }\n\n  /**\n   * Check if WASM acceleration is active\n   */\n  isWasmAccelerated(): boolean {\n    return isWasmInitialized();\n  }\n}\n\n//=============================================================================\n// WASM-Enhanced Member Index\n//=============================================================================\n\nexport interface SwarmMember {\n  agentId: string;\n  publicKeyHex: string;\n  capabilities: string[];\n  embedding?: Float32Array;\n  lastSeen: number;\n}\n\n/**\n * WASM-accelerated member index for fast capability search\n */\nexport class WasmMemberIndex {\n  private hnswIndex: RuVectorHnswIndex;\n  private members: Map<string, SwarmMember> = new Map();\n  private indexToAgentId: Map<number, string> = new Map();\n  private dimensions: number;\n\n  constructor(dimensions: number = 128) {\n    this.dimensions = dimensions;\n    this.hnswIndex = new RuVectorHnswIndex(dimensions, 16, 200);\n  }\n\n  /**\n   * Add or update member\n   */\n  addMember(member: SwarmMember): void {\n    this.members.set(member.agentId, member);\n\n    // If member has embedding, add to HNSW index\n    if (member.embedding) {\n      const idx = this.hnswIndex.add(member.embedding);\n      this.indexToAgentId.set(idx, member.agentId);\n    }\n  }\n\n  /**\n   * Remove member\n   */\n  removeMember(agentId: string): void {\n    this.members.delete(agentId);\n    // Note: HNSW doesn't support removal, but member won't be returned in searches\n  }\n\n  /**\n   * Get member by ID\n   */\n  getMember(agentId: string): SwarmMember | undefined {\n    return this.members.get(agentId);\n  }\n\n  /**\n   * Find members with specific capabilities\n   */\n  findByCapabilities(capabilities: string[]): SwarmMember[] {\n    const results: SwarmMember[] = [];\n    for (const member of this.members.values()) {\n      const hasAll = capabilities.every(cap =>\n        member.capabilities.includes(cap)\n      );\n      if (hasAll) {\n        results.push(member);\n      }\n    }\n    return results;\n  }\n\n  /**\n   * Find k nearest members by embedding similarity\n   */\n  findSimilar(queryEmbedding: Float32Array, k: number = 5): SwarmMember[] {\n    const searchResults = this.hnswIndex.search(queryEmbedding, k);\n    const members: SwarmMember[] = [];\n\n    for (const result of searchResults) {\n      const agentId = this.indexToAgentId.get(result.index);\n      if (agentId) {\n        const member = this.members.get(agentId);\n        if (member) {\n          members.push(member);\n        }\n      }\n    }\n\n    return members;\n  }\n\n  /**\n   * Get all live members (last seen within threshold)\n   */\n  getLiveMembers(maxAge: number = 30000): SwarmMember[] {\n    const now = Date.now();\n    const live: SwarmMember[] = [];\n\n    for (const member of this.members.values()) {\n      if (now - member.lastSeen < maxAge) {\n        live.push(member);\n      }\n    }\n\n    return live;\n  }\n\n  /**\n   * Get total member count\n   */\n  size(): number {\n    return this.members.size;\n  }\n\n  /**\n   * Check if WASM acceleration is active\n   */\n  isWasmAccelerated(): boolean {\n    return this.hnswIndex.isWasmAccelerated();\n  }\n}\n\n//=============================================================================\n// WASM-Enhanced Task Router\n//=============================================================================\n\n/**\n * WASM-accelerated task router for intelligent agent selection\n */\nexport class WasmTaskRouter {\n  private semanticMatcher: RuVectorSemanticMatcher;\n  private dimensions: number;\n\n  constructor(dimensions: number = 128) {\n    this.dimensions = dimensions;\n    this.semanticMatcher = new RuVectorSemanticMatcher();\n  }\n\n  /**\n   * Register agent for task routing\n   */\n  registerAgent(\n    agentId: string,\n    embedding: Float32Array,\n    capabilities: string[]\n  ): void {\n    this.semanticMatcher.registerAgent(agentId, embedding, capabilities);\n  }\n\n  /**\n   * Route task to best matching agents\n   */\n  routeTask(\n    taskEmbedding: Float32Array,\n    requiredCapabilities?: string[],\n    topK: number = 3\n  ): Array<{ agentId: string; score: number; capabilities: string[] }> {\n    const matches = this.semanticMatcher.matchTask(taskEmbedding, topK * 2);\n\n    // Filter by required capabilities if specified\n    if (requiredCapabilities && requiredCapabilities.length > 0) {\n      return matches\n        .filter(m =>\n          requiredCapabilities.every(cap => m.capabilities.includes(cap))\n        )\n        .slice(0, topK)\n        .map(m => ({\n          agentId: m.agent,\n          score: m.score,\n          capabilities: m.capabilities,\n        }));\n    }\n\n    return matches.slice(0, topK).map(m => ({\n      agentId: m.agent,\n      score: m.score,\n      capabilities: m.capabilities,\n    }));\n  }\n\n  /**\n   * Check if WASM acceleration is active\n   */\n  isWasmAccelerated(): boolean {\n    return this.semanticMatcher.isWasmAccelerated();\n  }\n}\n\n//=============================================================================\n// Factory Functions\n//=============================================================================\n\n/**\n * Create WASM-enhanced identity manager\n */\nexport async function createWasmIdentityManager(): Promise<WasmIdentityManager> {\n  const manager = new WasmIdentityManager();\n  await manager.initialize();\n  return manager;\n}\n\n/**\n * Create WASM-enhanced member index\n */\nexport function createWasmMemberIndex(dimensions: number = 128): WasmMemberIndex {\n  return new WasmMemberIndex(dimensions);\n}\n\n/**\n * Create WASM-enhanced task router\n */\nexport function createWasmTaskRouter(dimensions: number = 128): WasmTaskRouter {\n  return new WasmTaskRouter(dimensions);\n}\n\n/**\n * Get WASM acceleration status\n */\nexport function getWasmStatus(): {\n  initialized: boolean;\n  features: string[];\n} {\n  return {\n    initialized: isWasmInitialized(),\n    features: isWasmInitialized()\n      ? ['WasmIdentity', 'WasmHnswIndex', 'WasmSemanticMatcher']\n      : ['JS Fallback'],\n  };\n}\n\nexport default {\n  WasmIdentityManager,\n  WasmMemberIndex,\n  WasmTaskRouter,\n  createWasmIdentityManager,\n  createWasmMemberIndex,\n  createWasmTaskRouter,\n  getWasmStatus,\n};\n"]}