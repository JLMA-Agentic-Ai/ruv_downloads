{"version":3,"file":"sona-service.js","sourceRoot":"","sources":["../../src/services/sona-service.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * SONA Service - Self-Optimizing Neural Architecture\n *\n * Production implementation based on vibecast test-ruvector-sona patterns\n * Achieves +55.3% quality improvement with optimal configuration\n *\n * Key Performance Metrics:\n * - 2211 ops/sec throughput\n * - 18.07ms total overhead (40 layers)\n * - 0.452ms per-layer cost\n * - Sub-millisecond token latency\n *\n * Based on: https://github.com/ruvnet/vibecast/tree/claude/test-ruvector-sona-01Raj3Q3P4qjff4JGVipJhvz\n */\n\nimport { SonaEngine } from '@ruvector/sona';\nimport { EventEmitter } from 'events';\n\n/**\n * SONA Configuration Profiles\n */\nexport type SONAProfile = 'real-time' | 'batch' | 'research' | 'edge' | 'balanced' | 'custom';\n\nexport interface SONAConfig {\n  profile?: SONAProfile;\n\n  // Model dimensions\n  hiddenDim: number;          // Must match model dimensions (e.g., 3072 for Phi-4)\n  embeddingDim: number;       // Embedding dimension (e.g., 1536 for OpenAI)\n\n  // LoRA configuration\n  microLoraRank: number;      // Rank-2 is faster than rank-1 (SIMD optimization)\n  baseLoraRank: number;       // Base LoRA rank (4, 8, 16)\n  microLoraLr: number;        // Learning rate: 0.002 is sweet spot\n  baseLoraLr: number;         // Base learning rate\n\n  // EWC++ (Elastic Weight Consolidation)\n  ewcLambda: number;          // 2000-2500 prevents catastrophic forgetting\n\n  // Pattern clustering\n  patternClusters: number;    // 100 clusters: breakpoint for latency (3.0ms â†’ 1.3ms)\n\n  // Trajectory management\n  trajectoryCapacity: number; // Trigger forceLearn() at 80% utilization\n  backgroundIntervalMs: number;\n  qualityThreshold: number;   // 0.2-0.4 for optimal learning\n\n  // Performance\n  enableSimd: boolean;        // +10% performance acceleration\n}\n\nexport interface TrajectoryMetadata {\n  id: string;\n  embedding: number[];\n  route?: string;            // LLM model used (e.g., 'claude-sonnet-4-5')\n  contexts: string[];        // Context IDs\n  steps: TrajectoryStep[];\n  startTime: number;\n  endTime?: number;\n  qualityScore?: number;\n}\n\nexport interface TrajectoryStep {\n  activations: number[];\n  attentionWeights: number[];\n  reward: number;\n  timestamp: number;\n}\n\nexport interface PatternMatch {\n  id: string;\n  centroid: number[];\n  clusterSize: number;\n  avgQuality: number;\n  patternType: string;\n  similarity: number;\n}\n\n/**\n * SONA Service - Main orchestration class\n */\nexport class SONAService extends EventEmitter {\n  private engine: SonaEngine;\n  private config: SONAConfig;\n  private trajectories: Map<string, TrajectoryMetadata>;\n  private stats: {\n    totalTrajectories: number;\n    activeTrajectories: number;\n    completedTrajectories: number;\n    totalLearningCycles: number;\n    avgQualityScore: number;\n    totalOpsProcessed: number;\n  };\n\n  constructor(config?: Partial<SONAConfig>) {\n    super();\n\n    // Apply profile or custom config\n    this.config = this.resolveConfig(config);\n\n    // Initialize SONA engine\n    this.engine = SonaEngine.withConfig({\n      hiddenDim: this.config.hiddenDim,\n      embeddingDim: this.config.embeddingDim,\n      microLoraRank: this.config.microLoraRank,\n      baseLoraRank: this.config.baseLoraRank,\n      microLoraLr: this.config.microLoraLr,\n      baseLoraLr: this.config.baseLoraLr,\n      ewcLambda: this.config.ewcLambda,\n      patternClusters: this.config.patternClusters,\n      trajectoryCapacity: this.config.trajectoryCapacity,\n      backgroundIntervalMs: this.config.backgroundIntervalMs,\n      qualityThreshold: this.config.qualityThreshold,\n      enableSimd: this.config.enableSimd\n    });\n\n    this.trajectories = new Map();\n    this.stats = {\n      totalTrajectories: 0,\n      activeTrajectories: 0,\n      completedTrajectories: 0,\n      totalLearningCycles: 0,\n      avgQualityScore: 0,\n      totalOpsProcessed: 0\n    };\n\n    this.emit('sona:initialized', { config: this.config });\n  }\n\n  /**\n   * Resolve configuration from profile or custom settings\n   */\n  private resolveConfig(config?: Partial<SONAConfig>): SONAConfig {\n    const profile = config?.profile || 'balanced';\n\n    // Profile-based configurations (from vibecast KEY_FINDINGS.md)\n    const profiles: Record<SONAProfile, Partial<SONAConfig>> = {\n      // Real-Time: Rank-2, 25 clusters, 0.7 threshold â†’ 2200 ops/sec, <0.5ms\n      'real-time': {\n        hiddenDim: 3072,\n        embeddingDim: 1536,\n        microLoraRank: 2,\n        baseLoraRank: 4,\n        microLoraLr: 0.001,\n        baseLoraLr: 0.0001,\n        ewcLambda: 1000,\n        patternClusters: 25,\n        trajectoryCapacity: 1000,\n        backgroundIntervalMs: 3600000,\n        qualityThreshold: 0.7,\n        enableSimd: true\n      },\n\n      // Batch Processing: Rank-2, rank-8, 5000 capacity\n      'batch': {\n        hiddenDim: 3072,\n        embeddingDim: 1536,\n        microLoraRank: 2,\n        baseLoraRank: 8,\n        microLoraLr: 0.002,\n        baseLoraLr: 0.0001,\n        ewcLambda: 2000,\n        patternClusters: 50,\n        trajectoryCapacity: 5000,\n        backgroundIntervalMs: 1800000,\n        qualityThreshold: 0.4,\n        enableSimd: true\n      },\n\n      // Research/Fine-Tuning: Rank-2 micro, rank-16 base, LR 0.002, threshold 0.2\n      // Maximum Quality: +55% improvement\n      'research': {\n        hiddenDim: 3072,\n        embeddingDim: 1536,\n        microLoraRank: 2,\n        baseLoraRank: 16,\n        microLoraLr: 0.002,  // Sweet spot for quality gains\n        baseLoraLr: 0.0001,\n        ewcLambda: 2500,\n        patternClusters: 100,\n        trajectoryCapacity: 10000,\n        backgroundIntervalMs: 900000,\n        qualityThreshold: 0.2,  // Learn from more data\n        enableSimd: true\n      },\n\n      // Edge/Mobile: Rank-1, 200 capacity, 15 clusters â†’ <5MB memory\n      'edge': {\n        hiddenDim: 768,\n        embeddingDim: 384,\n        microLoraRank: 1,\n        baseLoraRank: 2,\n        microLoraLr: 0.001,\n        baseLoraLr: 0.0001,\n        ewcLambda: 1000,\n        patternClusters: 15,\n        trajectoryCapacity: 200,\n        backgroundIntervalMs: 7200000,\n        qualityThreshold: 0.5,\n        enableSimd: false\n      },\n\n      // Balanced: Rank-2, rank-8, 0.4 threshold â†’ 18ms, +25% quality\n      'balanced': {\n        hiddenDim: 3072,\n        embeddingDim: 1536,\n        microLoraRank: 2,\n        baseLoraRank: 8,\n        microLoraLr: 0.002,\n        baseLoraLr: 0.0001,\n        ewcLambda: 2000,\n        patternClusters: 50,\n        trajectoryCapacity: 5000,\n        backgroundIntervalMs: 1800000,\n        qualityThreshold: 0.4,\n        enableSimd: true\n      },\n\n      // Custom: User-provided configuration\n      'custom': {}\n    };\n\n    const profileConfig = profiles[profile];\n\n    return {\n      hiddenDim: 3072,\n      embeddingDim: 1536,\n      microLoraRank: 2,\n      baseLoraRank: 8,\n      microLoraLr: 0.002,\n      baseLoraLr: 0.0001,\n      ewcLambda: 2000,\n      patternClusters: 50,\n      trajectoryCapacity: 5000,\n      backgroundIntervalMs: 1800000,\n      qualityThreshold: 0.4,\n      enableSimd: true,\n      ...profileConfig,\n      ...config\n    };\n  }\n\n  /**\n   * Begin a new trajectory\n   */\n  beginTrajectory(embedding: number[], route?: string): string {\n    const numericId = this.engine.beginTrajectory(embedding);\n    const id = String(numericId);\n\n    const metadata: TrajectoryMetadata = {\n      id,\n      embedding,\n      route,\n      contexts: [],\n      steps: [],\n      startTime: Date.now()\n    };\n\n    this.trajectories.set(id, metadata);\n    this.stats.totalTrajectories++;\n    this.stats.activeTrajectories++;\n\n    if (route) {\n      this.engine.setTrajectoryRoute(numericId, route);\n    }\n\n    this.emit('trajectory:begin', { id, route });\n\n    return id;\n  }\n\n  /**\n   * Add a step to an active trajectory\n   */\n  addTrajectoryStep(\n    trajectoryId: string,\n    activations: number[],\n    attentionWeights: number[],\n    reward: number\n  ): void {\n    const metadata = this.trajectories.get(trajectoryId);\n    if (!metadata) {\n      throw new Error(`Trajectory ${trajectoryId} not found`);\n    }\n\n    this.engine.addTrajectoryStep(Number(trajectoryId), activations, attentionWeights, reward);\n\n    metadata.steps.push({\n      activations,\n      attentionWeights,\n      reward,\n      timestamp: Date.now()\n    });\n\n    this.emit('trajectory:step', { trajectoryId, step: metadata.steps.length });\n  }\n\n  /**\n   * Add context to a trajectory\n   */\n  addTrajectoryContext(trajectoryId: string, contextId: string): void {\n    const metadata = this.trajectories.get(trajectoryId);\n    if (!metadata) {\n      throw new Error(`Trajectory ${trajectoryId} not found`);\n    }\n\n    this.engine.addTrajectoryContext(Number(trajectoryId), contextId);\n    metadata.contexts.push(contextId);\n\n    this.emit('trajectory:context', { trajectoryId, contextId });\n  }\n\n  /**\n   * End a trajectory with quality score\n   */\n  endTrajectory(trajectoryId: string, qualityScore: number): void {\n    const metadata = this.trajectories.get(trajectoryId);\n    if (!metadata) {\n      throw new Error(`Trajectory ${trajectoryId} not found`);\n    }\n\n    this.engine.endTrajectory(Number(trajectoryId), qualityScore);\n\n    metadata.endTime = Date.now();\n    metadata.qualityScore = qualityScore;\n\n    this.stats.activeTrajectories--;\n    this.stats.completedTrajectories++;\n    this.stats.avgQualityScore =\n      (this.stats.avgQualityScore * (this.stats.completedTrajectories - 1) + qualityScore) /\n      this.stats.completedTrajectories;\n\n    this.emit('trajectory:end', {\n      trajectoryId,\n      qualityScore,\n      duration: metadata.endTime - metadata.startTime,\n      steps: metadata.steps.length\n    });\n\n    // Check if we should trigger learning\n    this.checkLearningTrigger();\n  }\n\n  /**\n   * Apply Micro-LoRA to input\n   */\n  applyMicroLora(input: number[]): number[] {\n    const output = this.engine.applyMicroLora(input);\n    this.stats.totalOpsProcessed++;\n    return output;\n  }\n\n  /**\n   * Apply Base-LoRA to layer\n   */\n  applyBaseLora(layerIndex: number, input: number[]): number[] {\n    const output = this.engine.applyBaseLora(layerIndex, input);\n    this.stats.totalOpsProcessed++;\n    return output;\n  }\n\n  /**\n   * Find similar patterns\n   */\n  findPatterns(query: number[], k: number = 3): PatternMatch[] {\n    // Route with k=3 patterns for 761 decisions/sec throughput (from KEY_FINDINGS)\n    const patterns = this.engine.findPatterns(query, k);\n\n    return patterns.map(p => ({\n      id: p.id,\n      centroid: p.centroid,\n      clusterSize: p.clusterSize,\n      avgQuality: p.avgQuality,\n      patternType: p.patternType,\n      similarity: this.calculateSimilarity(query, p.centroid)\n    }));\n  }\n\n  /**\n   * Calculate cosine similarity between vectors\n   */\n  private calculateSimilarity(a: number[], b: number[]): number {\n    const dotProduct = a.reduce((sum, val, i) => sum + val * b[i], 0);\n    const magA = Math.sqrt(a.reduce((sum, val) => sum + val * val, 0));\n    const magB = Math.sqrt(b.reduce((sum, val) => sum + val * val, 0));\n    return dotProduct / (magA * magB);\n  }\n\n  /**\n   * Force learning cycle\n   */\n  forceLearn(): { success: boolean; patternsLearned: number } {\n    const status = this.engine.forceLearn();\n    this.stats.totalLearningCycles++;\n\n    this.emit('learning:cycle', { status });\n\n    return {\n      success: true,\n      patternsLearned: this.engine.getStats().split('\\n').length\n    };\n  }\n\n  /**\n   * Check if learning should be triggered\n   * Trigger forceLearn() when 80% of trajectory capacity is full\n   */\n  private checkLearningTrigger(): void {\n    const utilizationThreshold = 0.8;\n    const currentUtilization = this.stats.activeTrajectories / this.config.trajectoryCapacity;\n\n    if (currentUtilization >= utilizationThreshold) {\n      this.emit('learning:trigger', {\n        utilization: currentUtilization,\n        threshold: utilizationThreshold\n      });\n      this.forceLearn();\n    }\n  }\n\n  /**\n   * Tick for scheduled learning\n   */\n  tick(): void {\n    this.engine.tick();\n  }\n\n  /**\n   * Get engine statistics\n   */\n  getEngineStats(): string {\n    return this.engine.getStats();\n  }\n\n  /**\n   * Get service statistics\n   */\n  getStats() {\n    return {\n      ...this.stats,\n      config: this.config,\n      engineEnabled: this.engine.isEnabled(),\n      trajectoryUtilization: this.stats.activeTrajectories / this.config.trajectoryCapacity,\n      avgTrajectoryDuration: this.calculateAvgTrajectoryDuration(),\n      opsPerSecond: this.calculateOpsPerSecond()\n    };\n  }\n\n  /**\n   * Calculate average trajectory duration\n   */\n  private calculateAvgTrajectoryDuration(): number {\n    let totalDuration = 0;\n    let count = 0;\n\n    for (const trajectory of this.trajectories.values()) {\n      if (trajectory.endTime) {\n        totalDuration += trajectory.endTime - trajectory.startTime;\n        count++;\n      }\n    }\n\n    return count > 0 ? totalDuration / count : 0;\n  }\n\n  /**\n   * Calculate operations per second\n   */\n  private calculateOpsPerSecond(): number {\n    // Simple estimation based on total ops and service uptime\n    // In production, use a sliding window\n    return this.stats.totalOpsProcessed / ((Date.now() - this.stats.totalTrajectories) / 1000);\n  }\n\n  /**\n   * Enable/disable engine\n   */\n  setEnabled(enabled: boolean): void {\n    this.engine.setEnabled(enabled);\n    this.emit('engine:enabled', { enabled });\n  }\n\n  /**\n   * Check if engine is enabled\n   */\n  isEnabled(): boolean {\n    return this.engine.isEnabled();\n  }\n\n  /**\n   * Flush engine state\n   */\n  flush(): void {\n    this.engine.flush();\n    this.emit('engine:flushed');\n  }\n\n  /**\n   * Get trajectory metadata\n   */\n  getTrajectory(trajectoryId: string): TrajectoryMetadata | undefined {\n    return this.trajectories.get(trajectoryId);\n  }\n\n  /**\n   * Get all active trajectories\n   */\n  getActiveTrajectories(): TrajectoryMetadata[] {\n    return Array.from(this.trajectories.values()).filter(t => !t.endTime);\n  }\n}\n\n/**\n * Create singleton SONA service instances for different use cases\n */\nexport const sonaServices = {\n  realtime: new SONAService({ profile: 'real-time' }),\n  batch: new SONAService({ profile: 'batch' }),\n  research: new SONAService({ profile: 'research' }),\n  edge: new SONAService({ profile: 'edge' }),\n  balanced: new SONAService({ profile: 'balanced' })\n};\n\n/**\n * Default SONA service (balanced profile)\n */\nexport const sonaService = sonaServices.balanced;\n\n/**\n * Convenience function to create custom SONA service\n */\nexport function createSONAService(config?: Partial<SONAConfig>): SONAService {\n  return new SONAService(config);\n}\n\n/**\n * Example usage based on vibecast sona.test.js patterns\n */\nexport async function exampleUsage() {\n  console.log('ðŸ§  SONA Service Example\\n');\n\n  // Use balanced profile service\n  const sona = sonaService;\n\n  // Example 1: Begin trajectory\n  const embedding = Array.from({ length: 1536 }, () => Math.random());\n  const trajectoryId = sona.beginTrajectory(embedding, 'claude-sonnet-4-5');\n  console.log(`Started trajectory: ${trajectoryId}`);\n\n  // Example 2: Add steps\n  for (let i = 0; i < 5; i++) {\n    const activations = Array.from({ length: 3072 }, () => Math.random());\n    const attentionWeights = Array.from({ length: 40 }, () => Math.random());\n    const reward = 0.8 + Math.random() * 0.2;\n\n    sona.addTrajectoryStep(trajectoryId, activations, attentionWeights, reward);\n  }\n\n  // Example 3: Add context\n  sona.addTrajectoryContext(trajectoryId, 'task-code-review');\n\n  // Example 4: End trajectory\n  sona.endTrajectory(trajectoryId, 0.92);\n\n  // Example 5: Find patterns\n  const query = Array.from({ length: 1536 }, () => Math.random());\n  const patterns = sona.findPatterns(query, 3);\n  console.log(`\\nFound ${patterns.length} similar patterns:`);\n  patterns.forEach((p, i) => {\n    console.log(`  ${i + 1}. Quality: ${p.avgQuality.toFixed(2)}, Similarity: ${p.similarity.toFixed(3)}`);\n  });\n\n  // Example 6: Apply LoRA\n  const input = Array.from({ length: 3072 }, () => Math.random());\n  const output = sona.applyMicroLora(input);\n  console.log(`\\nApplied Micro-LoRA to ${input.length}D vector`);\n\n  // Example 7: Statistics\n  const stats = sona.getStats();\n  console.log('\\nSONA Statistics:');\n  console.log(`  Total Trajectories: ${stats.totalTrajectories}`);\n  console.log(`  Completed: ${stats.completedTrajectories}`);\n  console.log(`  Avg Quality: ${stats.avgQualityScore.toFixed(2)}`);\n  console.log(`  Total Ops: ${stats.totalOpsProcessed}`);\n  console.log(`  Capacity Utilization: ${(stats.trajectoryUtilization * 100).toFixed(1)}%`);\n}\n\n// Auto-run example if executed directly\nif (require.main === module) {\n  exampleUsage().catch(console.error);\n}\n"]}